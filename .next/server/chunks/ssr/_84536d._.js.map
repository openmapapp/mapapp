{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/actions/getReports.ts"],"sourcesContent":["\"use server\";\n\nimport db from \"../db\";\n\nexport async function getReports() {\n  // Fetch the report types from the database.\n  const reports = await db.report.findMany();\n  // Map the result to a simpler array of objects if needed.\n  return reports;\n}\n"],"names":[],"mappings":";;;;;IAIsB"}},
    {"offset": {"line": 13, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/app/components/map/AddMarkerButton.tsx"],"sourcesContent":["\"use client\";\n\nexport default function AddMarkerButton({ isAdding, toggleMarker }) {\n  return (\n    <button\n      onClick={toggleMarker}\n      className=\"absolute top-4 left-4 bg-blue-500 text-white text-4xl rounded-full w-12 h-12 flex justify-center shadow-lg hover:bg-blue-700 transition\"\n    >\n      {isAdding ? \"x\" : \"+\"}\n    </button>\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEe,SAAS,gBAAgB,EAAE,QAAQ,EAAE,YAAY,EAAE;IAChE,qBACE,8OAAC;QACC,SAAS;QACT,WAAU;kBAET,WAAW,MAAM;;;;;;AAGxB"}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/actions/postReport.ts"],"sourcesContent":["\"use server\";\n\nimport db from \"../db\";\n\nexport async function postReport(\n  latitude: number,\n  longitude: number,\n  reportTypeId: number,\n  trustScore: number,\n  userId: string,\n  description: string | null\n  // image: string | null\n) {\n  try {\n    const report = await db.report.create({\n      data: {\n        lat: latitude,\n        long: longitude,\n        description: description ?? null,\n        //  image: image ?? null,\n        reportTypeId,\n        trustScore,\n        submittedById: userId,\n      },\n    });\n\n    await fetch(\"http://localhost:3005/api/new-report\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(report),\n    });\n\n    return report;\n  } catch (error) {\n    console.error(error);\n  }\n}\n"],"names":[],"mappings":";;;;;IAIsB"}},
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/actions/getReportTypes.ts"],"sourcesContent":["\"use server\";\n\nimport db from \"../db\";\n\nexport async function getReportTypes() {\n  // Fetch the report types from the database.\n  const types = await db.reportType.findMany();\n  // Map the result to a simpler array of objects if needed.\n  return types.map((type) => ({\n    id: type.id,\n    name: type.name,\n  }));\n}\n"],"names":[],"mappings":";;;;;IAIsB"}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/app/components/map/PopupForm.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { postReport } from \"@/actions/postReport\";\nimport { getReportTypes } from \"@/actions/getReportTypes\";\n\ninterface PopupFormProps {\n  latitude: number;\n  longitude: number;\n  userId: string;\n  trustScore: number;\n  onClose: () => void;\n}\n\nconst PopupForm = ({\n  latitude,\n  longitude,\n  userId,\n  trustScore,\n  onClose,\n}: PopupFormProps) => {\n  const [reportTypes, setReportTypes] = useState<ReportType[]>([]);\n  const [selectedReportType, setSelectedReportType] = useState<number>(\n    reportTypes.length > 0\n      ? [...reportTypes].sort((a, b) => a.id - b.id)[0].id\n      : 0\n  );\n  const [description, setDescription] = useState(\"\");\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const types = await getReportTypes();\n        setReportTypes(types);\n      } catch (error) {\n        console.error(\"Error fetching report types:\", error);\n      }\n    };\n    fetchData();\n  }, []);\n\n  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    if (!selectedReportType) {\n      return;\n    }\n\n    const payload = {\n      latitude, // Current latitude\n      longitude, // Current longitude\n      reportTypeId: selectedReportType, // Admin can change these options\n      trustScore,\n      userId,\n      description, // Optional description\n      // Additional fields (like initial trustScore) can be set server-side.\n    };\n\n    postReport(\n      latitude,\n      longitude,\n      selectedReportType,\n      trustScore,\n      userId,\n      description\n    );\n    // Optionally clear the form if desired:\n    setDescription(\"\");\n  };\n\n  return (\n    <div className=\"\">\n      <form onSubmit={handleSubmit} className=\"p-2\">\n        <div>\n          <label htmlFor=\"reportType\" className=\"block font-bold\">\n            Report Type:\n          </label>\n          <select\n            id=\"reportType\"\n            value={selectedReportType}\n            onChange={(e) => setSelectedReportType(Number(e.target.value))}\n            required\n            className=\"border rounded-sm p-1 w-full\"\n          >\n            {reportTypes\n              .slice()\n              .sort((a, b) => a.id - b.id)\n              .map((type) => (\n                <option key={type.id} value={type.id}>\n                  {type.name}\n                </option>\n              ))}\n          </select>\n        </div>\n        <div className=\"mt-2\">\n          <label htmlFor=\"description\" className=\"block font-bold\">\n            Description:\n          </label>\n          <textarea\n            id=\"description\"\n            value={description}\n            onChange={(e) => setDescription(e.target.value)}\n            className=\"border rounded-sm p-1 w-full\"\n          />\n        </div>\n        <div className=\"mt-2\">\n          <p>\n            <strong>Latitude:</strong> {latitude}\n          </p>\n          <p>\n            <strong>Longitude:</strong> {longitude}\n          </p>\n        </div>\n        <div className=\"mt-2 flex space-x-2\">\n          <button\n            type=\"submit\"\n            className=\"bg-blue-500 text-white px-3 py-1 rounded-sm\"\n          >\n            Submit Report\n          </button>\n          <button\n            type=\"button\"\n            className=\"bg-gray-500 text-white px-3 py-1 rounded-sm\"\n            onClick={onClose}\n          >\n            Cancel\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n};\n\nexport default PopupForm;\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;;AAcA,MAAM,YAAY,CAAC,EACjB,QAAQ,EACR,SAAS,EACT,MAAM,EACN,UAAU,EACV,OAAO,EACQ;IACf,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAgB,EAAE;IAC/D,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EACzD,YAAY,MAAM,GAAG,IACjB;WAAI;KAAY,CAAC,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,GAClD;IAEN,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAE/C,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,YAAY;YAChB,IAAI;gBACF,MAAM,QAAQ,MAAM,CAAA,GAAA,yHAAA,CAAA,iBAAc,AAAD;gBACjC,eAAe;YACjB,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,gCAAgC;YAChD;QACF;QACA;IACF,GAAG,EAAE;IAEL,MAAM,eAAe,CAAC;QACpB,EAAE,cAAc;QAChB,IAAI,CAAC,oBAAoB;YACvB;QACF;QAEA,MAAM,UAAU;YACd;YACA;YACA,cAAc;YACd;YACA;YACA;QAEF;QAEA,CAAA,GAAA,qHAAA,CAAA,aAAU,AAAD,EACP,UACA,WACA,oBACA,YACA,QACA;QAEF,wCAAwC;QACxC,eAAe;IACjB;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAK,UAAU;YAAc,WAAU;;8BACtC,8OAAC;;sCACC,8OAAC;4BAAM,SAAQ;4BAAa,WAAU;sCAAkB;;;;;;sCAGxD,8OAAC;4BACC,IAAG;4BACH,OAAO;4BACP,UAAU,CAAC,IAAM,sBAAsB,OAAO,EAAE,MAAM,CAAC,KAAK;4BAC5D,QAAQ;4BACR,WAAU;sCAET,YACE,KAAK,GACL,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,EAAE,GAAG,EAAE,EAAE,EAC1B,GAAG,CAAC,CAAC,qBACJ,8OAAC;oCAAqB,OAAO,KAAK,EAAE;8CACjC,KAAK,IAAI;mCADC,KAAK,EAAE;;;;;;;;;;;;;;;;8BAM5B,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAM,SAAQ;4BAAc,WAAU;sCAAkB;;;;;;sCAGzD,8OAAC;4BACC,IAAG;4BACH,OAAO;4BACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;4BAC9C,WAAU;;;;;;;;;;;;8BAGd,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;;8CACC,8OAAC;8CAAO;;;;;;gCAAkB;gCAAE;;;;;;;sCAE9B,8OAAC;;8CACC,8OAAC;8CAAO;;;;;;gCAAmB;gCAAE;;;;;;;;;;;;;8BAGjC,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,MAAK;4BACL,WAAU;sCACX;;;;;;sCAGD,8OAAC;4BACC,MAAK;4BACL,WAAU;4BACV,SAAS;sCACV;;;;;;;;;;;;;;;;;;;;;;;AAOX;uCAEe"}},
    {"offset": {"line": 266, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 272, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/app/components/map/ReportSubmissionMarker.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useRef } from \"react\";\nimport { Marker, Popup } from \"react-map-gl/maplibre\";\nimport PopupForm from \"./PopupForm\"; // Import the form for submitting\nimport { PositionAnchor } from \"maplibre-gl\";\nimport Image from \"next/image\";\nimport { set } from \"better-auth\";\n\nexport default function ReportSubmissionMarker({\n  mapCenter,\n  isAdding,\n  setIsAdding,\n}) {\n  const [markerPosition, setMarkerPosition] = useState({\n    longitude: mapCenter.longitude,\n    latitude: mapCenter.latitude,\n  });\n  const [popupAnchor, setPopupAnchor] = useState<PositionAnchor>(\"bottom\");\n  const [popupOffset, setPopupOffset] = useState(60);\n\n  const markerRef = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    setMarkerPosition({\n      longitude: mapCenter.longitude,\n      latitude: mapCenter.latitude,\n    });\n  }, [mapCenter]);\n\n  useEffect(() => {\n    updatePopupAnchor();\n  }, [markerPosition]);\n\n  const updatePopupAnchor = () => {\n    if (!markerRef.current) {\n      console.warn(\"‚ö†Ô∏è Marker ref is null!\");\n      return;\n    }\n\n    const markerRect = markerRef.current.getBoundingClientRect();\n    const screenHeight = window.innerHeight;\n\n    console.log(\n      \"üìè Marker position (Y):\",\n      markerRect.top,\n      \"Screen Height:\",\n      screenHeight\n    );\n\n    if (markerRect.top > (screenHeight / 5) * 2) {\n      console.log(\"üìå Setting anchor: TOP\");\n      setPopupAnchor(\"bottom\");\n      setPopupOffset(60);\n    } else {\n      console.log(\"üìå Setting anchor: BOTTOM\");\n      setPopupAnchor(\"top\");\n      setPopupOffset(20);\n    }\n  };\n\n  if (!isAdding) return null; // Don't show marker if not adding\n\n  return (\n    <>\n      <Marker\n        longitude={markerPosition.longitude}\n        latitude={markerPosition.latitude}\n        draggable\n        anchor=\"bottom\"\n        style={{ zIndex: \"10\" }}\n        onDragEnd={(e) => {\n          const newCoords = { longitude: e.lngLat.lng, latitude: e.lngLat.lat };\n          setMarkerPosition(newCoords);\n          updatePopupAnchor();\n        }}\n        onDrag={(e) => {\n          const newCoords = { longitude: e.lngLat.lng, latitude: e.lngLat.lat };\n          setMarkerPosition(newCoords);\n        }}\n      >\n        <Image\n          src=\"/marker.png\"\n          width={35}\n          height={35}\n          alt=\"Marker\"\n          ref={markerRef}\n        />\n      </Marker>\n      <Popup\n        longitude={markerPosition.longitude}\n        latitude={markerPosition.latitude}\n        closeButton\n        closeOnClick={false}\n        onClose={() => setIsAdding(false)}\n        anchor={popupAnchor}\n        offset={popupOffset}\n      >\n        <PopupForm\n          latitude={markerPosition.latitude}\n          longitude={markerPosition.longitude}\n          onClose={() => setIsAdding(false)}\n        />\n      </Popup>\n    </>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA,wOAAqC,iCAAiC;AAEtE;AAHA;AAAA;AAHA;;;;;;AASe,SAAS,uBAAuB,EAC7C,SAAS,EACT,QAAQ,EACR,WAAW,EACZ;IACC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;QACnD,WAAW,UAAU,SAAS;QAC9B,UAAU,UAAU,QAAQ;IAC9B;IACA,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAkB;IAC/D,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAE/C,MAAM,YAAY,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAAyB;IAEhD,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,kBAAkB;YAChB,WAAW,UAAU,SAAS;YAC9B,UAAU,UAAU,QAAQ;QAC9B;IACF,GAAG;QAAC;KAAU;IAEd,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR;IACF,GAAG;QAAC;KAAe;IAEnB,MAAM,oBAAoB;QACxB,IAAI,CAAC,UAAU,OAAO,EAAE;YACtB,QAAQ,IAAI,CAAC;YACb;QACF;QAEA,MAAM,aAAa,UAAU,OAAO,CAAC,qBAAqB;QAC1D,MAAM,eAAe,OAAO,WAAW;QAEvC,QAAQ,GAAG,CACT,2BACA,WAAW,GAAG,EACd,kBACA;QAGF,IAAI,WAAW,GAAG,GAAG,AAAC,eAAe,IAAK,GAAG;YAC3C,QAAQ,GAAG,CAAC;YACZ,eAAe;YACf,eAAe;QACjB,OAAO;YACL,QAAQ,GAAG,CAAC;YACZ,eAAe;YACf,eAAe;QACjB;IACF;IAEA,IAAI,CAAC,UAAU,OAAO,MAAM,kCAAkC;IAE9D,qBACE;;0BACE,8OAAC,gLAAA,CAAA,SAAM;gBACL,WAAW,eAAe,SAAS;gBACnC,UAAU,eAAe,QAAQ;gBACjC,SAAS;gBACT,QAAO;gBACP,OAAO;oBAAE,QAAQ;gBAAK;gBACtB,WAAW,CAAC;oBACV,MAAM,YAAY;wBAAE,WAAW,EAAE,MAAM,CAAC,GAAG;wBAAE,UAAU,EAAE,MAAM,CAAC,GAAG;oBAAC;oBACpE,kBAAkB;oBAClB;gBACF;gBACA,QAAQ,CAAC;oBACP,MAAM,YAAY;wBAAE,WAAW,EAAE,MAAM,CAAC,GAAG;wBAAE,UAAU,EAAE,MAAM,CAAC,GAAG;oBAAC;oBACpE,kBAAkB;gBACpB;0BAEA,cAAA,8OAAC,6HAAA,CAAA,UAAK;oBACJ,KAAI;oBACJ,OAAO;oBACP,QAAQ;oBACR,KAAI;oBACJ,KAAK;;;;;;;;;;;0BAGT,8OAAC,+KAAA,CAAA,QAAK;gBACJ,WAAW,eAAe,SAAS;gBACnC,UAAU,eAAe,QAAQ;gBACjC,WAAW;gBACX,cAAc;gBACd,SAAS,IAAM,YAAY;gBAC3B,QAAQ;gBACR,QAAQ;0BAER,cAAA,8OAAC,sIAAA,CAAA,UAAS;oBACR,UAAU,eAAe,QAAQ;oBACjC,WAAW,eAAe,SAAS;oBACnC,SAAS,IAAM,YAAY;;;;;;;;;;;;;AAKrC"}},
    {"offset": {"line": 394, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 405, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/public/officer.png.mjs%20%28structured%20image%20object%29"],"sourcesContent":["import src from \"IMAGE\";\nexport default { src, width: 64, height: 64, blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAABA0lEQVR42j2KvUsCcRzGfzeEDsKZnme1NFVD9rLVUlBQ/4C7c5yD/DBqEhJbtOjoEq0uTZcTRTnv0OkQ8ZxOfAFfFv8Bd8VN+Ho/QR/4wMPzeRAyY9myWvb3jk583qeEz/ucIN3crGid04PLG/+jNPoSygsC6Z7Di9vNwW5zMsGAaEQ+mkDAgZ8WbXMwmwO77d6V08VBTesBoZgq9Bk7u7OSFKIoJ+1yC2GhMpuMYWrCh+Oqg3axxKEzz9V9EPNa/leaK0obZLULr0lj/oBF7fz4+g5xWNQj/0NQpQLwGQNIz2UViKY7wOE/HXH+73YopkPyU4ZUvAShWAPe3qvwEq0DcUvPOXKW4ORclwAAAABJRU5ErkJggg==\", blurWidth: 8, blurHeight: 8 }\n"],"names":[],"mappings":";;;AAAA;;uCACe;IAAE,KAAA,8GAAA,CAAA,UAAG;IAAE,OAAO;IAAI,QAAQ;IAAI,aAAa;IAAkc,WAAW;IAAG,YAAY;AAAE"}},
    {"offset": {"line": 418, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 429, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/public/car.png.mjs%20%28structured%20image%20object%29"],"sourcesContent":["import src from \"IMAGE\";\nexport default { src, width: 64, height: 64, blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAABBUlEQVR42k2PuWoCYRSF/4AokyBxGTJDJMRXMIVVSBA7g0GTGLMVkyqmyQukSBcQBAcccMOxcEPRURQ3FMRO0EFt1EJ8A20UK+HqLwp+8HEv51QHoR0ygiAUKhWplsvJY4mEQIco1eT5y9cP+88FRe73T/y+u2dxti1PFUqN9Y1x+qutVbjZh3CzB7FGe/X4zjhxh24Mxk9PKDLIdoYgdEYgiCPIbeT4yODWYGTQk073Oo5GF2khD25vCFgfD4ViBSbx+Nyu1z8ju8nkaJfKy0QyM+MC/BSbSGVm3Vp9+WGxOBBF0Vqz1ebSXFxek2f0FRb/5gebi6JpLTraIJXKTvDdrzrM1pXKXXi29T9TAAAAAElFTkSuQmCC\", blurWidth: 8, blurHeight: 8 }\n"],"names":[],"mappings":";;;AAAA;;uCACe;IAAE,KAAA,0GAAA,CAAA,UAAG;IAAE,OAAO;IAAI,QAAQ;IAAI,aAAa;IAAkc,WAAW;IAAG,YAAY;AAAE"}},
    {"offset": {"line": 442, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 453, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/public/roadblock.png.mjs%20%28structured%20image%20object%29"],"sourcesContent":["import src from \"IMAGE\";\nexport default { src, width: 48, height: 48, blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAxElEQVR42k2PTwqCYBDFv++zSKJVglButBDCIIzcuAgzjP6RbcroAOIJatFKb+PaE3SAbuBCJOgc+USsBw9+82ZgZggpRCmhrDCpBKZ/NTlM2cK3OY9Vg2BkZVNuc3LiCvErUJ6RLoaRIYXgZNuJZZ7KxOw2zfQ8zt+P6ycLllnmWxk4vUxyU2iZhGeE99ZONNfUk9LmhjDY26wi9Mo19v54Nyzn1h+oLgxGVh+p6bOd2JNGlLEGDEZWDxQ/MYrHfjXEwF+c1CxBbgbuvwAAAABJRU5ErkJggg==\", blurWidth: 8, blurHeight: 8 }\n"],"names":[],"mappings":";;;AAAA;;uCACe;IAAE,KAAA,gHAAA,CAAA,UAAG;IAAE,OAAO;IAAI,QAAQ;IAAI,aAAa;IAA8W,WAAW;IAAG,YAAY;AAAE"}},
    {"offset": {"line": 466, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 477, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/public/caution.png.mjs%20%28structured%20image%20object%29"],"sourcesContent":["import src from \"IMAGE\";\nexport default { src, width: 48, height: 48, blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAA1UlEQVR42m3KPwsBYQAG8Pecw6UO50+OdNKhDMogg/+jRDFQLIz4BnwFE9ubUdksNm53C7kM6oYz33h1jI73Fqc89aunngcAU8J+0oeAf3GSuB1Os3M4y82dpNX+M2IfjQJTlncdRd51FdQx8yFA26j9srgV1p0Xsl/ktwGacBkjbsGwSTvSU/m6Jm6aOqIeatqkFeqjDaRYkj2vMsKTr+q3Tcnw4Cv6CaaFFOuIgnHTMxBhQrqukvfjkjOgfoFxadRwD4GXwukYQ3CxoPWLQQjOS1noN0q9SJ/GhODCAAAAAElFTkSuQmCC\", blurWidth: 8, blurHeight: 8 }\n"],"names":[],"mappings":";;;AAAA;;uCACe;IAAE,KAAA,8GAAA,CAAA,UAAG;IAAE,OAAO;IAAI,QAAQ;IAAI,aAAa;IAAkY,WAAW;IAAG,YAAY;AAAE"}},
    {"offset": {"line": 490, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 501, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/public/smoke.png.mjs%20%28structured%20image%20object%29"],"sourcesContent":["import src from \"IMAGE\";\nexport default { src, width: 80, height: 80, blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAABE0lEQVR42gEIAff+AAAAAAAAAAAACgsMDBgaHB8JCgsKAAAAAAAAAAAAAAAAAAAAAAASExQVho+Vn7O+xtmDi5GaGx0fIAICAgIAAAAAAAcICQhgZ2xyyNbf+LrM2P/H1d/7rrjAzjM3OjwAAAAAADg8P0PCz9frvs7a/7/BzP+4ydb/x9bh/6GqsbwYGxwdAG10eoDH1uD8v8HN/9qprv/Kt8D/vMjU/8vY4fhZXmNqALnFzd++ztr/x7rD//Gbl//qnp7/xbzG/8HR3f+zvsbWAImTmaeapq/RpZCW0cKVf9G/jYDRn5Wd0Zelr9GNlp2sAAsMDQ4PERIXDw8RFxEPDhcRDw8XDhARFw8REhcLDA0PWIh2COGodmEAAAAASUVORK5CYII=\", blurWidth: 8, blurHeight: 8 }\n"],"names":[],"mappings":";;;AAAA;;uCACe;IAAE,KAAA,4GAAA,CAAA,UAAG;IAAE,OAAO;IAAI,QAAQ;IAAI,aAAa;IAAsd,WAAW;IAAG,YAAY;AAAE"}},
    {"offset": {"line": 514, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 520, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useMemo, useCallback } from \"react\";\nimport { io } from \"socket.io-client\";\nimport { Map, Marker, Popup } from \"react-map-gl/maplibre\";\nimport \"maplibre-gl/dist/maplibre-gl.css\";\nimport { getReports } from \"@/actions/getReports\";\nimport { useSession } from \"./lib/auth-client\";\nimport { motion } from \"motion/react\";\nimport PopupForm from \"./components/map/PopupForm\";\nimport AddMarkerButton from \"./components/map/AddMarkerButton\";\nimport ReportSubmissionMarker from \"./components/map/ReportSubmissionMarker\";\nimport Image from \"next/image\";\nimport officer from \"../public/officer.png\";\nimport car from \"../public/car.png\";\nimport roadblock from \"../public/roadblock.png\";\nimport ice from \"../public/ice.png\";\nimport caution from \"../public/caution.png\";\nimport smoke from \"../public/smoke.png\";\nimport marker from \"../public/marker.png\";\n\nconst socket = io(\"http://localhost:3005\", {\n  reconnection: true,\n  reconnectionAttempts: 10,\n  reconnectionDelay: 2000,\n});\n\nconst Page = () => {\n  const { data: session, isPending, error } = useSession();\n  const userId = session?.user?.id || \"\";\n  const trustScore = session?.user?.trust;\n  const [mapCenter, setMapCenter] = useState({\n    longitude: process.env.NEXT_PUBLIC_MAP_CENTER_LONG,\n    latitude: process.env.NEXT_PUBLIC_MAP_CENTER_LAT,\n  });\n  const [showFormPopup, setShowFormPopup] = useState(!session);\n  const [reports, setReports] = useState([]);\n  const [newReportId, setNewReportId] = useState(null);\n  const [selectedReport, setSelectedReport] = useState(null);\n  const [isAdding, setIsAdding] = useState(false);\n\n  const getBoundsFromEnv = () => {\n    const sw = process.env.NEXT_PUBLIC_MAP_BOUNDS_SW?.split(\",\").map(Number);\n    const ne = process.env.NEXT_PUBLIC_MAP_BOUNDS_NE?.split(\",\").map(Number);\n\n    if (sw?.length === 2 && ne?.length === 2) {\n      return [\n        [sw[0], sw[1]],\n        [ne[0], ne[1]],\n      ];\n    }\n\n    return undefined;\n  };\n\n  const maxBounds = getBoundsFromEnv();\n\n  // Fetch report types only once on mount\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const serverReports = await getReports();\n        setReports(serverReports);\n      } catch (error) {\n        console.error(\"Error fetching report types:\", error);\n      }\n    };\n    fetchData();\n\n    // Listen for real-time updates from WebSockets\n    socket.on(\"new-report\", (data) => {\n      // Extract the report from the WebSocket event\n      const newReport = Array.isArray(data) ? data[1] : data;\n\n      setNewReportId(newReport.id);\n\n      setReports((prevReports) => {\n        if (prevReports.some((r) => r.id === newReport.id)) {\n          return prevReports; // Prevent duplicates\n        }\n        return [...prevReports, { ...newReport }];\n      });\n\n      setTimeout(() => setNewReportId(null), 2000);\n    });\n\n    return () => {\n      socket.off(\"new-report\"); // Clean up on unmount\n    };\n  }, []);\n\n  const reportTypeIcons = {\n    1: officer,\n    2: car,\n    3: roadblock,\n    4: ice,\n    5: caution,\n    6: smoke,\n  };\n\n  // Function to determine color based on trust level\n  const getMarkerColor = (trustScore: number) => {\n    if (trustScore >= 4) return \"green\";\n    if (trustScore >= 2) return \"orange\";\n    return \"red\";\n  };\n\n  // Function to determine opacity based on age of report\n  const getMarkerOpacity = (createdAt: string) => {\n    const reportDate = new Date(createdAt);\n    const now = new Date();\n    const hoursElapsed =\n      (now.getTime() - reportDate.getTime()) / (1000 * 60 * 60);\n\n    if (hoursElapsed < 1) return \"1\";\n    if (hoursElapsed < 3) return \"0.8\";\n    if (hoursElapsed < 6) return \"1\";\n    if (hoursElapsed < 12) return \"1\";\n    return \"1\";\n  };\n\n  // Handle the drag end event to update the marker's position\n\n  // Sync marker position with map center\n  const handleMapMove = (e: any) => {\n    setMapCenter({\n      longitude: e.viewState.longitude,\n      latitude: e.viewState.latitude,\n    });\n  };\n\n  const memoizedMarkers = useMemo(\n    () =>\n      reports.map((report) => {\n        const iconSrc = reportTypeIcons[report.reportTypeId] || \"/marker.png\";\n\n        return (\n          <Marker\n            key={report.id}\n            longitude={report.long}\n            latitude={report.lat}\n            color={getMarkerColor(report.trustScore)}\n            opacity={getMarkerOpacity(report.createdAt)}\n            anchor=\"bottom\"\n            onClick={() => setSelectedReport(report)}\n            // initial={{ opacity: 0, scale: 1.5 }}\n            // animate={{ opacity: 1, scale: 1 }}\n            // transition={{ duration: 2.5 }}\n          >\n            <img\n              src={reportTypeIcons}\n              alt=\"Report Marker\"\n              style={{ width: \"40px\", height: \"40px\" }} // Adjust size as needed\n            />\n          </Marker>\n        );\n      }),\n    [reports]\n  );\n\n  // Make marker draggable rather than centered in map\n  // const handleDragEnd = (e: any) => {\n  //   const { lng, lat } = e.lngLat;\n  //   setLongitude(lng);\n  //   setLatitude(lat);\n  // };\n\n  return (\n    <div className=\"h-[calc(100vh-66px)] w-screen relative\">\n      <div className=\"absolute left-10 top-10 z-10\"></div>\n      <Map\n        initialViewState={{\n          longitude: mapCenter.longitude,\n          latitude: mapCenter.latitude,\n          zoom: 13,\n        }}\n        minZoom={process.env.NEXT_PUBLIC_MAP_MIN_ZOOM || 10}\n        maxZoom={process.env.NEXT_PUBLIC_MAP_MAX_ZOOM || 18}\n        maxBounds={maxBounds}\n        onMove={handleMapMove}\n        style={{ width: \"100%\", height: \"100%\", position: \"relative\" }}\n        mapStyle={`https://api.maptiler.com/maps/streets/style.json?key=${process.env.NEXT_PUBLIC_MAPTILER_KEY}`}\n      >\n        {memoizedMarkers}\n\n        {/* ‚úÖ Display popup if a report is selected */}\n        {selectedReport && (\n          <Popup\n            longitude={selectedReport.long}\n            latitude={selectedReport.lat}\n            closeButton={true}\n            closeOnClick={false}\n            onClose={() => setSelectedReport(null)}\n            anchor=\"top\"\n          >\n            <div className=\"p-3 bg-white rounded shadow\">\n              <h3 className=\"font-bold\">Food Truck Report</h3>\n              <p className=\"text-sm\">\n                {selectedReport.description || \"No description provided\"}\n              </p>\n              <p>Submitted: {selectedReport.createdAt[0]}</p>\n              <p>Most recent confirmation: </p>\n              {session && (\n                <div className=\"flex justify-between mt-2\">\n                  <button\n                    className=\"bg-green-500 text-white px-3 py-1 rounded\"\n                    //onClick={() => handleVote(selectedReport.id, \"confirm\")}\n                  >\n                    ‚úÖ I See It\n                  </button>\n                  <button\n                    className=\"bg-red-500 text-white px-3 py-1 rounded\"\n                    //onClick={() => handleVote(selectedReport.id, \"disconfirm\")}\n                  >\n                    ‚ùå I Don&apos;t See It\n                  </button>\n                </div>\n              )}\n            </div>\n          </Popup>\n        )}\n\n        {session ? (\n          <>\n            <AddMarkerButton\n              isAdding={isAdding}\n              toggleMarker={() => setIsAdding(!isAdding)}\n            />\n            <ReportSubmissionMarker\n              mapCenter={mapCenter}\n              isAdding={isAdding}\n              setIsAdding={setIsAdding}\n            />\n          </>\n        ) : (\n          <>\n            {showFormPopup && (\n              <div className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white p-4 rounded-sm shadow-sm\">\n                <button\n                  onClick={() => setShowFormPopup(false)}\n                  className=\"absolute top-2 right-2 text-gray-500 hover:text-gray-800\"\n                >\n                  ‚úï\n                </button>\n                <p className=\"text-black\">\n                  Please sign in to interact with the map.\n                </p>\n              </div>\n            )}\n          </>\n        )}\n      </Map>\n    </div>\n  );\n};\n\nexport default Page;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 867, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}