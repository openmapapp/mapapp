{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/access/index.mjs"],"sourcesContent":["import { B as BetterAuthError } from '../../shared/better-auth.DdzSJf-n.mjs';\n\nfunction role(statements) {\n  return {\n    authorize(request, connector = \"AND\") {\n      let success = false;\n      for (const [requestedResource, requestedActions] of Object.entries(\n        request\n      )) {\n        const allowedActions = statements[requestedResource];\n        if (!allowedActions) {\n          return {\n            success: false,\n            error: `You are not allowed to access resource: ${requestedResource}`\n          };\n        }\n        if (Array.isArray(requestedActions)) {\n          success = requestedActions.every(\n            (requestedAction) => allowedActions.includes(requestedAction)\n          );\n        } else {\n          if (typeof requestedActions === \"object\") {\n            const actions = requestedActions;\n            if (actions.connector === \"OR\") {\n              success = actions.actions.some(\n                (requestedAction) => allowedActions.includes(requestedAction)\n              );\n            } else {\n              success = actions.actions.every(\n                (requestedAction) => allowedActions.includes(requestedAction)\n              );\n            }\n          } else {\n            throw new BetterAuthError(\"Invalid access control request\");\n          }\n        }\n        if (success && connector === \"OR\") {\n          return { success };\n        }\n        if (!success && connector === \"AND\") {\n          return {\n            success: false,\n            error: `unauthorized to access resource \"${requestedResource}\"`\n          };\n        }\n      }\n      if (success) {\n        return {\n          success\n        };\n      }\n      return {\n        success: false,\n        error: \"Not authorized\"\n      };\n    },\n    statements\n  };\n}\nfunction createAccessControl(s) {\n  return {\n    newRole(statements) {\n      return role(statements);\n    },\n    statements: s\n  };\n}\n\nexport { createAccessControl, role };\n"],"names":[],"mappings":";;;;AAAA;;AAEA,SAAS,KAAK,UAAU;IACtB,OAAO;QACL,WAAU,OAAO,EAAE,YAAY,KAAK;YAClC,IAAI,UAAU;YACd,KAAK,MAAM,CAAC,mBAAmB,iBAAiB,IAAI,OAAO,OAAO,CAChE,SACC;gBACD,MAAM,iBAAiB,UAAU,CAAC,kBAAkB;gBACpD,IAAI,CAAC,gBAAgB;oBACnB,OAAO;wBACL,SAAS;wBACT,OAAO,CAAC,wCAAwC,EAAE,mBAAmB;oBACvE;gBACF;gBACA,IAAI,MAAM,OAAO,CAAC,mBAAmB;oBACnC,UAAU,iBAAiB,KAAK,CAC9B,CAAC,kBAAoB,eAAe,QAAQ,CAAC;gBAEjD,OAAO;oBACL,IAAI,OAAO,qBAAqB,UAAU;wBACxC,MAAM,UAAU;wBAChB,IAAI,QAAQ,SAAS,KAAK,MAAM;4BAC9B,UAAU,QAAQ,OAAO,CAAC,IAAI,CAC5B,CAAC,kBAAoB,eAAe,QAAQ,CAAC;wBAEjD,OAAO;4BACL,UAAU,QAAQ,OAAO,CAAC,KAAK,CAC7B,CAAC,kBAAoB,eAAe,QAAQ,CAAC;wBAEjD;oBACF,OAAO;wBACL,MAAM,IAAI,oLAAA,CAAA,IAAe,CAAC;oBAC5B;gBACF;gBACA,IAAI,WAAW,cAAc,MAAM;oBACjC,OAAO;wBAAE;oBAAQ;gBACnB;gBACA,IAAI,CAAC,WAAW,cAAc,OAAO;oBACnC,OAAO;wBACL,SAAS;wBACT,OAAO,CAAC,iCAAiC,EAAE,kBAAkB,CAAC,CAAC;oBACjE;gBACF;YACF;YACA,IAAI,SAAS;gBACX,OAAO;oBACL;gBACF;YACF;YACA,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QACA;IACF;AACF;AACA,SAAS,oBAAoB,CAAC;IAC5B,OAAO;QACL,SAAQ,UAAU;YAChB,OAAO,KAAK;QACd;QACA,YAAY;IACd;AACF","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/organization/access/index.mjs"],"sourcesContent":["import { createAccessControl } from '../../access/index.mjs';\nimport '../../../shared/better-auth.DdzSJf-n.mjs';\n\nconst defaultStatements = {\n  organization: [\"update\", \"delete\"],\n  member: [\"create\", \"update\", \"delete\"],\n  invitation: [\"create\", \"cancel\"],\n  team: [\"create\", \"update\", \"delete\"]\n};\nconst defaultAc = createAccessControl(defaultStatements);\nconst adminAc = defaultAc.newRole({\n  organization: [\"update\"],\n  invitation: [\"create\", \"cancel\"],\n  member: [\"create\", \"update\", \"delete\"],\n  team: [\"create\", \"update\", \"delete\"]\n});\nconst ownerAc = defaultAc.newRole({\n  organization: [\"update\", \"delete\"],\n  member: [\"create\", \"update\", \"delete\"],\n  invitation: [\"create\", \"cancel\"],\n  team: [\"create\", \"update\", \"delete\"]\n});\nconst memberAc = defaultAc.newRole({\n  organization: [],\n  member: [],\n  invitation: [],\n  team: []\n});\nconst defaultRoles = {\n  admin: adminAc,\n  owner: ownerAc,\n  member: memberAc\n};\n\nexport { adminAc, defaultAc, defaultRoles, defaultStatements, memberAc, ownerAc };\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEA,MAAM,oBAAoB;IACxB,cAAc;QAAC;QAAU;KAAS;IAClC,QAAQ;QAAC;QAAU;QAAU;KAAS;IACtC,YAAY;QAAC;QAAU;KAAS;IAChC,MAAM;QAAC;QAAU;QAAU;KAAS;AACtC;AACA,MAAM,YAAY,CAAA,GAAA,uKAAA,CAAA,sBAAmB,AAAD,EAAE;AACtC,MAAM,UAAU,UAAU,OAAO,CAAC;IAChC,cAAc;QAAC;KAAS;IACxB,YAAY;QAAC;QAAU;KAAS;IAChC,QAAQ;QAAC;QAAU;QAAU;KAAS;IACtC,MAAM;QAAC;QAAU;QAAU;KAAS;AACtC;AACA,MAAM,UAAU,UAAU,OAAO,CAAC;IAChC,cAAc;QAAC;QAAU;KAAS;IAClC,QAAQ;QAAC;QAAU;QAAU;KAAS;IACtC,YAAY;QAAC;QAAU;KAAS;IAChC,MAAM;QAAC;QAAU;QAAU;KAAS;AACtC;AACA,MAAM,WAAW,UAAU,OAAO,CAAC;IACjC,cAAc,EAAE;IAChB,QAAQ,EAAE;IACV,YAAY,EAAE;IACd,MAAM,EAAE;AACV;AACA,MAAM,eAAe;IACnB,OAAO;IACP,OAAO;IACP,QAAQ;AACV","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 169, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/two-factor/index.mjs"],"sourcesContent":["import { g as generateRandomString } from '../../shared/better-auth.B4Qoxdgc.mjs';\nimport { z } from 'zod';\nimport { a as createAuthEndpoint, s as sessionMiddleware, c as createAuthMiddleware, B as BASE_ERROR_CODES } from '../../shared/better-auth.C92a320y.mjs';\nimport { APIError } from 'better-call';\nimport { setSessionCookie, deleteSessionCookie } from '../../cookies/index.mjs';\nimport { m as mergeSchema } from '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport { symmetricEncrypt, symmetricDecrypt } from '../../crypto/index.mjs';\nimport { v as verifyTwoFactorMiddleware, T as TRUST_DEVICE_COOKIE_NAME, a as TWO_FACTOR_COOKIE_NAME } from '../../shared/better-auth.-VszM4Ix.mjs';\nimport { T as TWO_FACTOR_ERROR_CODES } from '../../shared/better-auth.BcoSd9tC.mjs';\nimport '@better-auth/utils/hash';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@better-auth/utils/base64';\nimport 'jose';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport { createOTP } from '@better-auth/utils/otp';\nimport { v as validatePassword } from '../../shared/better-auth.YwDQhoPc.mjs';\nimport { createHMAC } from '@better-auth/utils/hmac';\nexport { t as twoFactorClient } from '../../shared/better-auth.Ddw8bVyV.mjs';\nimport '@better-auth/utils/random';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '../../shared/better-auth.CW6D9eSx.mjs';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport '../../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '@better-auth/utils/binary';\nimport '../../shared/better-auth.OT3XFeFk.mjs';\n\nfunction generateBackupCodesFn(options) {\n  return Array.from({ length: options?.amount ?? 10 }).fill(null).map(() => generateRandomString(options?.length ?? 10, \"a-z\", \"0-9\", \"A-Z\")).map((code) => `${code.slice(0, 5)}-${code.slice(5)}`);\n}\nasync function generateBackupCodes(secret, options) {\n  const key = secret;\n  const backupCodes = options?.customBackupCodesGenerate ? options.customBackupCodesGenerate() : generateBackupCodesFn(options);\n  const encCodes = await symmetricEncrypt({\n    data: JSON.stringify(backupCodes),\n    key\n  });\n  return {\n    backupCodes,\n    encryptedBackupCodes: encCodes\n  };\n}\nasync function verifyBackupCode(data, key) {\n  const codes = await getBackupCodes(data.backupCodes, key);\n  if (!codes) {\n    return {\n      status: false,\n      updated: null\n    };\n  }\n  return {\n    status: codes.includes(data.code),\n    updated: codes.filter((code) => code !== data.code)\n  };\n}\nasync function getBackupCodes(backupCodes, key) {\n  const secret = new TextDecoder(\"utf-8\").decode(\n    new TextEncoder().encode(\n      await symmetricDecrypt({ key, data: backupCodes })\n    )\n  );\n  const data = JSON.parse(secret);\n  const result = z.array(z.string()).safeParse(data);\n  if (result.success) {\n    return result.data;\n  }\n  return null;\n}\nconst backupCode2fa = (options) => {\n  const twoFactorTable = \"twoFactor\";\n  return {\n    id: \"backup_code\",\n    endpoints: {\n      verifyBackupCode: createAuthEndpoint(\n        \"/two-factor/verify-backup-code\",\n        {\n          method: \"POST\",\n          body: z.object({\n            code: z.string(),\n            /**\n             * Disable setting the session cookie\n             */\n            disableSession: z.boolean({\n              description: \"If true, the session cookie will not be set.\"\n            }).optional(),\n            /**\n             * if true, the device will be trusted\n             * for 30 days. It'll be refreshed on\n             * every sign in request within this time.\n             */\n            trustDevice: z.boolean({\n              description: \"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time.\"\n            }).optional()\n          }),\n          use: [verifyTwoFactorMiddleware]\n        },\n        async (ctx) => {\n          const user = ctx.context.session.user;\n          const twoFactor = await ctx.context.adapter.findOne({\n            model: twoFactorTable,\n            where: [\n              {\n                field: \"userId\",\n                value: user.id\n              }\n            ]\n          });\n          if (!twoFactor) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: TWO_FACTOR_ERROR_CODES.BACKUP_CODES_NOT_ENABLED\n            });\n          }\n          const validate = await verifyBackupCode(\n            {\n              backupCodes: twoFactor.backupCodes,\n              code: ctx.body.code\n            },\n            ctx.context.secret\n          );\n          if (!validate.status) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: TWO_FACTOR_ERROR_CODES.INVALID_BACKUP_CODE\n            });\n          }\n          const updatedBackupCodes = await symmetricEncrypt({\n            key: ctx.context.secret,\n            data: JSON.stringify(validate.updated)\n          });\n          await ctx.context.adapter.updateMany({\n            model: twoFactorTable,\n            update: {\n              backupCodes: updatedBackupCodes\n            },\n            where: [\n              {\n                field: \"userId\",\n                value: user.id\n              }\n            ]\n          });\n          if (!ctx.body.disableSession) {\n            await setSessionCookie(ctx, {\n              session: ctx.context.session.session,\n              user\n            });\n          }\n          return ctx.json({\n            user,\n            session: ctx.context.session\n          });\n        }\n      ),\n      generateBackupCodes: createAuthEndpoint(\n        \"/two-factor/generate-backup-codes\",\n        {\n          method: \"POST\",\n          body: z.object({\n            password: z.string()\n          }),\n          use: [sessionMiddleware]\n        },\n        async (ctx) => {\n          const user = ctx.context.session.user;\n          if (!user.twoFactorEnabled) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: TWO_FACTOR_ERROR_CODES.TWO_FACTOR_NOT_ENABLED\n            });\n          }\n          await ctx.context.password.checkPassword(user.id, ctx);\n          const backupCodes = await generateBackupCodes(\n            ctx.context.secret,\n            options\n          );\n          await ctx.context.adapter.update({\n            model: twoFactorTable,\n            update: {\n              backupCodes: backupCodes.encryptedBackupCodes\n            },\n            where: [\n              {\n                field: \"userId\",\n                value: ctx.context.session.user.id\n              }\n            ]\n          });\n          return ctx.json({\n            status: true,\n            backupCodes: backupCodes.backupCodes\n          });\n        }\n      ),\n      viewBackupCodes: createAuthEndpoint(\n        \"/two-factor/view-backup-codes\",\n        {\n          method: \"GET\",\n          body: z.object({\n            userId: z.string()\n          }),\n          metadata: {\n            SERVER_ONLY: true\n          }\n        },\n        async (ctx) => {\n          const twoFactor = await ctx.context.adapter.findOne({\n            model: twoFactorTable,\n            where: [\n              {\n                field: \"userId\",\n                value: ctx.body.userId\n              }\n            ]\n          });\n          if (!twoFactor) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: \"Backup codes aren't enabled\"\n            });\n          }\n          const backupCodes = await getBackupCodes(\n            twoFactor.backupCodes,\n            ctx.context.secret\n          );\n          if (!backupCodes) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: TWO_FACTOR_ERROR_CODES.BACKUP_CODES_NOT_ENABLED\n            });\n          }\n          return ctx.json({\n            status: true,\n            backupCodes\n          });\n        }\n      )\n    }\n  };\n};\n\nconst otp2fa = (options) => {\n  const opts = {\n    ...options,\n    digits: options?.digits || 6,\n    period: (options?.period || 3) * 60 * 1e3\n  };\n  const twoFactorTable = \"twoFactor\";\n  const send2FaOTP = createAuthEndpoint(\n    \"/two-factor/send-otp\",\n    {\n      method: \"POST\",\n      body: z.object({\n        /**\n         * if true, the device will be trusted\n         * for 30 days. It'll be refreshed on\n         * every sign in request within this time.\n         */\n        trustDevice: z.boolean().optional()\n      }).optional(),\n      use: [verifyTwoFactorMiddleware],\n      metadata: {\n        openapi: {\n          summary: \"Send two factor OTP\",\n          description: \"Send two factor OTP to the user\",\n          responses: {\n            200: {\n              description: \"Successful response\",\n              content: {\n                \"application/json\": {\n                  schema: {\n                    type: \"object\",\n                    properties: {\n                      status: {\n                        type: \"boolean\"\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    async (ctx) => {\n      if (!options || !options.sendOTP) {\n        ctx.context.logger.error(\n          \"send otp isn't configured. Please configure the send otp function on otp options.\"\n        );\n        throw new APIError(\"BAD_REQUEST\", {\n          message: \"otp isn't configured\"\n        });\n      }\n      const user = ctx.context.session.user;\n      const twoFactor = await ctx.context.adapter.findOne({\n        model: twoFactorTable,\n        where: [\n          {\n            field: \"userId\",\n            value: user.id\n          }\n        ]\n      });\n      if (!twoFactor) {\n        throw new APIError(\"BAD_REQUEST\", {\n          message: TWO_FACTOR_ERROR_CODES.OTP_NOT_ENABLED\n        });\n      }\n      const code = generateRandomString(opts.digits, \"0-9\");\n      await ctx.context.internalAdapter.createVerificationValue({\n        value: code,\n        identifier: `2fa-otp-${user.id}`,\n        expiresAt: new Date(Date.now() + opts.period)\n      });\n      await options.sendOTP({ user, otp: code }, ctx.request);\n      return ctx.json({ status: true });\n    }\n  );\n  const verifyOTP = createAuthEndpoint(\n    \"/two-factor/verify-otp\",\n    {\n      method: \"POST\",\n      body: z.object({\n        code: z.string({\n          description: \"The otp code to verify\"\n        }),\n        /**\n         * if true, the device will be trusted\n         * for 30 days. It'll be refreshed on\n         * every sign in request within this time.\n         */\n        trustDevice: z.boolean().optional()\n      }),\n      use: [verifyTwoFactorMiddleware],\n      metadata: {\n        openapi: {\n          summary: \"Verify two factor OTP\",\n          description: \"Verify two factor OTP\",\n          responses: {\n            200: {\n              description: \"Success\",\n              content: {\n                \"application/json\": {\n                  schema: {\n                    type: \"object\",\n                    properties: {\n                      status: {\n                        type: \"boolean\"\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    async (ctx) => {\n      const user = ctx.context.session.user;\n      const twoFactor = await ctx.context.adapter.findOne({\n        model: twoFactorTable,\n        where: [\n          {\n            field: \"userId\",\n            value: user.id\n          }\n        ]\n      });\n      if (!twoFactor) {\n        throw new APIError(\"BAD_REQUEST\", {\n          message: TWO_FACTOR_ERROR_CODES.OTP_NOT_ENABLED\n        });\n      }\n      const toCheckOtp = await ctx.context.internalAdapter.findVerificationValue(\n        `2fa-otp-${user.id}`\n      );\n      if (!toCheckOtp || toCheckOtp.expiresAt < /* @__PURE__ */ new Date()) {\n        throw new APIError(\"BAD_REQUEST\", {\n          message: TWO_FACTOR_ERROR_CODES.OTP_HAS_EXPIRED\n        });\n      }\n      if (toCheckOtp.value === ctx.body.code) {\n        if (!user.twoFactorEnabled) {\n          const updatedUser = await ctx.context.internalAdapter.updateUser(\n            user.id,\n            {\n              twoFactorEnabled: true\n            }\n          );\n          const newSession = await ctx.context.internalAdapter.createSession(\n            user.id,\n            ctx.request,\n            false,\n            ctx.context.session.session\n          );\n          await ctx.context.internalAdapter.deleteSession(\n            ctx.context.session.session.token\n          );\n          await setSessionCookie(ctx, {\n            session: newSession,\n            user: updatedUser\n          });\n        }\n        return ctx.context.valid(ctx);\n      } else {\n        return ctx.context.invalid();\n      }\n    }\n  );\n  return {\n    id: \"otp\",\n    endpoints: {\n      sendTwoFactorOTP: send2FaOTP,\n      verifyTwoFactorOTP: verifyOTP\n    }\n  };\n};\n\nconst totp2fa = (options) => {\n  const opts = {\n    ...options,\n    digits: options?.digits || 6,\n    period: options?.period || 30\n  };\n  const twoFactorTable = \"twoFactor\";\n  const generateTOTP = createAuthEndpoint(\n    \"/totp/generate\",\n    {\n      method: \"POST\",\n      use: [sessionMiddleware],\n      metadata: {\n        openapi: {\n          summary: \"Generate TOTP code\",\n          description: \"Use this endpoint to generate a TOTP code\",\n          responses: {\n            200: {\n              description: \"Successful response\",\n              content: {\n                \"application/json\": {\n                  schema: {\n                    type: \"object\",\n                    properties: {\n                      code: {\n                        type: \"string\"\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    async (ctx) => {\n      if (options?.disable) {\n        ctx.context.logger.error(\n          \"totp isn't configured. please pass totp option on two factor plugin to enable totp\"\n        );\n        throw new APIError(\"BAD_REQUEST\", {\n          message: \"totp isn't configured\"\n        });\n      }\n      const user = ctx.context.session.user;\n      const twoFactor = await ctx.context.adapter.findOne({\n        model: twoFactorTable,\n        where: [\n          {\n            field: \"userId\",\n            value: user.id\n          }\n        ]\n      });\n      if (!twoFactor) {\n        throw new APIError(\"BAD_REQUEST\", {\n          message: TWO_FACTOR_ERROR_CODES.TOTP_NOT_ENABLED\n        });\n      }\n      const code = await createOTP(twoFactor.secret, {\n        period: opts.period,\n        digits: opts.digits\n      }).totp();\n      return { code };\n    }\n  );\n  const getTOTPURI = createAuthEndpoint(\n    \"/two-factor/get-totp-uri\",\n    {\n      method: \"POST\",\n      use: [sessionMiddleware],\n      body: z.object({\n        password: z.string({\n          description: \"User password\"\n        })\n      }),\n      metadata: {\n        openapi: {\n          summary: \"Get TOTP URI\",\n          description: \"Use this endpoint to get the TOTP URI\",\n          responses: {\n            200: {\n              description: \"Successful response\",\n              content: {\n                \"application/json\": {\n                  schema: {\n                    type: \"object\",\n                    properties: {\n                      totpURI: {\n                        type: \"string\"\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    async (ctx) => {\n      if (options?.disable) {\n        ctx.context.logger.error(\n          \"totp isn't configured. please pass totp option on two factor plugin to enable totp\"\n        );\n        throw new APIError(\"BAD_REQUEST\", {\n          message: \"totp isn't configured\"\n        });\n      }\n      const user = ctx.context.session.user;\n      const twoFactor = await ctx.context.adapter.findOne({\n        model: twoFactorTable,\n        where: [\n          {\n            field: \"userId\",\n            value: user.id\n          }\n        ]\n      });\n      if (!twoFactor || !user.twoFactorEnabled) {\n        throw new APIError(\"BAD_REQUEST\", {\n          message: TWO_FACTOR_ERROR_CODES.TOTP_NOT_ENABLED\n        });\n      }\n      const secret = await symmetricDecrypt({\n        key: ctx.context.secret,\n        data: twoFactor.secret\n      });\n      await ctx.context.password.checkPassword(user.id, ctx);\n      const totpURI = createOTP(secret, {\n        digits: opts.digits,\n        period: opts.period\n      }).url(options?.issuer || ctx.context.appName, user.email);\n      return {\n        totpURI\n      };\n    }\n  );\n  const verifyTOTP = createAuthEndpoint(\n    \"/two-factor/verify-totp\",\n    {\n      method: \"POST\",\n      body: z.object({\n        code: z.string({\n          description: \"The otp code to verify\"\n        }),\n        /**\n         * if true, the device will be trusted\n         * for 30 days. It'll be refreshed on\n         * every sign in request within this time.\n         */\n        trustDevice: z.boolean({\n          description: \"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time.\"\n        }).optional()\n      }),\n      use: [verifyTwoFactorMiddleware],\n      metadata: {\n        openapi: {\n          summary: \"Verify two factor TOTP\",\n          description: \"Verify two factor TOTP\",\n          responses: {\n            200: {\n              description: \"Successful response\",\n              content: {\n                \"application/json\": {\n                  schema: {\n                    type: \"object\",\n                    properties: {\n                      status: {\n                        type: \"boolean\"\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    async (ctx) => {\n      if (options?.disable) {\n        ctx.context.logger.error(\n          \"totp isn't configured. please pass totp option on two factor plugin to enable totp\"\n        );\n        throw new APIError(\"BAD_REQUEST\", {\n          message: \"totp isn't configured\"\n        });\n      }\n      const user = ctx.context.session.user;\n      const twoFactor = await ctx.context.adapter.findOne({\n        model: twoFactorTable,\n        where: [\n          {\n            field: \"userId\",\n            value: user.id\n          }\n        ]\n      });\n      if (!twoFactor) {\n        throw new APIError(\"BAD_REQUEST\", {\n          message: TWO_FACTOR_ERROR_CODES.TOTP_NOT_ENABLED\n        });\n      }\n      const decrypted = await symmetricDecrypt({\n        key: ctx.context.secret,\n        data: twoFactor.secret\n      });\n      const status = await createOTP(decrypted, {\n        period: opts.period,\n        digits: opts.digits\n      }).verify(ctx.body.code);\n      if (!status) {\n        return ctx.context.invalid();\n      }\n      if (!user.twoFactorEnabled) {\n        const updatedUser = await ctx.context.internalAdapter.updateUser(\n          user.id,\n          {\n            twoFactorEnabled: true\n          },\n          ctx\n        );\n        const newSession = await ctx.context.internalAdapter.createSession(\n          user.id,\n          ctx.request,\n          false,\n          ctx.context.session.session\n        ).catch((e) => {\n          throw e;\n        });\n        await ctx.context.internalAdapter.deleteSession(\n          ctx.context.session.session.token\n        );\n        await setSessionCookie(ctx, {\n          session: newSession,\n          user: updatedUser\n        });\n      }\n      return ctx.context.valid(ctx);\n    }\n  );\n  return {\n    id: \"totp\",\n    endpoints: {\n      generateTOTP,\n      getTOTPURI,\n      verifyTOTP\n    }\n  };\n};\n\nconst schema = {\n  user: {\n    fields: {\n      twoFactorEnabled: {\n        type: \"boolean\",\n        required: false,\n        defaultValue: false,\n        input: false\n      }\n    }\n  },\n  twoFactor: {\n    fields: {\n      secret: {\n        type: \"string\",\n        required: true,\n        returned: false\n      },\n      backupCodes: {\n        type: \"string\",\n        required: true,\n        returned: false\n      },\n      userId: {\n        type: \"string\",\n        required: true,\n        returned: false,\n        references: {\n          model: \"user\",\n          field: \"id\"\n        }\n      }\n    }\n  }\n};\n\nconst twoFactor = (options) => {\n  const opts = {\n    twoFactorTable: \"twoFactor\"\n  };\n  const totp = totp2fa(options?.totpOptions);\n  const backupCode = backupCode2fa(options?.backupCodeOptions);\n  const otp = otp2fa(options?.otpOptions);\n  return {\n    id: \"two-factor\",\n    endpoints: {\n      ...totp.endpoints,\n      ...otp.endpoints,\n      ...backupCode.endpoints,\n      enableTwoFactor: createAuthEndpoint(\n        \"/two-factor/enable\",\n        {\n          method: \"POST\",\n          body: z.object({\n            password: z.string({\n              description: \"User password\"\n            })\n          }),\n          use: [sessionMiddleware],\n          metadata: {\n            openapi: {\n              summary: \"Enable two factor authentication\",\n              description: \"Use this endpoint to enable two factor authentication. This will generate a TOTP URI and backup codes. Once the user verifies the TOTP URI, the two factor authentication will be enabled.\",\n              responses: {\n                200: {\n                  description: \"Successful response\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          totpURI: {\n                            type: \"string\",\n                            description: \"TOTP URI\"\n                          },\n                          backupCodes: {\n                            type: \"array\",\n                            items: {\n                              type: \"string\"\n                            },\n                            description: \"Backup codes\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const user = ctx.context.session.user;\n          const { password } = ctx.body;\n          const isPasswordValid = await validatePassword(ctx, {\n            password,\n            userId: user.id\n          });\n          if (!isPasswordValid) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: BASE_ERROR_CODES.INVALID_PASSWORD\n            });\n          }\n          const secret = generateRandomString(32);\n          const encryptedSecret = await symmetricEncrypt({\n            key: ctx.context.secret,\n            data: secret\n          });\n          const backupCodes = await generateBackupCodes(\n            ctx.context.secret,\n            options?.backupCodeOptions\n          );\n          if (options?.skipVerificationOnEnable) {\n            const updatedUser = await ctx.context.internalAdapter.updateUser(\n              user.id,\n              {\n                twoFactorEnabled: true\n              },\n              ctx\n            );\n            const newSession = await ctx.context.internalAdapter.createSession(\n              updatedUser.id,\n              ctx.request,\n              false,\n              ctx.context.session.session\n            );\n            await setSessionCookie(ctx, {\n              session: newSession,\n              user: updatedUser\n            });\n            await ctx.context.internalAdapter.deleteSession(\n              ctx.context.session.session.token\n            );\n          }\n          await ctx.context.adapter.deleteMany({\n            model: opts.twoFactorTable,\n            where: [\n              {\n                field: \"userId\",\n                value: user.id\n              }\n            ]\n          });\n          await ctx.context.adapter.create({\n            model: opts.twoFactorTable,\n            data: {\n              secret: encryptedSecret,\n              backupCodes: backupCodes.encryptedBackupCodes,\n              userId: user.id\n            }\n          });\n          const totpURI = createOTP(secret, {\n            digits: options?.totpOptions?.digits || 6,\n            period: options?.totpOptions?.period\n          }).url(options?.issuer || ctx.context.appName, user.email);\n          return ctx.json({ totpURI, backupCodes: backupCodes.backupCodes });\n        }\n      ),\n      disableTwoFactor: createAuthEndpoint(\n        \"/two-factor/disable\",\n        {\n          method: \"POST\",\n          body: z.object({\n            password: z.string({\n              description: \"User password\"\n            }).min(8)\n          }),\n          use: [sessionMiddleware],\n          metadata: {\n            openapi: {\n              summary: \"Disable two factor authentication\",\n              description: \"Use this endpoint to disable two factor authentication.\",\n              responses: {\n                200: {\n                  description: \"Successful response\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          status: {\n                            type: \"boolean\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const user = ctx.context.session.user;\n          const { password } = ctx.body;\n          const isPasswordValid = await validatePassword(ctx, {\n            password,\n            userId: user.id\n          });\n          if (!isPasswordValid) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: \"Invalid password\"\n            });\n          }\n          const updatedUser = await ctx.context.internalAdapter.updateUser(\n            user.id,\n            {\n              twoFactorEnabled: false\n            },\n            ctx\n          );\n          await ctx.context.adapter.delete({\n            model: opts.twoFactorTable,\n            where: [\n              {\n                field: \"userId\",\n                value: updatedUser.id\n              }\n            ]\n          });\n          const newSession = await ctx.context.internalAdapter.createSession(\n            updatedUser.id,\n            ctx.request,\n            false,\n            ctx.context.session.session\n          );\n          await setSessionCookie(ctx, {\n            session: newSession,\n            user: updatedUser\n          });\n          await ctx.context.internalAdapter.deleteSession(\n            ctx.context.session.session.token\n          );\n          return ctx.json({ status: true });\n        }\n      )\n    },\n    options,\n    hooks: {\n      after: [\n        {\n          matcher(context) {\n            return context.path === \"/sign-in/email\" || context.path === \"/sign-in/username\" || context.path === \"/sign-in/phone-number\";\n          },\n          handler: createAuthMiddleware(async (ctx) => {\n            const data = ctx.context.newSession;\n            if (!data) {\n              return;\n            }\n            if (!data?.user.twoFactorEnabled) {\n              return;\n            }\n            const trustDeviceCookieName = ctx.context.createAuthCookie(\n              TRUST_DEVICE_COOKIE_NAME\n            );\n            const trustDeviceCookie = await ctx.getSignedCookie(\n              trustDeviceCookieName.name,\n              ctx.context.secret\n            );\n            if (trustDeviceCookie) {\n              const [token, sessionToken] = trustDeviceCookie.split(\"!\");\n              const expectedToken = await createHMAC(\n                \"SHA-256\",\n                \"base64urlnopad\"\n              ).sign(ctx.context.secret, `${data.user.id}!${sessionToken}`);\n              if (token === expectedToken) {\n                const newToken = await createHMAC(\n                  \"SHA-256\",\n                  \"base64urlnopad\"\n                ).sign(ctx.context.secret, `${data.user.id}!${sessionToken}`);\n                await ctx.setSignedCookie(\n                  trustDeviceCookieName.name,\n                  `${newToken}!${data.session.token}`,\n                  ctx.context.secret,\n                  trustDeviceCookieName.attributes\n                );\n                return;\n              }\n            }\n            deleteSessionCookie(ctx, true);\n            await ctx.context.internalAdapter.deleteSession(data.session.token);\n            const twoFactorCookie = ctx.context.createAuthCookie(\n              TWO_FACTOR_COOKIE_NAME,\n              {\n                maxAge: 60 * 10\n                // 10 minutes\n              }\n            );\n            await ctx.setSignedCookie(\n              twoFactorCookie.name,\n              data.user.id,\n              ctx.context.secret,\n              twoFactorCookie.attributes\n            );\n            return ctx.json({\n              twoFactorRedirect: true\n            });\n          })\n        }\n      ]\n    },\n    schema: mergeSchema(schema, options?.schema),\n    rateLimit: [\n      {\n        pathMatcher(path) {\n          return path.startsWith(\"/two-factor/\");\n        },\n        window: 10,\n        max: 3\n      }\n    ]\n  };\n};\n\nexport { twoFactor };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1117, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/username/index.mjs"],"sourcesContent":["import { z } from 'zod';\nimport { c as createAuthMiddleware, a as createAuthEndpoint, b as sendVerificationEmailFn, B as BASE_ERROR_CODES } from '../../shared/better-auth.C92a320y.mjs';\nimport { APIError } from 'better-call';\nimport { setSessionCookie } from '../../cookies/index.mjs';\nimport { m as mergeSchema } from '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport { T as TWO_FACTOR_ERROR_CODES } from '../../shared/better-auth.BcoSd9tC.mjs';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport 'jose';\nimport '@better-auth/utils/hash';\nimport '@better-auth/utils/base64';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '../../shared/better-auth.CW6D9eSx.mjs';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport '../../shared/better-auth.B4Qoxdgc.mjs';\nimport '@better-auth/utils/random';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '@better-auth/utils/hmac';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport '../../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '@better-auth/utils/binary';\n\nconst schema = {\n  user: {\n    fields: {\n      username: {\n        type: \"string\",\n        required: false,\n        sortable: true,\n        unique: true,\n        returned: true,\n        transform: {\n          input(value) {\n            return value?.toString().toLowerCase();\n          }\n        }\n      },\n      displayUsername: {\n        type: \"string\",\n        required: false\n      }\n    }\n  }\n};\n\nfunction defaultUsernameValidator(username2) {\n  return /^[a-zA-Z0-9_]+$/.test(username2);\n}\nconst username = (options) => {\n  const ERROR_CODES = {\n    INVALID_USERNAME_OR_PASSWORD: \"invalid username or password\",\n    EMAIL_NOT_VERIFIED: \"email not verified\",\n    USERNAME_IS_ALREADY_TAKEN: \"username is already taken. please try another.\",\n    USERNAME_TOO_SHORT: \"username is too short\",\n    USERNAME_TOO_LONG: \"username is too long\",\n    INVALID_USERNAME: \"username is invalid\"\n  };\n  return {\n    id: \"username\",\n    endpoints: {\n      signInUsername: createAuthEndpoint(\n        \"/sign-in/username\",\n        {\n          method: \"POST\",\n          body: z.object({\n            username: z.string({\n              description: \"The username of the user\"\n            }),\n            password: z.string({\n              description: \"The password of the user\"\n            }),\n            rememberMe: z.boolean({\n              description: \"Remember the user session\"\n            }).optional()\n          }),\n          metadata: {\n            openapi: {\n              summary: \"Sign in with username\",\n              description: \"Sign in with username\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          user: {\n                            $ref: \"#/components/schemas/User\"\n                          },\n                          session: {\n                            $ref: \"#/components/schemas/Session\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          if (!ctx.body.username || !ctx.body.password) {\n            ctx.context.logger.error(\"Username or password not found\");\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: ERROR_CODES.INVALID_USERNAME_OR_PASSWORD\n            });\n          }\n          const minUsernameLength = options?.minUsernameLength || 3;\n          const maxUsernameLength = options?.maxUsernameLength || 30;\n          if (ctx.body.username.length < minUsernameLength) {\n            ctx.context.logger.error(\"Username too short\", {\n              username: ctx.body.username\n            });\n            throw new APIError(\"UNPROCESSABLE_ENTITY\", {\n              message: ERROR_CODES.USERNAME_TOO_SHORT\n            });\n          }\n          if (ctx.body.username.length > maxUsernameLength) {\n            ctx.context.logger.error(\"Username too long\", {\n              username: ctx.body.username\n            });\n            throw new APIError(\"UNPROCESSABLE_ENTITY\", {\n              message: ERROR_CODES.USERNAME_TOO_LONG\n            });\n          }\n          const validator = options?.usernameValidator || defaultUsernameValidator;\n          if (!validator(ctx.body.username)) {\n            throw new APIError(\"UNPROCESSABLE_ENTITY\", {\n              message: ERROR_CODES.INVALID_USERNAME\n            });\n          }\n          const user = await ctx.context.adapter.findOne({\n            model: \"user\",\n            where: [\n              {\n                field: \"username\",\n                value: ctx.body.username.toLowerCase()\n              }\n            ]\n          });\n          if (!user) {\n            await ctx.context.password.hash(ctx.body.password);\n            ctx.context.logger.error(\"User not found\", { username });\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: ERROR_CODES.INVALID_USERNAME_OR_PASSWORD\n            });\n          }\n          if (!user.emailVerified && ctx.context.options.emailAndPassword?.requireEmailVerification) {\n            await sendVerificationEmailFn(ctx, user);\n            throw new APIError(\"FORBIDDEN\", {\n              message: ERROR_CODES.EMAIL_NOT_VERIFIED\n            });\n          }\n          const account = await ctx.context.adapter.findOne({\n            model: \"account\",\n            where: [\n              {\n                field: \"userId\",\n                value: user.id\n              },\n              {\n                field: \"providerId\",\n                value: \"credential\"\n              }\n            ]\n          });\n          if (!account) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: ERROR_CODES.INVALID_USERNAME_OR_PASSWORD\n            });\n          }\n          const currentPassword = account?.password;\n          if (!currentPassword) {\n            ctx.context.logger.error(\"Password not found\", { username });\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: ERROR_CODES.INVALID_USERNAME_OR_PASSWORD\n            });\n          }\n          const validPassword = await ctx.context.password.verify({\n            hash: currentPassword,\n            password: ctx.body.password\n          });\n          if (!validPassword) {\n            ctx.context.logger.error(\"Invalid password\");\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: ERROR_CODES.INVALID_USERNAME_OR_PASSWORD\n            });\n          }\n          const session = await ctx.context.internalAdapter.createSession(\n            user.id,\n            ctx.request,\n            ctx.body.rememberMe === false\n          );\n          if (!session) {\n            return ctx.json(null, {\n              status: 500,\n              body: {\n                message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION\n              }\n            });\n          }\n          await setSessionCookie(\n            ctx,\n            { session, user },\n            ctx.body.rememberMe === false\n          );\n          return ctx.json({\n            token: session.token,\n            user: {\n              id: user.id,\n              email: user.email,\n              emailVerified: user.emailVerified,\n              username: user.username,\n              name: user.name,\n              image: user.image,\n              createdAt: user.createdAt,\n              updatedAt: user.updatedAt\n            }\n          });\n        }\n      )\n    },\n    schema: mergeSchema(schema, options?.schema),\n    hooks: {\n      before: [\n        {\n          matcher(context) {\n            return context.path === \"/sign-up/email\" || context.path === \"/update-user\";\n          },\n          handler: createAuthMiddleware(async (ctx) => {\n            const username2 = ctx.body.username;\n            if (username2) {\n              const minUsernameLength = options?.minUsernameLength || 3;\n              const maxUsernameLength = options?.maxUsernameLength || 30;\n              if (username2.length < minUsernameLength) {\n                throw new APIError(\"UNPROCESSABLE_ENTITY\", {\n                  message: ERROR_CODES.USERNAME_TOO_SHORT\n                });\n              }\n              if (username2.length > maxUsernameLength) {\n                throw new APIError(\"UNPROCESSABLE_ENTITY\", {\n                  message: ERROR_CODES.USERNAME_TOO_LONG\n                });\n              }\n              const validator = options?.usernameValidator || defaultUsernameValidator;\n              const valid = await validator(username2);\n              if (!valid) {\n                throw new APIError(\"UNPROCESSABLE_ENTITY\", {\n                  message: ERROR_CODES.INVALID_USERNAME\n                });\n              }\n              const user = await ctx.context.adapter.findOne({\n                model: \"user\",\n                where: [\n                  {\n                    field: \"username\",\n                    value: username2.toLowerCase()\n                  }\n                ]\n              });\n              if (user) {\n                throw new APIError(\"UNPROCESSABLE_ENTITY\", {\n                  message: ERROR_CODES.USERNAME_IS_ALREADY_TAKEN\n                });\n              }\n            }\n          })\n        },\n        {\n          matcher(context) {\n            return context.path === \"/sign-up/email\" || context.path === \"/update-user\";\n          },\n          async handler(ctx) {\n            if (!ctx.body.displayUsername && ctx.body.username) {\n              ctx.body.displayUsername = ctx.body.username;\n            }\n          }\n        }\n      ]\n    },\n    $ERROR_CODES: TWO_FACTOR_ERROR_CODES\n  };\n};\n\nexport { username };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1445, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/bearer/index.mjs"],"sourcesContent":["import { serializeSignedCookie } from 'better-call';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport '@better-auth/utils/base64';\nimport { createHMAC } from '@better-auth/utils/hmac';\nimport { parseSetCookieHeader } from '../../cookies/index.mjs';\nimport { c as createAuthMiddleware } from '../../shared/better-auth.C92a320y.mjs';\nimport 'zod';\nimport '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '../../shared/better-auth.CW6D9eSx.mjs';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport 'jose';\nimport '@better-auth/utils/hash';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport '../../shared/better-auth.B4Qoxdgc.mjs';\nimport '@better-auth/utils/random';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport '../../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '@better-auth/utils/binary';\n\nconst bearer = (options) => {\n  return {\n    id: \"bearer\",\n    hooks: {\n      before: [\n        {\n          matcher(context) {\n            return Boolean(\n              context.request?.headers.get(\"authorization\") || context.headers?.get(\"authorization\")\n            );\n          },\n          handler: createAuthMiddleware(async (c) => {\n            const token = c.request?.headers.get(\"authorization\")?.replace(\"Bearer \", \"\") || c.headers?.get(\"Authorization\")?.replace(\"Bearer \", \"\");\n            if (!token) {\n              return;\n            }\n            let signedToken = \"\";\n            if (token.includes(\".\")) {\n              signedToken = token.replace(\"=\", \"\");\n            } else {\n              if (options?.requireSignature) {\n                return;\n              }\n              signedToken = (await serializeSignedCookie(\"\", token, c.context.secret)).replace(\"=\", \"\");\n            }\n            try {\n              const decodedToken = decodeURIComponent(signedToken);\n              const isValid = await createHMAC(\n                \"SHA-256\",\n                \"base64urlnopad\"\n              ).verify(\n                c.context.secret,\n                decodedToken.split(\".\")[0],\n                decodedToken.split(\".\")[1]\n              );\n              if (!isValid) {\n                return;\n              }\n            } catch (e) {\n              return;\n            }\n            const existingHeaders = c.request?.headers || c.headers;\n            const headers = new Headers({\n              ...Object.fromEntries(existingHeaders?.entries())\n            });\n            headers.append(\n              \"cookie\",\n              `${c.context.authCookies.sessionToken.name}=${signedToken}`\n            );\n            return {\n              context: {\n                headers\n              }\n            };\n          })\n        }\n      ],\n      after: [\n        {\n          matcher(context) {\n            return true;\n          },\n          handler: createAuthMiddleware(async (ctx) => {\n            const setCookie = ctx.context.responseHeaders?.get(\"set-cookie\");\n            if (!setCookie) {\n              return;\n            }\n            const parsedCookies = parseSetCookieHeader(setCookie);\n            const cookieName = ctx.context.authCookies.sessionToken.name;\n            const sessionCookie = parsedCookies.get(cookieName);\n            if (!sessionCookie || !sessionCookie.value || sessionCookie[\"max-age\"] === 0) {\n              return;\n            }\n            const token = sessionCookie.value;\n            ctx.setHeader(\"set-auth-token\", token);\n            ctx.setHeader(\"Access-Control-Expose-Headers\", \"set-auth-token\");\n          })\n        }\n      ]\n    }\n  };\n};\n\nexport { bearer };\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAKA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,MAAM,SAAS,CAAC;IACd,OAAO;QACL,IAAI;QACJ,OAAO;YACL,QAAQ;gBACN;oBACE,SAAQ,OAAO;wBACb,OAAO,QACL,QAAQ,OAAO,EAAE,QAAQ,IAAI,oBAAoB,QAAQ,OAAO,EAAE,IAAI;oBAE1E;oBACA,SAAS,CAAA,GAAA,iLAAA,CAAA,IAAoB,AAAD,EAAE,OAAO;wBACnC,MAAM,QAAQ,EAAE,OAAO,EAAE,QAAQ,IAAI,kBAAkB,QAAQ,WAAW,OAAO,EAAE,OAAO,EAAE,IAAI,kBAAkB,QAAQ,WAAW;wBACrI,IAAI,CAAC,OAAO;4BACV;wBACF;wBACA,IAAI,cAAc;wBAClB,IAAI,MAAM,QAAQ,CAAC,MAAM;4BACvB,cAAc,MAAM,OAAO,CAAC,KAAK;wBACnC,OAAO;4BACL,IAAI,SAAS,kBAAkB;gCAC7B;4BACF;4BACA,cAAc,CAAC,MAAM,CAAA,GAAA,iJAAA,CAAA,wBAAqB,AAAD,EAAE,IAAI,OAAO,EAAE,OAAO,CAAC,MAAM,CAAC,EAAE,OAAO,CAAC,KAAK;wBACxF;wBACA,IAAI;4BACF,MAAM,eAAe,mBAAmB;4BACxC,MAAM,UAAU,MAAM,CAAA,GAAA,4JAAA,CAAA,aAAU,AAAD,EAC7B,WACA,kBACA,MAAM,CACN,EAAE,OAAO,CAAC,MAAM,EAChB,aAAa,KAAK,CAAC,IAAI,CAAC,EAAE,EAC1B,aAAa,KAAK,CAAC,IAAI,CAAC,EAAE;4BAE5B,IAAI,CAAC,SAAS;gCACZ;4BACF;wBACF,EAAE,OAAO,GAAG;4BACV;wBACF;wBACA,MAAM,kBAAkB,EAAE,OAAO,EAAE,WAAW,EAAE,OAAO;wBACvD,MAAM,UAAU,IAAI,QAAQ;4BAC1B,GAAG,OAAO,WAAW,CAAC,iBAAiB,UAAU;wBACnD;wBACA,QAAQ,MAAM,CACZ,UACA,GAAG,EAAE,OAAO,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,EAAE,aAAa;wBAE7D,OAAO;4BACL,SAAS;gCACP;4BACF;wBACF;oBACF;gBACF;aACD;YACD,OAAO;gBACL;oBACE,SAAQ,OAAO;wBACb,OAAO;oBACT;oBACA,SAAS,CAAA,GAAA,iLAAA,CAAA,IAAoB,AAAD,EAAE,OAAO;wBACnC,MAAM,YAAY,IAAI,OAAO,CAAC,eAAe,EAAE,IAAI;wBACnD,IAAI,CAAC,WAAW;4BACd;wBACF;wBACA,MAAM,gBAAgB,CAAA,GAAA,6JAAA,CAAA,uBAAoB,AAAD,EAAE;wBAC3C,MAAM,aAAa,IAAI,OAAO,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI;wBAC5D,MAAM,gBAAgB,cAAc,GAAG,CAAC;wBACxC,IAAI,CAAC,iBAAiB,CAAC,cAAc,KAAK,IAAI,aAAa,CAAC,UAAU,KAAK,GAAG;4BAC5E;wBACF;wBACA,MAAM,QAAQ,cAAc,KAAK;wBACjC,IAAI,SAAS,CAAC,kBAAkB;wBAChC,IAAI,SAAS,CAAC,iCAAiC;oBACjD;gBACF;aACD;QACH;IACF;AACF","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1583, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/magic-link/index.mjs"],"sourcesContent":["import { z } from 'zod';\nimport { a as createAuthEndpoint, o as originCheck, B as BASE_ERROR_CODES } from '../../shared/better-auth.C92a320y.mjs';\nimport { APIError } from 'better-call';\nimport { setSessionCookie } from '../../cookies/index.mjs';\nimport '@better-auth/utils/hash';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@better-auth/utils/base64';\nimport 'jose';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport { g as generateRandomString } from '../../shared/better-auth.B4Qoxdgc.mjs';\nimport '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '../../shared/better-auth.CW6D9eSx.mjs';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '@better-auth/utils/random';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '@better-auth/utils/hmac';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport '../../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '@better-auth/utils/binary';\n\nconst magicLink = (options) => {\n  return {\n    id: \"magic-link\",\n    endpoints: {\n      signInMagicLink: createAuthEndpoint(\n        \"/sign-in/magic-link\",\n        {\n          method: \"POST\",\n          requireHeaders: true,\n          body: z.object({\n            email: z.string({\n              description: \"Email address to send the magic link\"\n            }).email(),\n            name: z.string({\n              description: \"User display name. Only used if the user is registering for the first time.\"\n            }).optional(),\n            callbackURL: z.string({\n              description: \"URL to redirect after magic link verification\"\n            }).optional()\n          }),\n          metadata: {\n            openapi: {\n              description: \"Sign in with magic link\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          status: {\n                            type: \"boolean\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const { email } = ctx.body;\n          if (options.disableSignUp) {\n            const user = await ctx.context.internalAdapter.findUserByEmail(email);\n            if (!user) {\n              throw new APIError(\"BAD_REQUEST\", {\n                message: BASE_ERROR_CODES.USER_NOT_FOUND\n              });\n            }\n          }\n          const verificationToken = options?.generateToken ? await options.generateToken(email) : generateRandomString(32, \"a-z\", \"A-Z\");\n          await ctx.context.internalAdapter.createVerificationValue({\n            identifier: verificationToken,\n            value: JSON.stringify({ email, name: ctx.body.name }),\n            expiresAt: new Date(\n              Date.now() + (options.expiresIn || 60 * 5) * 1e3\n            )\n          });\n          const url = `${ctx.context.baseURL}/magic-link/verify?token=${verificationToken}&callbackURL=${ctx.body.callbackURL || \"/\"}`;\n          await options.sendMagicLink(\n            {\n              email,\n              url,\n              token: verificationToken\n            },\n            ctx.request\n          );\n          return ctx.json({\n            status: true\n          });\n        }\n      ),\n      magicLinkVerify: createAuthEndpoint(\n        \"/magic-link/verify\",\n        {\n          method: \"GET\",\n          query: z.object({\n            token: z.string({\n              description: \"Verification token\"\n            }),\n            callbackURL: z.string({\n              description: \"URL to redirect after magic link verification, if not provided will return session\"\n            }).optional()\n          }),\n          use: [originCheck((ctx) => ctx.query.callbackURL)],\n          requireHeaders: true,\n          metadata: {\n            openapi: {\n              description: \"Verify magic link\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          session: {\n                            $ref: \"#/components/schemas/Session\"\n                          },\n                          user: {\n                            $ref: \"#/components/schemas/User\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const { token, callbackURL } = ctx.query;\n          const toRedirectTo = callbackURL?.startsWith(\"http\") ? callbackURL : callbackURL ? `${ctx.context.options.baseURL}${callbackURL}` : ctx.context.options.baseURL;\n          const tokenValue = await ctx.context.internalAdapter.findVerificationValue(token);\n          if (!tokenValue) {\n            throw ctx.redirect(`${toRedirectTo}?error=INVALID_TOKEN`);\n          }\n          if (tokenValue.expiresAt < /* @__PURE__ */ new Date()) {\n            await ctx.context.internalAdapter.deleteVerificationValue(\n              tokenValue.id\n            );\n            throw ctx.redirect(`${toRedirectTo}?error=EXPIRED_TOKEN`);\n          }\n          await ctx.context.internalAdapter.deleteVerificationValue(\n            tokenValue.id\n          );\n          const { email, name } = JSON.parse(tokenValue.value);\n          let user = await ctx.context.internalAdapter.findUserByEmail(email).then((res) => res?.user);\n          if (!user) {\n            if (!options.disableSignUp) {\n              const newUser = await ctx.context.internalAdapter.createUser(\n                {\n                  email,\n                  emailVerified: true,\n                  name: name || \"\"\n                },\n                ctx\n              );\n              user = newUser;\n              if (!user) {\n                throw ctx.redirect(\n                  `${toRedirectTo}?error=failed_to_create_user`\n                );\n              }\n            } else {\n              throw ctx.redirect(`${toRedirectTo}?error=failed_to_create_user`);\n            }\n          }\n          if (!user.emailVerified) {\n            await ctx.context.internalAdapter.updateUser(\n              user.id,\n              {\n                emailVerified: true\n              },\n              ctx\n            );\n          }\n          const session = await ctx.context.internalAdapter.createSession(\n            user.id,\n            ctx.headers\n          );\n          if (!session) {\n            throw ctx.redirect(\n              `${toRedirectTo}?error=failed_to_create_session`\n            );\n          }\n          await setSessionCookie(ctx, {\n            session,\n            user\n          });\n          if (!callbackURL) {\n            return ctx.json({\n              token: session.token,\n              user: {\n                id: user.id,\n                email: user.email,\n                emailVerified: user.emailVerified,\n                name: user.name,\n                image: user.image,\n                createdAt: user.createdAt,\n                updatedAt: user.updatedAt\n              }\n            });\n          }\n          throw ctx.redirect(callbackURL);\n        }\n      )\n    },\n    rateLimit: [\n      {\n        pathMatcher(path) {\n          return path.startsWith(\"/sign-in/magic-link\") || path.startsWith(\"/magic-link/verify\");\n        },\n        window: options.rateLimit?.window || 60,\n        max: options.rateLimit?.max || 5\n      }\n    ]\n  };\n};\n\nexport { magicLink };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1830, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/phone-number/index.mjs"],"sourcesContent":["import { z } from 'zod';\nimport { a as createAuthEndpoint, g as getSessionFromCtx, B as BASE_ERROR_CODES } from '../../shared/better-auth.C92a320y.mjs';\nimport { APIError } from 'better-call';\nimport { m as mergeSchema } from '../../shared/better-auth.C24Bzw4w.mjs';\nimport { g as generateRandomString } from '../../shared/better-auth.B4Qoxdgc.mjs';\nimport { setSessionCookie } from '../../cookies/index.mjs';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport { g as getDate } from '../../shared/better-auth.CW6D9eSx.mjs';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport 'jose';\nimport '@better-auth/utils/hash';\nimport '@better-auth/utils/base64';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '@better-auth/utils/random';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '@better-auth/utils/hmac';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport '../../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '@better-auth/utils/binary';\n\nfunction generateOTP(size) {\n  return generateRandomString(size, \"0-9\");\n}\nconst phoneNumber = (options) => {\n  const opts = {\n    expiresIn: options?.expiresIn || 300,\n    otpLength: options?.otpLength || 6,\n    ...options,\n    phoneNumber: \"phoneNumber\",\n    phoneNumberVerified: \"phoneNumberVerified\",\n    code: \"code\",\n    createdAt: \"createdAt\"\n  };\n  const ERROR_CODES = {\n    INVALID_PHONE_NUMBER: \"Invalid phone number\",\n    PHONE_NUMBER_EXIST: \"Phone number already exist\",\n    INVALID_PHONE_NUMBER_OR_PASSWORD: \"Invalid phone number or password\",\n    UNEXPECTED_ERROR: \"Unexpected error\",\n    OTP_NOT_FOUND: \"OTP not found\",\n    OTP_EXPIRED: \"OTP expired\",\n    INVALID_OTP: \"Invalid OTP\"\n  };\n  return {\n    id: \"phone-number\",\n    endpoints: {\n      signInPhoneNumber: createAuthEndpoint(\n        \"/sign-in/phone-number\",\n        {\n          method: \"POST\",\n          body: z.object({\n            phoneNumber: z.string({\n              description: \"Phone number to sign in\"\n            }),\n            password: z.string({\n              description: \"Password to use for sign in\"\n            }),\n            rememberMe: z.boolean({\n              description: \"Remember the session\"\n            }).optional()\n          }),\n          metadata: {\n            openapi: {\n              summary: \"Sign in with phone number\",\n              description: \"Use this endpoint to sign in with phone number\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          user: {\n                            $ref: \"#/components/schemas/User\"\n                          },\n                          session: {\n                            $ref: \"#/components/schemas/Session\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                },\n                400: {\n                  description: \"Invalid phone number or password\"\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const { password, phoneNumber: phoneNumber2 } = ctx.body;\n          if (opts.phoneNumberValidator) {\n            const isValidNumber = await opts.phoneNumberValidator(\n              ctx.body.phoneNumber\n            );\n            if (!isValidNumber) {\n              throw new APIError(\"BAD_REQUEST\", {\n                message: ERROR_CODES.INVALID_PHONE_NUMBER\n              });\n            }\n          }\n          const user = await ctx.context.adapter.findOne({\n            model: \"user\",\n            where: [\n              {\n                field: \"phoneNumber\",\n                value: phoneNumber2\n              }\n            ]\n          });\n          if (!user) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD\n            });\n          }\n          const accounts = await ctx.context.internalAdapter.findAccountByUserId(user.id);\n          const credentialAccount = accounts.find(\n            (a) => a.providerId === \"credential\"\n          );\n          if (!credentialAccount) {\n            ctx.context.logger.error(\"Credential account not found\", {\n              phoneNumber: phoneNumber2\n            });\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD\n            });\n          }\n          const currentPassword = credentialAccount?.password;\n          if (!currentPassword) {\n            ctx.context.logger.error(\"Password not found\", { phoneNumber: phoneNumber2 });\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: ERROR_CODES.UNEXPECTED_ERROR\n            });\n          }\n          const validPassword = await ctx.context.password.verify({\n            hash: currentPassword,\n            password\n          });\n          if (!validPassword) {\n            ctx.context.logger.error(\"Invalid password\");\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD\n            });\n          }\n          const session = await ctx.context.internalAdapter.createSession(\n            user.id,\n            ctx.headers,\n            ctx.body.rememberMe === false\n          );\n          if (!session) {\n            ctx.context.logger.error(\"Failed to create session\");\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION\n            });\n          }\n          await setSessionCookie(\n            ctx,\n            {\n              session,\n              user\n            },\n            ctx.body.rememberMe === false\n          );\n          return ctx.json({\n            token: session.token,\n            user: {\n              id: user.id,\n              email: user.email,\n              emailVerified: user.emailVerified,\n              name: user.name,\n              image: user.image,\n              phoneNumber: user.phoneNumber,\n              phoneNumberVerified: user.phoneNumberVerified,\n              createdAt: user.createdAt,\n              updatedAt: user.updatedAt\n            }\n          });\n        }\n      ),\n      sendPhoneNumberOTP: createAuthEndpoint(\n        \"/phone-number/send-otp\",\n        {\n          method: \"POST\",\n          body: z.object({\n            phoneNumber: z.string({\n              description: \"Phone number to send OTP\"\n            })\n          }),\n          metadata: {\n            openapi: {\n              summary: \"Send OTP to phone number\",\n              description: \"Use this endpoint to send OTP to phone number\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          message: {\n                            type: \"string\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          if (!options?.sendOTP) {\n            ctx.context.logger.warn(\"sendOTP not implemented\");\n            throw new APIError(\"NOT_IMPLEMENTED\", {\n              message: \"sendOTP not implemented\"\n            });\n          }\n          if (opts.phoneNumberValidator) {\n            const isValidNumber = await opts.phoneNumberValidator(\n              ctx.body.phoneNumber\n            );\n            if (!isValidNumber) {\n              throw new APIError(\"BAD_REQUEST\", {\n                message: ERROR_CODES.INVALID_PHONE_NUMBER\n              });\n            }\n          }\n          const code = generateOTP(opts.otpLength);\n          await ctx.context.internalAdapter.createVerificationValue({\n            value: code,\n            identifier: ctx.body.phoneNumber,\n            expiresAt: getDate(opts.expiresIn, \"sec\")\n          });\n          await options.sendOTP(\n            {\n              phoneNumber: ctx.body.phoneNumber,\n              code\n            },\n            ctx.request\n          );\n          return ctx.json({ message: \"code sent\" });\n        }\n      ),\n      verifyPhoneNumber: createAuthEndpoint(\n        \"/phone-number/verify\",\n        {\n          method: \"POST\",\n          body: z.object({\n            /**\n             * Phone number\n             */\n            phoneNumber: z.string({\n              description: \"Phone number to verify\"\n            }),\n            /**\n             * OTP code\n             */\n            code: z.string({\n              description: \"OTP code\"\n            }),\n            /**\n             * Disable session creation after verification\n             * @default false\n             */\n            disableSession: z.boolean({\n              description: \"Disable session creation after verification\"\n            }).optional(),\n            /**\n             * This checks if there is a session already\n             * and updates the phone number with the provided\n             * phone number\n             */\n            updatePhoneNumber: z.boolean({\n              description: \"Check if there is a session and update the phone number\"\n            }).optional()\n          }),\n          metadata: {\n            openapi: {\n              summary: \"Verify phone number\",\n              description: \"Use this endpoint to verify phone number\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          user: {\n                            $ref: \"#/components/schemas/User\"\n                          },\n                          session: {\n                            $ref: \"#/components/schemas/Session\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                },\n                400: {\n                  description: \"Invalid OTP\"\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const otp = await ctx.context.internalAdapter.findVerificationValue(\n            ctx.body.phoneNumber\n          );\n          if (!otp || otp.expiresAt < /* @__PURE__ */ new Date()) {\n            if (otp && otp.expiresAt < /* @__PURE__ */ new Date()) {\n              throw new APIError(\"BAD_REQUEST\", {\n                message: \"OTP expired\"\n              });\n            }\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.OTP_NOT_FOUND\n            });\n          }\n          if (otp.value !== ctx.body.code) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: \"Invalid OTP\"\n            });\n          }\n          await ctx.context.internalAdapter.deleteVerificationValue(otp.id);\n          if (ctx.body.updatePhoneNumber) {\n            const session = await getSessionFromCtx(ctx);\n            if (!session) {\n              throw new APIError(\"UNAUTHORIZED\", {\n                message: BASE_ERROR_CODES.USER_NOT_FOUND\n              });\n            }\n            const existingUser = await ctx.context.adapter.findMany({\n              model: \"user\",\n              where: [\n                {\n                  field: \"phoneNumber\",\n                  value: ctx.body.phoneNumber\n                }\n              ]\n            });\n            if (existingUser.length) {\n              throw ctx.error(\"BAD_REQUEST\", {\n                message: ERROR_CODES.PHONE_NUMBER_EXIST\n              });\n            }\n            let user2 = await ctx.context.internalAdapter.updateUser(\n              session.user.id,\n              {\n                [opts.phoneNumber]: ctx.body.phoneNumber,\n                [opts.phoneNumberVerified]: true\n              },\n              ctx\n            );\n            return ctx.json({\n              status: true,\n              token: session.session.token,\n              user: {\n                id: user2.id,\n                email: user2.email,\n                emailVerified: user2.emailVerified,\n                name: user2.name,\n                image: user2.image,\n                phoneNumber: user2.phoneNumber,\n                phoneNumberVerified: user2.phoneNumberVerified,\n                createdAt: user2.createdAt,\n                updatedAt: user2.updatedAt\n              }\n            });\n          }\n          let user = await ctx.context.adapter.findOne({\n            model: \"user\",\n            where: [\n              {\n                value: ctx.body.phoneNumber,\n                field: opts.phoneNumber\n              }\n            ]\n          });\n          if (!user) {\n            if (options?.signUpOnVerification) {\n              user = await ctx.context.internalAdapter.createUser(\n                {\n                  email: options.signUpOnVerification.getTempEmail(\n                    ctx.body.phoneNumber\n                  ),\n                  name: options.signUpOnVerification.getTempName ? options.signUpOnVerification.getTempName(\n                    ctx.body.phoneNumber\n                  ) : ctx.body.phoneNumber,\n                  [opts.phoneNumber]: ctx.body.phoneNumber,\n                  [opts.phoneNumberVerified]: true\n                },\n                ctx\n              );\n              if (!user) {\n                throw new APIError(\"INTERNAL_SERVER_ERROR\", {\n                  message: BASE_ERROR_CODES.FAILED_TO_CREATE_USER\n                });\n              }\n            }\n          } else {\n            user = await ctx.context.internalAdapter.updateUser(\n              user.id,\n              {\n                [opts.phoneNumberVerified]: true\n              },\n              ctx\n            );\n          }\n          if (!user) {\n            return ctx.json(null);\n          }\n          await options?.callbackOnVerification?.(\n            {\n              phoneNumber: ctx.body.phoneNumber,\n              user\n            },\n            ctx.request\n          );\n          if (!user) {\n            throw new APIError(\"INTERNAL_SERVER_ERROR\", {\n              message: BASE_ERROR_CODES.FAILED_TO_UPDATE_USER\n            });\n          }\n          if (!ctx.body.disableSession) {\n            const session = await ctx.context.internalAdapter.createSession(\n              user.id,\n              ctx.request\n            );\n            if (!session) {\n              throw new APIError(\"INTERNAL_SERVER_ERROR\", {\n                message: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION\n              });\n            }\n            await setSessionCookie(ctx, {\n              session,\n              user\n            });\n            return ctx.json({\n              status: true,\n              token: session.token,\n              user: {\n                id: user.id,\n                email: user.email,\n                emailVerified: user.emailVerified,\n                name: user.name,\n                image: user.image,\n                phoneNumber: user.phoneNumber,\n                phoneNumberVerified: user.phoneNumberVerified,\n                createdAt: user.createdAt,\n                updatedAt: user.updatedAt\n              }\n            });\n          }\n          return ctx.json({\n            status: true,\n            token: null,\n            user: {\n              id: user.id,\n              email: user.email,\n              emailVerified: user.emailVerified,\n              name: user.name,\n              image: user.image,\n              phoneNumber: user.phoneNumber,\n              phoneNumberVerified: user.phoneNumberVerified,\n              createdAt: user.createdAt,\n              updatedAt: user.updatedAt\n            }\n          });\n        }\n      ),\n      forgetPasswordPhoneNumber: createAuthEndpoint(\n        \"/phone-number/forget-password\",\n        {\n          method: \"POST\",\n          body: z.object({\n            phoneNumber: z.string()\n          })\n        },\n        async (ctx) => {\n          const user = await ctx.context.adapter.findOne({\n            model: \"user\",\n            where: [\n              {\n                value: ctx.body.phoneNumber,\n                field: opts.phoneNumber\n              }\n            ]\n          });\n          if (!user) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: \"phone number isn't registered\"\n            });\n          }\n          const code = generateOTP(opts.otpLength);\n          await ctx.context.internalAdapter.createVerificationValue({\n            value: code,\n            identifier: `${ctx.body.phoneNumber}-forget-password`,\n            expiresAt: getDate(opts.expiresIn, \"sec\")\n          });\n          await options?.sendForgetPasswordOTP?.(\n            {\n              phoneNumber: ctx.body.phoneNumber,\n              code\n            },\n            ctx.request\n          );\n          return ctx.json({\n            status: true\n          });\n        }\n      ),\n      resetPasswordPhoneNumber: createAuthEndpoint(\n        \"/phone-number/reset-password\",\n        {\n          method: \"POST\",\n          body: z.object({\n            otp: z.string(),\n            phoneNumber: z.string(),\n            newPassword: z.string()\n          })\n        },\n        async (ctx) => {\n          const verification = await ctx.context.internalAdapter.findVerificationValue(\n            `${ctx.body.phoneNumber}-forget-password`\n          );\n          if (!verification) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.OTP_NOT_FOUND\n            });\n          }\n          if (verification.expiresAt < /* @__PURE__ */ new Date()) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.OTP_EXPIRED\n            });\n          }\n          if (verification.value !== ctx.body.otp) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.INVALID_OTP\n            });\n          }\n          const user = await ctx.context.adapter.findOne({\n            model: \"user\",\n            where: [\n              {\n                field: \"phoneNumber\",\n                value: ctx.body.phoneNumber\n              }\n            ]\n          });\n          if (!user) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.UNEXPECTED_ERROR\n            });\n          }\n          const hashedPassword = await ctx.context.password.hash(\n            ctx.body.newPassword\n          );\n          await ctx.context.internalAdapter.updatePassword(\n            user.id,\n            hashedPassword\n          );\n          return ctx.json({\n            status: true\n          });\n        }\n      )\n    },\n    schema: mergeSchema(schema, options?.schema),\n    $ERROR_CODES: ERROR_CODES\n  };\n};\nconst schema = {\n  user: {\n    fields: {\n      phoneNumber: {\n        type: \"string\",\n        required: false,\n        unique: true,\n        sortable: true,\n        returned: true\n      },\n      phoneNumberVerified: {\n        type: \"boolean\",\n        required: false,\n        returned: true,\n        input: false\n      }\n    }\n  }\n};\n\nexport { phoneNumber };\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAKA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,SAAS,YAAY,IAAI;IACvB,OAAO,CAAA,GAAA,iLAAA,CAAA,IAAoB,AAAD,EAAE,MAAM;AACpC;AACA,MAAM,cAAc,CAAC;IACnB,MAAM,OAAO;QACX,WAAW,SAAS,aAAa;QACjC,WAAW,SAAS,aAAa;QACjC,GAAG,OAAO;QACV,aAAa;QACb,qBAAqB;QACrB,MAAM;QACN,WAAW;IACb;IACA,MAAM,cAAc;QAClB,sBAAsB;QACtB,oBAAoB;QACpB,kCAAkC;QAClC,kBAAkB;QAClB,eAAe;QACf,aAAa;QACb,aAAa;IACf;IACA,OAAO;QACL,IAAI;QACJ,WAAW;YACT,mBAAmB,CAAA,GAAA,iLAAA,CAAA,IAAkB,AAAD,EAClC,yBACA;gBACE,QAAQ;gBACR,MAAM,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;oBACb,aAAa,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;wBACpB,aAAa;oBACf;oBACA,UAAU,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;wBACjB,aAAa;oBACf;oBACA,YAAY,sIAAA,CAAA,IAAC,CAAC,OAAO,CAAC;wBACpB,aAAa;oBACf,GAAG,QAAQ;gBACb;gBACA,UAAU;oBACR,SAAS;wBACP,SAAS;wBACT,aAAa;wBACb,WAAW;4BACT,KAAK;gCACH,aAAa;gCACb,SAAS;oCACP,oBAAoB;wCAClB,QAAQ;4CACN,MAAM;4CACN,YAAY;gDACV,MAAM;oDACJ,MAAM;gDACR;gDACA,SAAS;oDACP,MAAM;gDACR;4CACF;wCACF;oCACF;gCACF;4BACF;4BACA,KAAK;gCACH,aAAa;4BACf;wBACF;oBACF;gBACF;YACF,GACA,OAAO;gBACL,MAAM,EAAE,QAAQ,EAAE,aAAa,YAAY,EAAE,GAAG,IAAI,IAAI;gBACxD,IAAI,KAAK,oBAAoB,EAAE;oBAC7B,MAAM,gBAAgB,MAAM,KAAK,oBAAoB,CACnD,IAAI,IAAI,CAAC,WAAW;oBAEtB,IAAI,CAAC,eAAe;wBAClB,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,eAAe;4BAChC,SAAS,YAAY,oBAAoB;wBAC3C;oBACF;gBACF;gBACA,MAAM,OAAO,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;oBAC7C,OAAO;oBACP,OAAO;wBACL;4BACE,OAAO;4BACP,OAAO;wBACT;qBACD;gBACH;gBACA,IAAI,CAAC,MAAM;oBACT,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,gBAAgB;wBACjC,SAAS,YAAY,gCAAgC;oBACvD;gBACF;gBACA,MAAM,WAAW,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,mBAAmB,CAAC,KAAK,EAAE;gBAC9E,MAAM,oBAAoB,SAAS,IAAI,CACrC,CAAC,IAAM,EAAE,UAAU,KAAK;gBAE1B,IAAI,CAAC,mBAAmB;oBACtB,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,gCAAgC;wBACvD,aAAa;oBACf;oBACA,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,gBAAgB;wBACjC,SAAS,YAAY,gCAAgC;oBACvD;gBACF;gBACA,MAAM,kBAAkB,mBAAmB;gBAC3C,IAAI,CAAC,iBAAiB;oBACpB,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,sBAAsB;wBAAE,aAAa;oBAAa;oBAC3E,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,gBAAgB;wBACjC,SAAS,YAAY,gBAAgB;oBACvC;gBACF;gBACA,MAAM,gBAAgB,MAAM,IAAI,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC;oBACtD,MAAM;oBACN;gBACF;gBACA,IAAI,CAAC,eAAe;oBAClB,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC;oBACzB,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,gBAAgB;wBACjC,SAAS,YAAY,gCAAgC;oBACvD;gBACF;gBACA,MAAM,UAAU,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,aAAa,CAC7D,KAAK,EAAE,EACP,IAAI,OAAO,EACX,IAAI,IAAI,CAAC,UAAU,KAAK;gBAE1B,IAAI,CAAC,SAAS;oBACZ,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC;oBACzB,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,gBAAgB;wBACjC,SAAS,iLAAA,CAAA,IAAgB,CAAC,wBAAwB;oBACpD;gBACF;gBACA,MAAM,CAAA,GAAA,6JAAA,CAAA,mBAAgB,AAAD,EACnB,KACA;oBACE;oBACA;gBACF,GACA,IAAI,IAAI,CAAC,UAAU,KAAK;gBAE1B,OAAO,IAAI,IAAI,CAAC;oBACd,OAAO,QAAQ,KAAK;oBACpB,MAAM;wBACJ,IAAI,KAAK,EAAE;wBACX,OAAO,KAAK,KAAK;wBACjB,eAAe,KAAK,aAAa;wBACjC,MAAM,KAAK,IAAI;wBACf,OAAO,KAAK,KAAK;wBACjB,aAAa,KAAK,WAAW;wBAC7B,qBAAqB,KAAK,mBAAmB;wBAC7C,WAAW,KAAK,SAAS;wBACzB,WAAW,KAAK,SAAS;oBAC3B;gBACF;YACF;YAEF,oBAAoB,CAAA,GAAA,iLAAA,CAAA,IAAkB,AAAD,EACnC,0BACA;gBACE,QAAQ;gBACR,MAAM,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;oBACb,aAAa,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;wBACpB,aAAa;oBACf;gBACF;gBACA,UAAU;oBACR,SAAS;wBACP,SAAS;wBACT,aAAa;wBACb,WAAW;4BACT,KAAK;gCACH,aAAa;gCACb,SAAS;oCACP,oBAAoB;wCAClB,QAAQ;4CACN,MAAM;4CACN,YAAY;gDACV,SAAS;oDACP,MAAM;gDACR;4CACF;wCACF;oCACF;gCACF;4BACF;wBACF;oBACF;gBACF;YACF,GACA,OAAO;gBACL,IAAI,CAAC,SAAS,SAAS;oBACrB,IAAI,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC;oBACxB,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,mBAAmB;wBACpC,SAAS;oBACX;gBACF;gBACA,IAAI,KAAK,oBAAoB,EAAE;oBAC7B,MAAM,gBAAgB,MAAM,KAAK,oBAAoB,CACnD,IAAI,IAAI,CAAC,WAAW;oBAEtB,IAAI,CAAC,eAAe;wBAClB,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,eAAe;4BAChC,SAAS,YAAY,oBAAoB;wBAC3C;oBACF;gBACF;gBACA,MAAM,OAAO,YAAY,KAAK,SAAS;gBACvC,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,uBAAuB,CAAC;oBACxD,OAAO;oBACP,YAAY,IAAI,IAAI,CAAC,WAAW;oBAChC,WAAW,CAAA,GAAA,iLAAA,CAAA,IAAO,AAAD,EAAE,KAAK,SAAS,EAAE;gBACrC;gBACA,MAAM,QAAQ,OAAO,CACnB;oBACE,aAAa,IAAI,IAAI,CAAC,WAAW;oBACjC;gBACF,GACA,IAAI,OAAO;gBAEb,OAAO,IAAI,IAAI,CAAC;oBAAE,SAAS;gBAAY;YACzC;YAEF,mBAAmB,CAAA,GAAA,iLAAA,CAAA,IAAkB,AAAD,EAClC,wBACA;gBACE,QAAQ;gBACR,MAAM,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;oBACb;;aAEC,GACD,aAAa,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;wBACpB,aAAa;oBACf;oBACA;;aAEC,GACD,MAAM,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;wBACb,aAAa;oBACf;oBACA;;;aAGC,GACD,gBAAgB,sIAAA,CAAA,IAAC,CAAC,OAAO,CAAC;wBACxB,aAAa;oBACf,GAAG,QAAQ;oBACX;;;;aAIC,GACD,mBAAmB,sIAAA,CAAA,IAAC,CAAC,OAAO,CAAC;wBAC3B,aAAa;oBACf,GAAG,QAAQ;gBACb;gBACA,UAAU;oBACR,SAAS;wBACP,SAAS;wBACT,aAAa;wBACb,WAAW;4BACT,KAAK;gCACH,aAAa;gCACb,SAAS;oCACP,oBAAoB;wCAClB,QAAQ;4CACN,MAAM;4CACN,YAAY;gDACV,MAAM;oDACJ,MAAM;gDACR;gDACA,SAAS;oDACP,MAAM;gDACR;4CACF;wCACF;oCACF;gCACF;4BACF;4BACA,KAAK;gCACH,aAAa;4BACf;wBACF;oBACF;gBACF;YACF,GACA,OAAO;gBACL,MAAM,MAAM,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,qBAAqB,CACjE,IAAI,IAAI,CAAC,WAAW;gBAEtB,IAAI,CAAC,OAAO,IAAI,SAAS,GAAG,aAAa,GAAG,IAAI,QAAQ;oBACtD,IAAI,OAAO,IAAI,SAAS,GAAG,aAAa,GAAG,IAAI,QAAQ;wBACrD,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,eAAe;4BAChC,SAAS;wBACX;oBACF;oBACA,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,eAAe;wBAChC,SAAS,YAAY,aAAa;oBACpC;gBACF;gBACA,IAAI,IAAI,KAAK,KAAK,IAAI,IAAI,CAAC,IAAI,EAAE;oBAC/B,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,eAAe;wBAChC,SAAS;oBACX;gBACF;gBACA,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,uBAAuB,CAAC,IAAI,EAAE;gBAChE,IAAI,IAAI,IAAI,CAAC,iBAAiB,EAAE;oBAC9B,MAAM,UAAU,MAAM,CAAA,GAAA,iLAAA,CAAA,IAAiB,AAAD,EAAE;oBACxC,IAAI,CAAC,SAAS;wBACZ,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,gBAAgB;4BACjC,SAAS,iLAAA,CAAA,IAAgB,CAAC,cAAc;wBAC1C;oBACF;oBACA,MAAM,eAAe,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC;wBACtD,OAAO;wBACP,OAAO;4BACL;gCACE,OAAO;gCACP,OAAO,IAAI,IAAI,CAAC,WAAW;4BAC7B;yBACD;oBACH;oBACA,IAAI,aAAa,MAAM,EAAE;wBACvB,MAAM,IAAI,KAAK,CAAC,eAAe;4BAC7B,SAAS,YAAY,kBAAkB;wBACzC;oBACF;oBACA,IAAI,QAAQ,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,UAAU,CACtD,QAAQ,IAAI,CAAC,EAAE,EACf;wBACE,CAAC,KAAK,WAAW,CAAC,EAAE,IAAI,IAAI,CAAC,WAAW;wBACxC,CAAC,KAAK,mBAAmB,CAAC,EAAE;oBAC9B,GACA;oBAEF,OAAO,IAAI,IAAI,CAAC;wBACd,QAAQ;wBACR,OAAO,QAAQ,OAAO,CAAC,KAAK;wBAC5B,MAAM;4BACJ,IAAI,MAAM,EAAE;4BACZ,OAAO,MAAM,KAAK;4BAClB,eAAe,MAAM,aAAa;4BAClC,MAAM,MAAM,IAAI;4BAChB,OAAO,MAAM,KAAK;4BAClB,aAAa,MAAM,WAAW;4BAC9B,qBAAqB,MAAM,mBAAmB;4BAC9C,WAAW,MAAM,SAAS;4BAC1B,WAAW,MAAM,SAAS;wBAC5B;oBACF;gBACF;gBACA,IAAI,OAAO,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;oBAC3C,OAAO;oBACP,OAAO;wBACL;4BACE,OAAO,IAAI,IAAI,CAAC,WAAW;4BAC3B,OAAO,KAAK,WAAW;wBACzB;qBACD;gBACH;gBACA,IAAI,CAAC,MAAM;oBACT,IAAI,SAAS,sBAAsB;wBACjC,OAAO,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,UAAU,CACjD;4BACE,OAAO,QAAQ,oBAAoB,CAAC,YAAY,CAC9C,IAAI,IAAI,CAAC,WAAW;4BAEtB,MAAM,QAAQ,oBAAoB,CAAC,WAAW,GAAG,QAAQ,oBAAoB,CAAC,WAAW,CACvF,IAAI,IAAI,CAAC,WAAW,IAClB,IAAI,IAAI,CAAC,WAAW;4BACxB,CAAC,KAAK,WAAW,CAAC,EAAE,IAAI,IAAI,CAAC,WAAW;4BACxC,CAAC,KAAK,mBAAmB,CAAC,EAAE;wBAC9B,GACA;wBAEF,IAAI,CAAC,MAAM;4BACT,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,yBAAyB;gCAC1C,SAAS,iLAAA,CAAA,IAAgB,CAAC,qBAAqB;4BACjD;wBACF;oBACF;gBACF,OAAO;oBACL,OAAO,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,UAAU,CACjD,KAAK,EAAE,EACP;wBACE,CAAC,KAAK,mBAAmB,CAAC,EAAE;oBAC9B,GACA;gBAEJ;gBACA,IAAI,CAAC,MAAM;oBACT,OAAO,IAAI,IAAI,CAAC;gBAClB;gBACA,MAAM,SAAS,yBACb;oBACE,aAAa,IAAI,IAAI,CAAC,WAAW;oBACjC;gBACF,GACA,IAAI,OAAO;gBAEb,IAAI,CAAC,MAAM;oBACT,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,yBAAyB;wBAC1C,SAAS,iLAAA,CAAA,IAAgB,CAAC,qBAAqB;oBACjD;gBACF;gBACA,IAAI,CAAC,IAAI,IAAI,CAAC,cAAc,EAAE;oBAC5B,MAAM,UAAU,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,aAAa,CAC7D,KAAK,EAAE,EACP,IAAI,OAAO;oBAEb,IAAI,CAAC,SAAS;wBACZ,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,yBAAyB;4BAC1C,SAAS,iLAAA,CAAA,IAAgB,CAAC,wBAAwB;wBACpD;oBACF;oBACA,MAAM,CAAA,GAAA,6JAAA,CAAA,mBAAgB,AAAD,EAAE,KAAK;wBAC1B;wBACA;oBACF;oBACA,OAAO,IAAI,IAAI,CAAC;wBACd,QAAQ;wBACR,OAAO,QAAQ,KAAK;wBACpB,MAAM;4BACJ,IAAI,KAAK,EAAE;4BACX,OAAO,KAAK,KAAK;4BACjB,eAAe,KAAK,aAAa;4BACjC,MAAM,KAAK,IAAI;4BACf,OAAO,KAAK,KAAK;4BACjB,aAAa,KAAK,WAAW;4BAC7B,qBAAqB,KAAK,mBAAmB;4BAC7C,WAAW,KAAK,SAAS;4BACzB,WAAW,KAAK,SAAS;wBAC3B;oBACF;gBACF;gBACA,OAAO,IAAI,IAAI,CAAC;oBACd,QAAQ;oBACR,OAAO;oBACP,MAAM;wBACJ,IAAI,KAAK,EAAE;wBACX,OAAO,KAAK,KAAK;wBACjB,eAAe,KAAK,aAAa;wBACjC,MAAM,KAAK,IAAI;wBACf,OAAO,KAAK,KAAK;wBACjB,aAAa,KAAK,WAAW;wBAC7B,qBAAqB,KAAK,mBAAmB;wBAC7C,WAAW,KAAK,SAAS;wBACzB,WAAW,KAAK,SAAS;oBAC3B;gBACF;YACF;YAEF,2BAA2B,CAAA,GAAA,iLAAA,CAAA,IAAkB,AAAD,EAC1C,iCACA;gBACE,QAAQ;gBACR,MAAM,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;oBACb,aAAa,sIAAA,CAAA,IAAC,CAAC,MAAM;gBACvB;YACF,GACA,OAAO;gBACL,MAAM,OAAO,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;oBAC7C,OAAO;oBACP,OAAO;wBACL;4BACE,OAAO,IAAI,IAAI,CAAC,WAAW;4BAC3B,OAAO,KAAK,WAAW;wBACzB;qBACD;gBACH;gBACA,IAAI,CAAC,MAAM;oBACT,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,eAAe;wBAChC,SAAS;oBACX;gBACF;gBACA,MAAM,OAAO,YAAY,KAAK,SAAS;gBACvC,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,uBAAuB,CAAC;oBACxD,OAAO;oBACP,YAAY,GAAG,IAAI,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC;oBACrD,WAAW,CAAA,GAAA,iLAAA,CAAA,IAAO,AAAD,EAAE,KAAK,SAAS,EAAE;gBACrC;gBACA,MAAM,SAAS,wBACb;oBACE,aAAa,IAAI,IAAI,CAAC,WAAW;oBACjC;gBACF,GACA,IAAI,OAAO;gBAEb,OAAO,IAAI,IAAI,CAAC;oBACd,QAAQ;gBACV;YACF;YAEF,0BAA0B,CAAA,GAAA,iLAAA,CAAA,IAAkB,AAAD,EACzC,gCACA;gBACE,QAAQ;gBACR,MAAM,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;oBACb,KAAK,sIAAA,CAAA,IAAC,CAAC,MAAM;oBACb,aAAa,sIAAA,CAAA,IAAC,CAAC,MAAM;oBACrB,aAAa,sIAAA,CAAA,IAAC,CAAC,MAAM;gBACvB;YACF,GACA,OAAO;gBACL,MAAM,eAAe,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,qBAAqB,CAC1E,GAAG,IAAI,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC;gBAE3C,IAAI,CAAC,cAAc;oBACjB,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,eAAe;wBAChC,SAAS,YAAY,aAAa;oBACpC;gBACF;gBACA,IAAI,aAAa,SAAS,GAAG,aAAa,GAAG,IAAI,QAAQ;oBACvD,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,eAAe;wBAChC,SAAS,YAAY,WAAW;oBAClC;gBACF;gBACA,IAAI,aAAa,KAAK,KAAK,IAAI,IAAI,CAAC,GAAG,EAAE;oBACvC,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,eAAe;wBAChC,SAAS,YAAY,WAAW;oBAClC;gBACF;gBACA,MAAM,OAAO,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;oBAC7C,OAAO;oBACP,OAAO;wBACL;4BACE,OAAO;4BACP,OAAO,IAAI,IAAI,CAAC,WAAW;wBAC7B;qBACD;gBACH;gBACA,IAAI,CAAC,MAAM;oBACT,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,eAAe;wBAChC,SAAS,YAAY,gBAAgB;oBACvC;gBACF;gBACA,MAAM,iBAAiB,MAAM,IAAI,OAAO,CAAC,QAAQ,CAAC,IAAI,CACpD,IAAI,IAAI,CAAC,WAAW;gBAEtB,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,cAAc,CAC9C,KAAK,EAAE,EACP;gBAEF,OAAO,IAAI,IAAI,CAAC;oBACd,QAAQ;gBACV;YACF;QAEJ;QACA,QAAQ,CAAA,GAAA,iLAAA,CAAA,IAAW,AAAD,EAAE,QAAQ,SAAS;QACrC,cAAc;IAChB;AACF;AACA,MAAM,SAAS;IACb,MAAM;QACJ,QAAQ;YACN,aAAa;gBACX,MAAM;gBACN,UAAU;gBACV,QAAQ;gBACR,UAAU;gBACV,UAAU;YACZ;YACA,qBAAqB;gBACnB,MAAM;gBACN,UAAU;gBACV,UAAU;gBACV,OAAO;YACT;QACF;IACF;AACF","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 2404, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/anonymous/index.mjs"],"sourcesContent":["import { APIError } from 'better-call';\nimport { c as createAuthMiddleware, a as createAuthEndpoint, g as getSessionFromCtx } from '../../shared/better-auth.C92a320y.mjs';\nimport 'zod';\nimport { parseSetCookieHeader, setSessionCookie } from '../../cookies/index.mjs';\nimport { m as mergeSchema } from '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport { g as getOrigin } from '../../shared/better-auth.VTXNLFMT.mjs';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport 'jose';\nimport '@better-auth/utils/hash';\nimport '@better-auth/utils/base64';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '../../shared/better-auth.CW6D9eSx.mjs';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport '../../shared/better-auth.B4Qoxdgc.mjs';\nimport '@better-auth/utils/random';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '@better-auth/utils/hmac';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport 'jose/errors';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '@better-auth/utils/binary';\n\nconst schema = {\n  user: {\n    fields: {\n      isAnonymous: {\n        type: \"boolean\",\n        required: false\n      }\n    }\n  }\n};\nconst anonymous = (options) => {\n  const ERROR_CODES = {\n    FAILED_TO_CREATE_USER: \"Failed to create user\",\n    COULD_NOT_CREATE_SESSION: \"Could not create session\",\n    ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY: \"Anonymous users cannot sign in again anonymously\"\n  };\n  return {\n    id: \"anonymous\",\n    endpoints: {\n      signInAnonymous: createAuthEndpoint(\n        \"/sign-in/anonymous\",\n        {\n          method: \"POST\",\n          metadata: {\n            openapi: {\n              description: \"Sign in anonymously\",\n              responses: {\n                200: {\n                  description: \"Sign in anonymously\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          user: {\n                            $ref: \"#/components/schemas/User\"\n                          },\n                          session: {\n                            $ref: \"#/components/schemas/Session\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const { emailDomainName = getOrigin(ctx.context.baseURL) } = options || {};\n          const id = ctx.context.generateId({ model: \"user\" });\n          const email = `temp-${id}@${emailDomainName}`;\n          const newUser = await ctx.context.internalAdapter.createUser(\n            {\n              id,\n              email,\n              emailVerified: false,\n              isAnonymous: true,\n              name: \"Anonymous\",\n              createdAt: /* @__PURE__ */ new Date(),\n              updatedAt: /* @__PURE__ */ new Date()\n            },\n            ctx\n          );\n          if (!newUser) {\n            throw ctx.error(\"INTERNAL_SERVER_ERROR\", {\n              message: ERROR_CODES.FAILED_TO_CREATE_USER\n            });\n          }\n          const session = await ctx.context.internalAdapter.createSession(\n            newUser.id,\n            ctx.request\n          );\n          if (!session) {\n            return ctx.json(null, {\n              status: 400,\n              body: {\n                message: ERROR_CODES.COULD_NOT_CREATE_SESSION\n              }\n            });\n          }\n          await setSessionCookie(ctx, {\n            session,\n            user: newUser\n          });\n          return ctx.json({\n            token: session.token,\n            user: {\n              id: newUser.id,\n              email: newUser.email,\n              emailVerified: newUser.emailVerified,\n              name: newUser.name,\n              createdAt: newUser.createdAt,\n              updatedAt: newUser.updatedAt\n            }\n          });\n        }\n      )\n    },\n    hooks: {\n      after: [\n        {\n          matcher(ctx) {\n            return ctx.path.startsWith(\"/sign-in\") || ctx.path.startsWith(\"/sign-up\") || ctx.path.startsWith(\"/callback\") || ctx.path.startsWith(\"/oauth2/callback\") || ctx.path.startsWith(\"/magic-link/verify\") || ctx.path.startsWith(\"/email-otp/verify-email\");\n          },\n          handler: createAuthMiddleware(async (ctx) => {\n            const setCookie = ctx.context.responseHeaders?.get(\"set-cookie\");\n            const sessionTokenName = ctx.context.authCookies.sessionToken.name;\n            const sessionCookie = parseSetCookieHeader(setCookie || \"\").get(sessionTokenName)?.value.split(\".\")[0];\n            if (!sessionCookie) {\n              return;\n            }\n            const session = await getSessionFromCtx(\n              ctx,\n              {\n                disableRefresh: true\n              }\n            );\n            if (!session || !session.user.isAnonymous) {\n              return;\n            }\n            if (ctx.path === \"/sign-in/anonymous\") {\n              throw new APIError(\"BAD_REQUEST\", {\n                message: ERROR_CODES.ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY\n              });\n            }\n            const newSession = ctx.context.newSession;\n            if (!newSession) {\n              return;\n            }\n            if (options?.onLinkAccount) {\n              await options?.onLinkAccount?.({\n                anonymousUser: session,\n                newUser: newSession\n              });\n            }\n            if (!options?.disableDeleteAnonymousUser) {\n              await ctx.context.internalAdapter.deleteUser(session.user.id);\n            }\n          })\n        }\n      ]\n    },\n    schema: mergeSchema(schema, options?.schema),\n    $ERROR_CODES: ERROR_CODES\n  };\n};\n\nexport { anonymous };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 2609, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/admin/access/index.mjs"],"sourcesContent":["import { createAccessControl } from '../../access/index.mjs';\nimport '../../../shared/better-auth.DdzSJf-n.mjs';\n\nconst defaultStatements = {\n  user: [\n    \"create\",\n    \"list\",\n    \"set-role\",\n    \"ban\",\n    \"impersonate\",\n    \"delete\",\n    \"set-password\"\n  ],\n  session: [\"list\", \"revoke\", \"delete\"]\n};\nconst defaultAc = createAccessControl(defaultStatements);\nconst adminAc = defaultAc.newRole({\n  user: [\n    \"create\",\n    \"list\",\n    \"set-role\",\n    \"ban\",\n    \"impersonate\",\n    \"delete\",\n    \"set-password\"\n  ],\n  session: [\"list\", \"revoke\", \"delete\"]\n});\nconst userAc = defaultAc.newRole({\n  user: [],\n  session: []\n});\nconst defaultRoles = {\n  admin: adminAc,\n  user: userAc\n};\n\nexport { adminAc, defaultAc, defaultRoles, defaultStatements, userAc };\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;;;AAEA,MAAM,oBAAoB;IACxB,MAAM;QACJ;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACD,SAAS;QAAC;QAAQ;QAAU;KAAS;AACvC;AACA,MAAM,YAAY,CAAA,GAAA,uKAAA,CAAA,sBAAmB,AAAD,EAAE;AACtC,MAAM,UAAU,UAAU,OAAO,CAAC;IAChC,MAAM;QACJ;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACD,SAAS;QAAC;QAAQ;QAAU;KAAS;AACvC;AACA,MAAM,SAAS,UAAU,OAAO,CAAC;IAC/B,MAAM,EAAE;IACR,SAAS,EAAE;AACb;AACA,MAAM,eAAe;IACnB,OAAO;IACP,MAAM;AACR","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 2668, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/generic-oauth/index.mjs"],"sourcesContent":["import { betterFetch } from '@better-fetch/fetch';\nimport { APIError } from 'better-call';\nimport { z } from 'zod';\nimport { a as createAuthEndpoint, s as sessionMiddleware, B as BASE_ERROR_CODES, h as handleOAuthUserInfo } from '../../shared/better-auth.C92a320y.mjs';\nimport { setSessionCookie } from '../../cookies/index.mjs';\nimport '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport { c as createAuthorizationURL, v as validateAuthorizationCode } from '../../shared/better-auth.D7syfoJW.mjs';\nimport '@better-auth/utils/hash';\nimport '@better-auth/utils/base64';\nimport { g as generateState, p as parseState } from '../../shared/better-auth.CbXAPXob.mjs';\nimport { decodeJwt } from 'jose';\nimport '../../social-providers/index.mjs';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport '../../shared/better-auth.B4Qoxdgc.mjs';\nimport '@better-auth/utils/random';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '../../shared/better-auth.CW6D9eSx.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '@better-auth/utils/hmac';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport '../../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '@better-auth/utils/binary';\n\nasync function getUserInfo(tokens, finalUserInfoUrl) {\n  if (tokens.idToken) {\n    const decoded = decodeJwt(tokens.idToken);\n    if (decoded) {\n      if (decoded.sub && decoded.email) {\n        return {\n          id: decoded.sub,\n          emailVerified: decoded.email_verified,\n          image: decoded.picture,\n          ...decoded\n        };\n      }\n    }\n  }\n  if (!finalUserInfoUrl) {\n    return null;\n  }\n  const userInfo = await betterFetch(finalUserInfoUrl, {\n    method: \"GET\",\n    headers: {\n      Authorization: `Bearer ${tokens.accessToken}`\n    }\n  });\n  return {\n    id: userInfo.data?.sub,\n    emailVerified: userInfo.data?.email_verified,\n    email: userInfo.data?.email,\n    image: userInfo.data?.picture,\n    name: userInfo.data?.name,\n    ...userInfo.data\n  };\n}\nconst genericOAuth = (options) => {\n  const ERROR_CODES = {\n    INVALID_OAUTH_CONFIGURATION: \"Invalid OAuth configuration\"\n  };\n  return {\n    id: \"generic-oauth\",\n    init: (ctx) => {\n      const genericProviders = options.config.map((c) => {\n        let finalUserInfoUrl = c.userInfoUrl;\n        return {\n          id: c.providerId,\n          name: c.providerId,\n          createAuthorizationURL(data) {\n            return createAuthorizationURL({\n              id: c.providerId,\n              options: {\n                clientId: c.clientId,\n                clientSecret: c.clientSecret,\n                redirectURI: c.redirectURI\n              },\n              authorizationEndpoint: c.authorizationUrl,\n              state: data.state,\n              codeVerifier: c.pkce ? data.codeVerifier : void 0,\n              scopes: c.scopes || [],\n              redirectURI: `${ctx.baseURL}/oauth2/callback/${c.providerId}`\n            });\n          },\n          async validateAuthorizationCode(data) {\n            let finalTokenUrl = c.tokenUrl;\n            if (c.discoveryUrl) {\n              const discovery = await betterFetch(c.discoveryUrl, {\n                method: \"GET\"\n              });\n              if (discovery.data) {\n                finalTokenUrl = discovery.data.token_endpoint;\n                finalUserInfoUrl = discovery.data.userinfo_endpoint;\n              }\n            }\n            if (!finalTokenUrl) {\n              throw new APIError(\"BAD_REQUEST\", {\n                message: \"Invalid OAuth configuration. Token URL not found.\"\n              });\n            }\n            return validateAuthorizationCode({\n              code: data.code,\n              codeVerifier: data.codeVerifier,\n              redirectURI: data.redirectURI,\n              options: {\n                clientId: c.clientId,\n                clientSecret: c.clientSecret,\n                redirectURI: c.redirectURI\n              },\n              tokenEndpoint: finalTokenUrl,\n              authentication: c.authentication\n            });\n          },\n          async getUserInfo(tokens) {\n            if (!finalUserInfoUrl) {\n              return null;\n            }\n            const userInfo = c.getUserInfo ? await c.getUserInfo(tokens) : await getUserInfo(tokens, finalUserInfoUrl);\n            if (!userInfo) {\n              return null;\n            }\n            return {\n              user: {\n                id: userInfo?.id,\n                email: userInfo?.email,\n                emailVerified: userInfo?.emailVerified,\n                image: userInfo?.image,\n                name: userInfo?.name,\n                ...c.mapProfileToUser?.(userInfo)\n              },\n              data: userInfo\n            };\n          }\n        };\n      });\n      return {\n        context: {\n          socialProviders: genericProviders.concat(ctx.socialProviders)\n        }\n      };\n    },\n    endpoints: {\n      signInWithOAuth2: createAuthEndpoint(\n        \"/sign-in/oauth2\",\n        {\n          method: \"POST\",\n          body: z.object({\n            providerId: z.string({\n              description: \"The provider ID for the OAuth provider\"\n            }),\n            callbackURL: z.string({\n              description: \"The URL to redirect to after sign in\"\n            }).optional(),\n            errorCallbackURL: z.string({\n              description: \"The URL to redirect to if an error occurs\"\n            }).optional(),\n            newUserCallbackURL: z.string({\n              description: \"The URL to redirect to after login if the user is new\"\n            }).optional(),\n            disableRedirect: z.boolean({\n              description: \"Disable redirect\"\n            }).optional(),\n            scopes: z.array(z.string(), {\n              message: \"Scopes to be passed to the provider authorization request.\"\n            }).optional(),\n            requestSignUp: z.boolean({\n              description: \"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider\"\n            }).optional()\n          }),\n          metadata: {\n            openapi: {\n              description: \"Sign in with OAuth2\",\n              responses: {\n                200: {\n                  description: \"Sign in with OAuth2\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          url: {\n                            type: \"string\"\n                          },\n                          redirect: {\n                            type: \"boolean\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const { providerId } = ctx.body;\n          const config = options.config.find(\n            (c) => c.providerId === providerId\n          );\n          if (!config) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: `No config found for provider ${providerId}`\n            });\n          }\n          const {\n            discoveryUrl,\n            authorizationUrl,\n            tokenUrl,\n            clientId,\n            clientSecret,\n            scopes,\n            redirectURI,\n            responseType,\n            pkce,\n            prompt,\n            accessType,\n            authorizationUrlParams\n          } = config;\n          let finalAuthUrl = authorizationUrl;\n          let finalTokenUrl = tokenUrl;\n          if (discoveryUrl) {\n            const discovery = await betterFetch(discoveryUrl, {\n              onError(context) {\n                ctx.context.logger.error(context.error.message, context.error, {\n                  discoveryUrl\n                });\n              }\n            });\n            if (discovery.data) {\n              finalAuthUrl = discovery.data.authorization_endpoint;\n              finalTokenUrl = discovery.data.token_endpoint;\n            }\n          }\n          if (!finalAuthUrl || !finalTokenUrl) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.INVALID_OAUTH_CONFIGURATION\n            });\n          }\n          if (authorizationUrlParams) {\n            const withAdditionalParams = new URL(finalAuthUrl);\n            for (const [paramName, paramValue] of Object.entries(\n              authorizationUrlParams\n            )) {\n              withAdditionalParams.searchParams.set(paramName, paramValue);\n            }\n            finalAuthUrl = withAdditionalParams.toString();\n          }\n          const { state, codeVerifier } = await generateState(ctx);\n          const authUrl = await createAuthorizationURL({\n            id: providerId,\n            options: {\n              clientId,\n              redirectURI\n            },\n            authorizationEndpoint: finalAuthUrl,\n            state,\n            codeVerifier: pkce ? codeVerifier : void 0,\n            scopes: ctx.body.scopes ? [...ctx.body.scopes, ...scopes || []] : scopes || [],\n            redirectURI: `${ctx.context.baseURL}/oauth2/callback/${providerId}`\n          });\n          if (responseType && responseType !== \"code\") {\n            authUrl.searchParams.set(\"response_type\", responseType);\n          }\n          if (prompt) {\n            authUrl.searchParams.set(\"prompt\", prompt);\n          }\n          if (accessType) {\n            authUrl.searchParams.set(\"access_type\", accessType);\n          }\n          return ctx.json({\n            url: authUrl.toString(),\n            redirect: !ctx.body.disableRedirect\n          });\n        }\n      ),\n      oAuth2Callback: createAuthEndpoint(\n        \"/oauth2/callback/:providerId\",\n        {\n          method: \"GET\",\n          query: z.object({\n            code: z.string({\n              description: \"The OAuth2 code\"\n            }).optional(),\n            error: z.string({\n              description: \"The error message, if any\"\n            }).optional(),\n            error_description: z.string({\n              description: \"The error description, if any\"\n            }).optional(),\n            state: z.string({\n              description: \"The state parameter from the OAuth2 request\"\n            }).optional()\n          }),\n          metadata: {\n            openapi: {\n              description: \"OAuth2 callback\",\n              responses: {\n                200: {\n                  description: \"OAuth2 callback\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          url: {\n                            type: \"string\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const defaultErrorURL = ctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`;\n          if (ctx.query.error || !ctx.query.code) {\n            throw ctx.redirect(\n              `${defaultErrorURL}?error=${ctx.query.error || \"oAuth_code_missing\"}&error_description=${ctx.query.error_description}`\n            );\n          }\n          const provider = options.config.find(\n            (p) => p.providerId === ctx.params.providerId\n          );\n          if (!provider) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: `No config found for provider ${ctx.params.providerId}`\n            });\n          }\n          let tokens = void 0;\n          const parsedState = await parseState(ctx);\n          const {\n            callbackURL,\n            codeVerifier,\n            errorURL,\n            requestSignUp,\n            newUserURL,\n            link\n          } = parsedState;\n          const code = ctx.query.code;\n          function redirectOnError(error) {\n            throw ctx.redirect(\n              `${errorURL || callbackURL || `${ctx.context.baseURL}/error`}?error=${error}`\n            );\n          }\n          let finalTokenUrl = provider.tokenUrl;\n          let finalUserInfoUrl = provider.userInfoUrl;\n          if (provider.discoveryUrl) {\n            const discovery = await betterFetch(provider.discoveryUrl, {\n              method: \"GET\"\n            });\n            if (discovery.data) {\n              finalTokenUrl = discovery.data.token_endpoint;\n              finalUserInfoUrl = discovery.data.userinfo_endpoint;\n            }\n          }\n          try {\n            if (!finalTokenUrl) {\n              throw new APIError(\"BAD_REQUEST\", {\n                message: \"Invalid OAuth configuration.\"\n              });\n            }\n            tokens = await validateAuthorizationCode({\n              code,\n              codeVerifier: provider.pkce ? codeVerifier : void 0,\n              redirectURI: `${ctx.context.baseURL}/oauth2/callback/${provider.providerId}`,\n              options: {\n                clientId: provider.clientId,\n                clientSecret: provider.clientSecret,\n                redirectURI: provider.redirectURI\n              },\n              tokenEndpoint: finalTokenUrl\n            });\n          } catch (e) {\n            ctx.context.logger.error(\n              e && typeof e === \"object\" && \"name\" in e ? e.name : \"\",\n              e\n            );\n            throw redirectOnError(\"oauth_code_verification_failed\");\n          }\n          if (!tokens) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: \"Invalid OAuth configuration.\"\n            });\n          }\n          const userInfo = provider.getUserInfo ? await provider.getUserInfo(tokens) : await getUserInfo(tokens, finalUserInfoUrl);\n          if (!userInfo?.email) {\n            ctx.context.logger.error(\"Unable to get user info\", userInfo);\n            throw redirectOnError(\"email_is_missing\");\n          }\n          const mapUser = provider.mapProfileToUser ? await provider.mapProfileToUser(userInfo) : null;\n          if (link) {\n            if (ctx.context.options.account?.accountLinking?.allowDifferentEmails !== true && link.email !== userInfo.email.toLowerCase()) {\n              return redirectOnError(\"email_doesn't_match\");\n            }\n            const newAccount = await ctx.context.internalAdapter.createAccount({\n              userId: link.userId,\n              providerId: provider.providerId,\n              accountId: userInfo.id,\n              accessToken: tokens.accessToken,\n              refreshToken: tokens.refreshToken,\n              accessTokenExpiresAt: tokens.accessTokenExpiresAt,\n              refreshTokenExpiresAt: tokens.refreshTokenExpiresAt,\n              scope: tokens.scopes?.join(\",\")\n            });\n            if (!newAccount) {\n              return redirectOnError(\"unable_to_link_account\");\n            }\n            let toRedirectTo2;\n            try {\n              const url = callbackURL;\n              toRedirectTo2 = url.toString();\n            } catch {\n              toRedirectTo2 = callbackURL;\n            }\n            throw ctx.redirect(toRedirectTo2);\n          }\n          const result = await handleOAuthUserInfo(ctx, {\n            userInfo: {\n              ...userInfo,\n              ...mapUser\n            },\n            account: {\n              providerId: provider.providerId,\n              accountId: userInfo.id,\n              ...tokens,\n              scope: tokens.scopes?.join(\",\")\n            },\n            disableSignUp: provider.disableImplicitSignUp && !requestSignUp || provider.disableSignUp\n          });\n          if (result.error) {\n            return redirectOnError(result.error.split(\" \").join(\"_\"));\n          }\n          const { session, user } = result.data;\n          await setSessionCookie(ctx, {\n            session,\n            user\n          });\n          let toRedirectTo;\n          try {\n            const url = result.isRegister ? newUserURL || callbackURL : callbackURL;\n            toRedirectTo = url.toString();\n          } catch {\n            toRedirectTo = result.isRegister ? newUserURL || callbackURL : callbackURL;\n          }\n          throw ctx.redirect(toRedirectTo);\n        }\n      ),\n      oAuth2LinkAccount: createAuthEndpoint(\n        \"/oauth2/link\",\n        {\n          method: \"POST\",\n          body: z.object({\n            providerId: z.string(),\n            callbackURL: z.string()\n          }),\n          use: [sessionMiddleware]\n        },\n        async (c) => {\n          const session = c.context.session;\n          const account = await c.context.internalAdapter.findAccounts(\n            session.user.id\n          );\n          const existingAccount = account.find(\n            (a) => a.providerId === c.body.providerId\n          );\n          if (existingAccount) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: BASE_ERROR_CODES.SOCIAL_ACCOUNT_ALREADY_LINKED\n            });\n          }\n          const provider = options.config.find(\n            (p) => p.providerId === c.body.providerId\n          );\n          if (!provider) {\n            throw new APIError(\"NOT_FOUND\", {\n              message: BASE_ERROR_CODES.PROVIDER_NOT_FOUND\n            });\n          }\n          const {\n            providerId,\n            clientId,\n            clientSecret,\n            redirectURI,\n            authorizationUrl,\n            discoveryUrl,\n            pkce,\n            scopes\n          } = provider;\n          let finalAuthUrl = authorizationUrl;\n          if (!finalAuthUrl) {\n            if (!discoveryUrl) {\n              throw new APIError(\"BAD_REQUEST\", {\n                message: ERROR_CODES.INVALID_OAUTH_CONFIGURATION\n              });\n            }\n            const discovery = await betterFetch(discoveryUrl, {\n              onError(context) {\n                c.context.logger.error(context.error.message, context.error, {\n                  discoveryUrl\n                });\n              }\n            });\n            if (discovery.data) {\n              finalAuthUrl = discovery.data.authorization_endpoint;\n            }\n          }\n          if (!finalAuthUrl) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.INVALID_OAUTH_CONFIGURATION\n            });\n          }\n          const state = await generateState(c, {\n            userId: session.user.id,\n            email: session.user.email\n          });\n          const url = await createAuthorizationURL({\n            id: providerId,\n            options: {\n              clientId,\n              redirectURI: redirectURI || `${c.context.baseURL}/oauth2/callback`\n            },\n            authorizationEndpoint: finalAuthUrl,\n            state: state.state,\n            codeVerifier: pkce ? state.codeVerifier : void 0,\n            scopes: scopes || [],\n            redirectURI: `${c.context.baseURL}/oauth2/callback/${providerId}`\n          });\n          return c.json({\n            url: url.toString(),\n            redirect: true\n          });\n        }\n      )\n    },\n    $ERROR_CODES: ERROR_CODES\n  };\n};\n\nexport { genericOAuth };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 3199, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/jwt/index.mjs"],"sourcesContent":["import { s as schema } from '../../shared/better-auth.fsvwNeUx.mjs';\nimport { generateKeyPair, exportJWK, importJWK, SignJWT } from 'jose';\nimport 'better-call';\nimport { c as createAuthMiddleware, a as createAuthEndpoint, s as sessionMiddleware } from '../../shared/better-auth.C92a320y.mjs';\nimport 'zod';\nimport { B as BetterAuthError } from '../../shared/better-auth.DdzSJf-n.mjs';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport '@better-auth/utils/base64';\nimport '@better-auth/utils/hmac';\nimport { m as mergeSchema } from '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport { symmetricEncrypt, symmetricDecrypt } from '../../crypto/index.mjs';\nimport '../../cookies/index.mjs';\nimport '../../shared/better-auth.CW6D9eSx.mjs';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport '@better-auth/utils/hash';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport '../../shared/better-auth.B4Qoxdgc.mjs';\nimport '@better-auth/utils/random';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport '../../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '@better-auth/utils/binary';\nimport '../../shared/better-auth.OT3XFeFk.mjs';\n\nconst getJwksAdapter = (adapter) => {\n  return {\n    getAllKeys: async () => {\n      return await adapter.findMany({\n        model: \"jwks\"\n      });\n    },\n    getLatestKey: async () => {\n      const key = await adapter.findMany({\n        model: \"jwks\",\n        sortBy: {\n          field: \"createdAt\",\n          direction: \"desc\"\n        },\n        limit: 1\n      });\n      return key[0];\n    },\n    createJwk: async (webKey) => {\n      const jwk = await adapter.create({\n        model: \"jwks\",\n        data: {\n          ...webKey,\n          createdAt: /* @__PURE__ */ new Date()\n        }\n      });\n      return jwk;\n    }\n  };\n};\n\nasync function getJwtToken(ctx, options) {\n  const adapter = getJwksAdapter(ctx.context.adapter);\n  let key = await adapter.getLatestKey();\n  const privateKeyEncryptionEnabled = !options?.jwks?.disablePrivateKeyEncryption;\n  if (key === void 0) {\n    const { publicKey, privateKey: privateKey2 } = await generateKeyPair(\n      options?.jwks?.keyPairConfig?.alg ?? \"EdDSA\",\n      options?.jwks?.keyPairConfig ?? {\n        crv: \"Ed25519\",\n        extractable: true\n      }\n    );\n    const publicWebKey = await exportJWK(publicKey);\n    const privateWebKey2 = await exportJWK(privateKey2);\n    const stringifiedPrivateWebKey = JSON.stringify(privateWebKey2);\n    let jwk = {\n      id: ctx.context.generateId({\n        model: \"jwks\"\n      }),\n      publicKey: JSON.stringify(publicWebKey),\n      privateKey: privateKeyEncryptionEnabled ? JSON.stringify(\n        await symmetricEncrypt({\n          key: ctx.context.secret,\n          data: stringifiedPrivateWebKey\n        })\n      ) : stringifiedPrivateWebKey,\n      createdAt: /* @__PURE__ */ new Date()\n    };\n    key = await adapter.createJwk(jwk);\n  }\n  let privateWebKey = privateKeyEncryptionEnabled ? await symmetricDecrypt({\n    key: ctx.context.secret,\n    data: JSON.parse(key.privateKey)\n  }).catch(() => {\n    throw new BetterAuthError(\n      \"Failed to decrypt private private key. Make sure the secret currently in use is the same as the one used to encrypt the private key. If you are using a different secret, either cleanup your jwks or disable private key encryption.\"\n    );\n  }) : key.privateKey;\n  const privateKey = await importJWK(\n    JSON.parse(privateWebKey),\n    options?.jwks?.keyPairConfig?.alg ?? \"EdDSA\"\n  );\n  const payload = !options?.jwt?.definePayload ? ctx.context.session.user : await options?.jwt.definePayload(ctx.context.session);\n  const jwt2 = await new SignJWT(payload).setProtectedHeader({\n    alg: options?.jwks?.keyPairConfig?.alg ?? \"EdDSA\",\n    kid: key.id\n  }).setIssuedAt().setIssuer(options?.jwt?.issuer ?? ctx.context.options.baseURL).setAudience(options?.jwt?.audience ?? ctx.context.options.baseURL).setExpirationTime(options?.jwt?.expirationTime ?? \"15m\").setSubject(ctx.context.session.user.id).sign(privateKey);\n  return jwt2;\n}\nconst jwt = (options) => {\n  return {\n    id: \"jwt\",\n    endpoints: {\n      getJwks: createAuthEndpoint(\n        \"/jwks\",\n        {\n          method: \"GET\",\n          metadata: {\n            openapi: {\n              description: \"Get the JSON Web Key Set\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          keys: {\n                            type: \"array\",\n                            items: {\n                              type: \"object\",\n                              properties: {\n                                kid: {\n                                  type: \"string\"\n                                },\n                                kty: {\n                                  type: \"string\"\n                                },\n                                use: {\n                                  type: \"string\"\n                                },\n                                alg: {\n                                  type: \"string\"\n                                },\n                                n: {\n                                  type: \"string\"\n                                },\n                                e: {\n                                  type: \"string\"\n                                }\n                              }\n                            }\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const adapter = getJwksAdapter(ctx.context.adapter);\n          const keySets = await adapter.getAllKeys();\n          if (keySets.length === 0) {\n            const alg = options?.jwks?.keyPairConfig?.alg ?? \"EdDSA\";\n            const { publicKey, privateKey } = await generateKeyPair(\n              alg,\n              options?.jwks?.keyPairConfig ?? {\n                crv: \"Ed25519\",\n                extractable: true\n              }\n            );\n            const publicWebKey = await exportJWK(publicKey);\n            const privateWebKey = await exportJWK(privateKey);\n            const stringifiedPrivateWebKey = JSON.stringify(privateWebKey);\n            const privateKeyEncryptionEnabled = !options?.jwks?.disablePrivateKeyEncryption;\n            let jwk = {\n              id: ctx.context.generateId({\n                model: \"jwks\"\n              }),\n              publicKey: JSON.stringify({ alg, ...publicWebKey }),\n              privateKey: privateKeyEncryptionEnabled ? JSON.stringify(\n                await symmetricEncrypt({\n                  key: ctx.context.secret,\n                  data: stringifiedPrivateWebKey\n                })\n              ) : stringifiedPrivateWebKey,\n              createdAt: /* @__PURE__ */ new Date()\n            };\n            await adapter.createJwk(jwk);\n            return ctx.json({\n              keys: [\n                {\n                  ...publicWebKey,\n                  alg,\n                  kid: jwk.id\n                }\n              ]\n            });\n          }\n          return ctx.json({\n            keys: keySets.map((keySet) => ({\n              ...JSON.parse(keySet.publicKey),\n              kid: keySet.id\n            }))\n          });\n        }\n      ),\n      getToken: createAuthEndpoint(\n        \"/token\",\n        {\n          method: \"GET\",\n          requireHeaders: true,\n          use: [sessionMiddleware],\n          metadata: {\n            openapi: {\n              description: \"Get a JWT token\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          token: {\n                            type: \"string\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const jwt2 = await getJwtToken(ctx, options);\n          return ctx.json({\n            token: jwt2\n          });\n        }\n      )\n    },\n    hooks: {\n      after: [\n        {\n          matcher(context) {\n            return context.path === \"/get-session\";\n          },\n          handler: createAuthMiddleware(async (ctx) => {\n            const session = ctx.context.session || ctx.context.newSession;\n            if (session && session.session) {\n              const jwt2 = await getJwtToken(ctx, options);\n              ctx.setHeader(\"set-auth-jwt\", jwt2);\n              ctx.setHeader(\"Access-Control-Expose-Headers\", \"set-auth-jwt\");\n            }\n          })\n        }\n      ]\n    },\n    schema: mergeSchema(schema, options?.schema)\n  };\n};\n\nexport { getJwtToken, jwt };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 3499, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/multi-session/index.mjs"],"sourcesContent":["import { z } from 'zod';\nimport { APIError } from 'better-call';\nimport { c as createAuthMiddleware, a as createAuthEndpoint, s as sessionMiddleware } from '../../shared/better-auth.C92a320y.mjs';\nimport { parseSetCookieHeader, parseCookies, setSessionCookie, deleteSessionCookie } from '../../cookies/index.mjs';\nimport '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport 'jose';\nimport '@better-auth/utils/hash';\nimport '@better-auth/utils/base64';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '../../shared/better-auth.CW6D9eSx.mjs';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport '../../shared/better-auth.B4Qoxdgc.mjs';\nimport '@better-auth/utils/random';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '@better-auth/utils/hmac';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport '../../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '@better-auth/utils/binary';\n\nconst multiSession = (options) => {\n  const opts = {\n    maximumSessions: 5,\n    ...options\n  };\n  const isMultiSessionCookie = (key) => key.includes(\"_multi-\");\n  const ERROR_CODES = {\n    INVALID_SESSION_TOKEN: \"Invalid session token\"\n  };\n  return {\n    id: \"multi-session\",\n    endpoints: {\n      listDeviceSessions: createAuthEndpoint(\n        \"/multi-session/list-device-sessions\",\n        {\n          method: \"GET\",\n          requireHeaders: true\n        },\n        async (ctx) => {\n          const cookieHeader = ctx.headers?.get(\"cookie\");\n          if (!cookieHeader) return ctx.json([]);\n          const cookies = Object.fromEntries(parseCookies(cookieHeader));\n          const sessionTokens = (await Promise.all(\n            Object.entries(cookies).filter(([key]) => isMultiSessionCookie(key)).map(\n              async ([key]) => await ctx.getSignedCookie(key, ctx.context.secret)\n            )\n          )).filter((v) => v !== null);\n          if (!sessionTokens.length) return ctx.json([]);\n          const sessions = await ctx.context.internalAdapter.findSessions(sessionTokens);\n          const validSessions = sessions.filter(\n            (session) => session && session.session.expiresAt > /* @__PURE__ */ new Date()\n          );\n          const uniqueUserSessions = validSessions.reduce(\n            (acc, session) => {\n              if (!acc.find((s) => s.user.id === session.user.id)) {\n                acc.push(session);\n              }\n              return acc;\n            },\n            []\n          );\n          return ctx.json(uniqueUserSessions);\n        }\n      ),\n      setActiveSession: createAuthEndpoint(\n        \"/multi-session/set-active\",\n        {\n          method: \"POST\",\n          body: z.object({\n            sessionToken: z.string({\n              description: \"The session token to set as active\"\n            })\n          }),\n          requireHeaders: true,\n          use: [sessionMiddleware],\n          metadata: {\n            openapi: {\n              description: \"Set the active session\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          session: {\n                            $ref: \"#/components/schemas/Session\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const sessionToken = ctx.body.sessionToken;\n          const multiSessionCookieName = `${ctx.context.authCookies.sessionToken.name}_multi-${sessionToken.toLowerCase()}`;\n          const sessionCookie = await ctx.getSignedCookie(\n            multiSessionCookieName,\n            ctx.context.secret\n          );\n          if (!sessionCookie) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: ERROR_CODES.INVALID_SESSION_TOKEN\n            });\n          }\n          const session = await ctx.context.internalAdapter.findSession(sessionToken);\n          if (!session || session.session.expiresAt < /* @__PURE__ */ new Date()) {\n            ctx.setCookie(multiSessionCookieName, \"\", {\n              ...ctx.context.authCookies.sessionToken.options,\n              maxAge: 0\n            });\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: ERROR_CODES.INVALID_SESSION_TOKEN\n            });\n          }\n          await setSessionCookie(ctx, session);\n          return ctx.json(session);\n        }\n      ),\n      revokeDeviceSession: createAuthEndpoint(\n        \"/multi-session/revoke\",\n        {\n          method: \"POST\",\n          body: z.object({\n            sessionToken: z.string({\n              description: \"The session token to revoke\"\n            })\n          }),\n          requireHeaders: true,\n          use: [sessionMiddleware],\n          metadata: {\n            openapi: {\n              description: \"Revoke a device session\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          status: {\n                            type: \"boolean\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const sessionToken = ctx.body.sessionToken;\n          const multiSessionCookieName = `${ctx.context.authCookies.sessionToken.name}_multi-${sessionToken.toLowerCase()}`;\n          const sessionCookie = await ctx.getSignedCookie(\n            multiSessionCookieName,\n            ctx.context.secret\n          );\n          if (!sessionCookie) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: ERROR_CODES.INVALID_SESSION_TOKEN\n            });\n          }\n          await ctx.context.internalAdapter.deleteSession(sessionToken);\n          ctx.setCookie(multiSessionCookieName, \"\", {\n            ...ctx.context.authCookies.sessionToken.options,\n            maxAge: 0\n          });\n          const isActive = ctx.context.session?.session.token === sessionToken;\n          if (!isActive) return ctx.json({ status: true });\n          const cookieHeader = ctx.headers?.get(\"cookie\");\n          if (cookieHeader) {\n            const cookies = Object.fromEntries(parseCookies(cookieHeader));\n            const sessionTokens = (await Promise.all(\n              Object.entries(cookies).filter(([key]) => isMultiSessionCookie(key)).map(\n                async ([key]) => await ctx.getSignedCookie(key, ctx.context.secret)\n              )\n            )).filter((v) => v !== void 0);\n            const internalAdapter = ctx.context.internalAdapter;\n            if (sessionTokens.length > 0) {\n              const sessions = await internalAdapter.findSessions(sessionTokens);\n              const validSessions = sessions.filter(\n                (session) => session && session.session.expiresAt > /* @__PURE__ */ new Date()\n              );\n              if (validSessions.length > 0) {\n                const nextSession = validSessions[0];\n                await setSessionCookie(ctx, nextSession);\n              } else {\n                deleteSessionCookie(ctx);\n              }\n            } else {\n              deleteSessionCookie(ctx);\n            }\n          } else {\n            deleteSessionCookie(ctx);\n          }\n          return ctx.json({\n            status: true\n          });\n        }\n      )\n    },\n    hooks: {\n      after: [\n        {\n          matcher: () => true,\n          handler: createAuthMiddleware(async (ctx) => {\n            const cookieString = ctx.context.responseHeaders?.get(\"set-cookie\");\n            if (!cookieString) return;\n            const setCookies = parseSetCookieHeader(cookieString);\n            const sessionCookieConfig = ctx.context.authCookies.sessionToken;\n            const sessionToken = ctx.context.newSession?.session.token;\n            if (!sessionToken) return;\n            const cookies = parseCookies(ctx.headers?.get(\"cookie\") || \"\");\n            const cookieName = `${sessionCookieConfig.name}_multi-${sessionToken.toLowerCase()}`;\n            if (setCookies.get(cookieName) || cookies.get(cookieName)) return;\n            const currentMultiSessions = Object.keys(Object.fromEntries(cookies)).filter(\n              isMultiSessionCookie\n            ).length + (cookieString.includes(\"session_token\") ? 1 : 0);\n            if (currentMultiSessions >= opts.maximumSessions) {\n              return;\n            }\n            await ctx.setSignedCookie(\n              cookieName,\n              sessionToken,\n              ctx.context.secret,\n              sessionCookieConfig.options\n            );\n          })\n        },\n        {\n          matcher: (context) => context.path === \"/sign-out\",\n          handler: createAuthMiddleware(async (ctx) => {\n            const cookieHeader = ctx.headers?.get(\"cookie\");\n            if (!cookieHeader) return;\n            const cookies = Object.fromEntries(parseCookies(cookieHeader));\n            const ids = Object.keys(cookies).map((key) => {\n              if (isMultiSessionCookie(key)) {\n                ctx.setCookie(key.toLowerCase(), \"\", {\n                  ...ctx.context.authCookies.sessionToken.options,\n                  maxAge: 0\n                });\n                const token = cookies[key].split(\".\")[0];\n                return token;\n              }\n              return null;\n            }).filter((v) => v !== null);\n            await ctx.context.internalAdapter.deleteSessions(ids);\n          })\n        }\n      ]\n    },\n    $ERROR_CODES: ERROR_CODES\n  };\n};\n\nexport { multiSession };\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAKA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,MAAM,eAAe,CAAC;IACpB,MAAM,OAAO;QACX,iBAAiB;QACjB,GAAG,OAAO;IACZ;IACA,MAAM,uBAAuB,CAAC,MAAQ,IAAI,QAAQ,CAAC;IACnD,MAAM,cAAc;QAClB,uBAAuB;IACzB;IACA,OAAO;QACL,IAAI;QACJ,WAAW;YACT,oBAAoB,CAAA,GAAA,iLAAA,CAAA,IAAkB,AAAD,EACnC,uCACA;gBACE,QAAQ;gBACR,gBAAgB;YAClB,GACA,OAAO;gBACL,MAAM,eAAe,IAAI,OAAO,EAAE,IAAI;gBACtC,IAAI,CAAC,cAAc,OAAO,IAAI,IAAI,CAAC,EAAE;gBACrC,MAAM,UAAU,OAAO,WAAW,CAAC,CAAA,GAAA,6JAAA,CAAA,eAAY,AAAD,EAAE;gBAChD,MAAM,gBAAgB,CAAC,MAAM,QAAQ,GAAG,CACtC,OAAO,OAAO,CAAC,SAAS,MAAM,CAAC,CAAC,CAAC,IAAI,GAAK,qBAAqB,MAAM,GAAG,CACtE,OAAO,CAAC,IAAI,GAAK,MAAM,IAAI,eAAe,CAAC,KAAK,IAAI,OAAO,CAAC,MAAM,GAErE,EAAE,MAAM,CAAC,CAAC,IAAM,MAAM;gBACvB,IAAI,CAAC,cAAc,MAAM,EAAE,OAAO,IAAI,IAAI,CAAC,EAAE;gBAC7C,MAAM,WAAW,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,YAAY,CAAC;gBAChE,MAAM,gBAAgB,SAAS,MAAM,CACnC,CAAC,UAAY,WAAW,QAAQ,OAAO,CAAC,SAAS,GAAG,aAAa,GAAG,IAAI;gBAE1E,MAAM,qBAAqB,cAAc,MAAM,CAC7C,CAAC,KAAK;oBACJ,IAAI,CAAC,IAAI,IAAI,CAAC,CAAC,IAAM,EAAE,IAAI,CAAC,EAAE,KAAK,QAAQ,IAAI,CAAC,EAAE,GAAG;wBACnD,IAAI,IAAI,CAAC;oBACX;oBACA,OAAO;gBACT,GACA,EAAE;gBAEJ,OAAO,IAAI,IAAI,CAAC;YAClB;YAEF,kBAAkB,CAAA,GAAA,iLAAA,CAAA,IAAkB,AAAD,EACjC,6BACA;gBACE,QAAQ;gBACR,MAAM,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;oBACb,cAAc,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;wBACrB,aAAa;oBACf;gBACF;gBACA,gBAAgB;gBAChB,KAAK;oBAAC,iLAAA,CAAA,IAAiB;iBAAC;gBACxB,UAAU;oBACR,SAAS;wBACP,aAAa;wBACb,WAAW;4BACT,KAAK;gCACH,aAAa;gCACb,SAAS;oCACP,oBAAoB;wCAClB,QAAQ;4CACN,MAAM;4CACN,YAAY;gDACV,SAAS;oDACP,MAAM;gDACR;4CACF;wCACF;oCACF;gCACF;4BACF;wBACF;oBACF;gBACF;YACF,GACA,OAAO;gBACL,MAAM,eAAe,IAAI,IAAI,CAAC,YAAY;gBAC1C,MAAM,yBAAyB,GAAG,IAAI,OAAO,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,EAAE,aAAa,WAAW,IAAI;gBACjH,MAAM,gBAAgB,MAAM,IAAI,eAAe,CAC7C,wBACA,IAAI,OAAO,CAAC,MAAM;gBAEpB,IAAI,CAAC,eAAe;oBAClB,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,gBAAgB;wBACjC,SAAS,YAAY,qBAAqB;oBAC5C;gBACF;gBACA,MAAM,UAAU,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,WAAW,CAAC;gBAC9D,IAAI,CAAC,WAAW,QAAQ,OAAO,CAAC,SAAS,GAAG,aAAa,GAAG,IAAI,QAAQ;oBACtE,IAAI,SAAS,CAAC,wBAAwB,IAAI;wBACxC,GAAG,IAAI,OAAO,CAAC,WAAW,CAAC,YAAY,CAAC,OAAO;wBAC/C,QAAQ;oBACV;oBACA,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,gBAAgB;wBACjC,SAAS,YAAY,qBAAqB;oBAC5C;gBACF;gBACA,MAAM,CAAA,GAAA,6JAAA,CAAA,mBAAgB,AAAD,EAAE,KAAK;gBAC5B,OAAO,IAAI,IAAI,CAAC;YAClB;YAEF,qBAAqB,CAAA,GAAA,iLAAA,CAAA,IAAkB,AAAD,EACpC,yBACA;gBACE,QAAQ;gBACR,MAAM,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;oBACb,cAAc,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;wBACrB,aAAa;oBACf;gBACF;gBACA,gBAAgB;gBAChB,KAAK;oBAAC,iLAAA,CAAA,IAAiB;iBAAC;gBACxB,UAAU;oBACR,SAAS;wBACP,aAAa;wBACb,WAAW;4BACT,KAAK;gCACH,aAAa;gCACb,SAAS;oCACP,oBAAoB;wCAClB,QAAQ;4CACN,MAAM;4CACN,YAAY;gDACV,QAAQ;oDACN,MAAM;gDACR;4CACF;wCACF;oCACF;gCACF;4BACF;wBACF;oBACF;gBACF;YACF,GACA,OAAO;gBACL,MAAM,eAAe,IAAI,IAAI,CAAC,YAAY;gBAC1C,MAAM,yBAAyB,GAAG,IAAI,OAAO,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,EAAE,aAAa,WAAW,IAAI;gBACjH,MAAM,gBAAgB,MAAM,IAAI,eAAe,CAC7C,wBACA,IAAI,OAAO,CAAC,MAAM;gBAEpB,IAAI,CAAC,eAAe;oBAClB,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,gBAAgB;wBACjC,SAAS,YAAY,qBAAqB;oBAC5C;gBACF;gBACA,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,aAAa,CAAC;gBAChD,IAAI,SAAS,CAAC,wBAAwB,IAAI;oBACxC,GAAG,IAAI,OAAO,CAAC,WAAW,CAAC,YAAY,CAAC,OAAO;oBAC/C,QAAQ;gBACV;gBACA,MAAM,WAAW,IAAI,OAAO,CAAC,OAAO,EAAE,QAAQ,UAAU;gBACxD,IAAI,CAAC,UAAU,OAAO,IAAI,IAAI,CAAC;oBAAE,QAAQ;gBAAK;gBAC9C,MAAM,eAAe,IAAI,OAAO,EAAE,IAAI;gBACtC,IAAI,cAAc;oBAChB,MAAM,UAAU,OAAO,WAAW,CAAC,CAAA,GAAA,6JAAA,CAAA,eAAY,AAAD,EAAE;oBAChD,MAAM,gBAAgB,CAAC,MAAM,QAAQ,GAAG,CACtC,OAAO,OAAO,CAAC,SAAS,MAAM,CAAC,CAAC,CAAC,IAAI,GAAK,qBAAqB,MAAM,GAAG,CACtE,OAAO,CAAC,IAAI,GAAK,MAAM,IAAI,eAAe,CAAC,KAAK,IAAI,OAAO,CAAC,MAAM,GAErE,EAAE,MAAM,CAAC,CAAC,IAAM,MAAM,KAAK;oBAC5B,MAAM,kBAAkB,IAAI,OAAO,CAAC,eAAe;oBACnD,IAAI,cAAc,MAAM,GAAG,GAAG;wBAC5B,MAAM,WAAW,MAAM,gBAAgB,YAAY,CAAC;wBACpD,MAAM,gBAAgB,SAAS,MAAM,CACnC,CAAC,UAAY,WAAW,QAAQ,OAAO,CAAC,SAAS,GAAG,aAAa,GAAG,IAAI;wBAE1E,IAAI,cAAc,MAAM,GAAG,GAAG;4BAC5B,MAAM,cAAc,aAAa,CAAC,EAAE;4BACpC,MAAM,CAAA,GAAA,6JAAA,CAAA,mBAAgB,AAAD,EAAE,KAAK;wBAC9B,OAAO;4BACL,CAAA,GAAA,6JAAA,CAAA,sBAAmB,AAAD,EAAE;wBACtB;oBACF,OAAO;wBACL,CAAA,GAAA,6JAAA,CAAA,sBAAmB,AAAD,EAAE;oBACtB;gBACF,OAAO;oBACL,CAAA,GAAA,6JAAA,CAAA,sBAAmB,AAAD,EAAE;gBACtB;gBACA,OAAO,IAAI,IAAI,CAAC;oBACd,QAAQ;gBACV;YACF;QAEJ;QACA,OAAO;YACL,OAAO;gBACL;oBACE,SAAS,IAAM;oBACf,SAAS,CAAA,GAAA,iLAAA,CAAA,IAAoB,AAAD,EAAE,OAAO;wBACnC,MAAM,eAAe,IAAI,OAAO,CAAC,eAAe,EAAE,IAAI;wBACtD,IAAI,CAAC,cAAc;wBACnB,MAAM,aAAa,CAAA,GAAA,6JAAA,CAAA,uBAAoB,AAAD,EAAE;wBACxC,MAAM,sBAAsB,IAAI,OAAO,CAAC,WAAW,CAAC,YAAY;wBAChE,MAAM,eAAe,IAAI,OAAO,CAAC,UAAU,EAAE,QAAQ;wBACrD,IAAI,CAAC,cAAc;wBACnB,MAAM,UAAU,CAAA,GAAA,6JAAA,CAAA,eAAY,AAAD,EAAE,IAAI,OAAO,EAAE,IAAI,aAAa;wBAC3D,MAAM,aAAa,GAAG,oBAAoB,IAAI,CAAC,OAAO,EAAE,aAAa,WAAW,IAAI;wBACpF,IAAI,WAAW,GAAG,CAAC,eAAe,QAAQ,GAAG,CAAC,aAAa;wBAC3D,MAAM,uBAAuB,OAAO,IAAI,CAAC,OAAO,WAAW,CAAC,UAAU,MAAM,CAC1E,sBACA,MAAM,GAAG,CAAC,aAAa,QAAQ,CAAC,mBAAmB,IAAI,CAAC;wBAC1D,IAAI,wBAAwB,KAAK,eAAe,EAAE;4BAChD;wBACF;wBACA,MAAM,IAAI,eAAe,CACvB,YACA,cACA,IAAI,OAAO,CAAC,MAAM,EAClB,oBAAoB,OAAO;oBAE/B;gBACF;gBACA;oBACE,SAAS,CAAC,UAAY,QAAQ,IAAI,KAAK;oBACvC,SAAS,CAAA,GAAA,iLAAA,CAAA,IAAoB,AAAD,EAAE,OAAO;wBACnC,MAAM,eAAe,IAAI,OAAO,EAAE,IAAI;wBACtC,IAAI,CAAC,cAAc;wBACnB,MAAM,UAAU,OAAO,WAAW,CAAC,CAAA,GAAA,6JAAA,CAAA,eAAY,AAAD,EAAE;wBAChD,MAAM,MAAM,OAAO,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;4BACpC,IAAI,qBAAqB,MAAM;gCAC7B,IAAI,SAAS,CAAC,IAAI,WAAW,IAAI,IAAI;oCACnC,GAAG,IAAI,OAAO,CAAC,WAAW,CAAC,YAAY,CAAC,OAAO;oCAC/C,QAAQ;gCACV;gCACA,MAAM,QAAQ,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE;gCACxC,OAAO;4BACT;4BACA,OAAO;wBACT,GAAG,MAAM,CAAC,CAAC,IAAM,MAAM;wBACvB,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,cAAc,CAAC;oBACnD;gBACF;aACD;QACH;QACA,cAAc;IAChB;AACF","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 3776, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/email-otp/index.mjs"],"sourcesContent":["import { z } from 'zod';\nimport { APIError } from 'better-call';\nimport { c as createAuthMiddleware, a as createAuthEndpoint } from '../../shared/better-auth.C92a320y.mjs';\nimport { setSessionCookie } from '../../cookies/index.mjs';\nimport '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport '@better-auth/utils/hash';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@better-auth/utils/base64';\nimport 'jose';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport { g as generateRandomString } from '../../shared/better-auth.B4Qoxdgc.mjs';\nimport { g as getDate } from '../../shared/better-auth.CW6D9eSx.mjs';\nimport { g as getEndpointResponse } from '../../shared/better-auth.DQI8AD7d.mjs';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '@better-auth/utils/random';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '@better-auth/utils/hmac';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport '../../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '@better-auth/utils/binary';\n\nconst types = [\"email-verification\", \"sign-in\", \"forget-password\"];\nconst emailOTP = (options) => {\n  const opts = {\n    expiresIn: 5 * 60,\n    generateOTP: () => generateRandomString(options.otpLength ?? 6, \"0-9\"),\n    ...options\n  };\n  const ERROR_CODES = {\n    OTP_EXPIRED: \"otp expired\",\n    INVALID_OTP: \"invalid otp\",\n    INVALID_EMAIL: \"invalid email\",\n    USER_NOT_FOUND: \"user not found\"\n  };\n  return {\n    id: \"email-otp\",\n    endpoints: {\n      sendVerificationOTP: createAuthEndpoint(\n        \"/email-otp/send-verification-otp\",\n        {\n          method: \"POST\",\n          body: z.object({\n            email: z.string({\n              description: \"Email address to send the OTP\"\n            }),\n            type: z.enum(types, {\n              description: \"Type of the OTP\"\n            })\n          }),\n          metadata: {\n            openapi: {\n              description: \"Send verification OTP\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          success: {\n                            type: \"boolean\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          if (!options?.sendVerificationOTP) {\n            ctx.context.logger.error(\n              \"send email verification is not implemented\"\n            );\n            throw new APIError(\"BAD_REQUEST\", {\n              message: \"send email verification is not implemented\"\n            });\n          }\n          const email = ctx.body.email;\n          const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;\n          if (!emailRegex.test(email)) {\n            throw ctx.error(\"BAD_REQUEST\", {\n              message: ERROR_CODES.INVALID_EMAIL\n            });\n          }\n          if (ctx.body.type === \"forget-password\" || opts.disableSignUp) {\n            const user = await ctx.context.internalAdapter.findUserByEmail(email);\n            if (!user) {\n              return ctx.json({\n                success: true\n              });\n            }\n          }\n          const otp = opts.generateOTP(\n            { email, type: ctx.body.type },\n            ctx.request\n          );\n          await ctx.context.internalAdapter.createVerificationValue({\n            value: otp,\n            identifier: `${ctx.body.type}-otp-${email}`,\n            expiresAt: getDate(opts.expiresIn, \"sec\")\n          }).catch(async (error) => {\n            await ctx.context.internalAdapter.deleteVerificationByIdentifier(\n              `${ctx.body.type}-otp-${email}`\n            );\n            await ctx.context.internalAdapter.createVerificationValue({\n              value: otp,\n              identifier: `${ctx.body.type}-otp-${email}`,\n              expiresAt: getDate(opts.expiresIn, \"sec\")\n            });\n          });\n          await options.sendVerificationOTP(\n            {\n              email,\n              otp,\n              type: ctx.body.type\n            },\n            ctx.request\n          );\n          return ctx.json({\n            success: true\n          });\n        }\n      ),\n      createVerificationOTP: createAuthEndpoint(\n        \"/email-otp/create-verification-otp\",\n        {\n          method: \"POST\",\n          body: z.object({\n            email: z.string({\n              description: \"Email address to send the OTP\"\n            }),\n            type: z.enum(types, {\n              description: \"Type of the OTP\"\n            })\n          }),\n          metadata: {\n            SERVER_ONLY: true,\n            openapi: {\n              description: \"Create verification OTP\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"string\"\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const email = ctx.body.email;\n          const otp = opts.generateOTP(\n            { email, type: ctx.body.type },\n            ctx.request\n          );\n          await ctx.context.internalAdapter.createVerificationValue({\n            value: otp,\n            identifier: `${ctx.body.type}-otp-${email}`,\n            expiresAt: getDate(opts.expiresIn, \"sec\")\n          });\n          return otp;\n        }\n      ),\n      getVerificationOTP: createAuthEndpoint(\n        \"/email-otp/get-verification-otp\",\n        {\n          method: \"GET\",\n          query: z.object({\n            email: z.string({\n              description: \"Email address to get the OTP\"\n            }),\n            type: z.enum(types)\n          }),\n          metadata: {\n            SERVER_ONLY: true,\n            openapi: {\n              description: \"Get verification OTP\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          otp: {\n                            type: \"string\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const email = ctx.query.email;\n          const verificationValue = await ctx.context.internalAdapter.findVerificationValue(\n            `${ctx.query.type}-otp-${email}`\n          );\n          if (!verificationValue || verificationValue.expiresAt < /* @__PURE__ */ new Date()) {\n            return ctx.json({\n              otp: null\n            });\n          }\n          return ctx.json({\n            otp: verificationValue.value\n          });\n        }\n      ),\n      verifyEmailOTP: createAuthEndpoint(\n        \"/email-otp/verify-email\",\n        {\n          method: \"POST\",\n          body: z.object({\n            email: z.string({\n              description: \"Email address to verify\"\n            }),\n            otp: z.string({\n              description: \"OTP to verify\"\n            })\n          }),\n          metadata: {\n            openapi: {\n              description: \"Verify email OTP\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          user: {\n                            $ref: \"#/components/schemas/User\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const email = ctx.body.email;\n          const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;\n          if (!emailRegex.test(email)) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.INVALID_EMAIL\n            });\n          }\n          const verificationValue = await ctx.context.internalAdapter.findVerificationValue(\n            `email-verification-otp-${email}`\n          );\n          if (!verificationValue) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.INVALID_OTP\n            });\n          }\n          if (verificationValue.expiresAt < /* @__PURE__ */ new Date()) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.OTP_EXPIRED\n            });\n          }\n          const otp = ctx.body.otp;\n          if (verificationValue.value !== otp) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.INVALID_OTP\n            });\n          }\n          await ctx.context.internalAdapter.deleteVerificationValue(\n            verificationValue.id\n          );\n          const user = await ctx.context.internalAdapter.findUserByEmail(email);\n          if (!user) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.USER_NOT_FOUND\n            });\n          }\n          const updatedUser = await ctx.context.internalAdapter.updateUser(\n            user.user.id,\n            {\n              email,\n              emailVerified: true\n            },\n            ctx\n          );\n          if (ctx.context.options.emailVerification?.autoSignInAfterVerification) {\n            const session = await ctx.context.internalAdapter.createSession(\n              updatedUser.id,\n              ctx.request\n            );\n            await setSessionCookie(ctx, {\n              session,\n              user: updatedUser\n            });\n            return ctx.json({\n              status: true,\n              token: session.token,\n              user: {\n                id: updatedUser.id,\n                email: updatedUser.email,\n                emailVerified: updatedUser.emailVerified,\n                name: updatedUser.name,\n                image: updatedUser.image,\n                createdAt: updatedUser.createdAt,\n                updatedAt: updatedUser.updatedAt\n              }\n            });\n          }\n          return ctx.json({\n            status: true,\n            token: null,\n            user: {\n              id: updatedUser.id,\n              email: updatedUser.email,\n              emailVerified: updatedUser.emailVerified,\n              name: updatedUser.name,\n              image: updatedUser.image,\n              createdAt: updatedUser.createdAt,\n              updatedAt: updatedUser.updatedAt\n            }\n          });\n        }\n      ),\n      signInEmailOTP: createAuthEndpoint(\n        \"/sign-in/email-otp\",\n        {\n          method: \"POST\",\n          body: z.object({\n            email: z.string({\n              description: \"Email address to sign in\"\n            }),\n            otp: z.string({\n              description: \"OTP sent to the email\"\n            })\n          }),\n          metadata: {\n            openapi: {\n              description: \"Sign in with email OTP\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          user: {\n                            $ref: \"#/components/schemas/User\"\n                          },\n                          session: {\n                            $ref: \"#/components/schemas/Session\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const email = ctx.body.email;\n          const verificationValue = await ctx.context.internalAdapter.findVerificationValue(\n            `sign-in-otp-${email}`\n          );\n          if (!verificationValue) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.INVALID_OTP\n            });\n          }\n          if (verificationValue.expiresAt < /* @__PURE__ */ new Date()) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.OTP_EXPIRED\n            });\n          }\n          const otp = ctx.body.otp;\n          if (verificationValue.value !== otp) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.INVALID_OTP\n            });\n          }\n          await ctx.context.internalAdapter.deleteVerificationValue(\n            verificationValue.id\n          );\n          const user = await ctx.context.internalAdapter.findUserByEmail(email);\n          if (!user) {\n            if (opts.disableSignUp) {\n              throw new APIError(\"BAD_REQUEST\", {\n                message: ERROR_CODES.USER_NOT_FOUND\n              });\n            }\n            const newUser = await ctx.context.internalAdapter.createUser(\n              {\n                email,\n                emailVerified: true,\n                name: \"\"\n              },\n              ctx\n            );\n            const session2 = await ctx.context.internalAdapter.createSession(\n              newUser.id,\n              ctx.request\n            );\n            await setSessionCookie(ctx, {\n              session: session2,\n              user: newUser\n            });\n            return ctx.json({\n              token: session2.token,\n              user: {\n                id: newUser.id,\n                email: newUser.email,\n                emailVerified: newUser.emailVerified,\n                name: newUser.name,\n                image: newUser.image,\n                createdAt: newUser.createdAt,\n                updatedAt: newUser.updatedAt\n              }\n            });\n          }\n          if (!user.user.emailVerified) {\n            await ctx.context.internalAdapter.updateUser(\n              user.user.id,\n              {\n                emailVerified: true\n              },\n              ctx\n            );\n          }\n          const session = await ctx.context.internalAdapter.createSession(\n            user.user.id,\n            ctx.request\n          );\n          await setSessionCookie(ctx, {\n            session,\n            user: user.user\n          });\n          return ctx.json({\n            token: session.token,\n            user: {\n              id: user.user.id,\n              email: user.user.email,\n              emailVerified: user.user.emailVerified,\n              name: user.user.name,\n              image: user.user.image,\n              createdAt: user.user.createdAt,\n              updatedAt: user.user.updatedAt\n            }\n          });\n        }\n      ),\n      forgetPasswordEmailOTP: createAuthEndpoint(\n        \"/forget-password/email-otp\",\n        {\n          method: \"POST\",\n          body: z.object({\n            email: z.string({\n              description: \"Email address to send the OTP\"\n            })\n          }),\n          metadata: {\n            openapi: {\n              description: \"Forget password with email OTP\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          success: {\n                            type: \"boolean\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const email = ctx.body.email;\n          const user = await ctx.context.internalAdapter.findUserByEmail(email);\n          if (!user) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.USER_NOT_FOUND\n            });\n          }\n          const otp = opts.generateOTP(\n            { email, type: \"forget-password\" },\n            ctx.request\n          );\n          await ctx.context.internalAdapter.createVerificationValue({\n            value: otp,\n            identifier: `forget-password-otp-${email}`,\n            expiresAt: getDate(opts.expiresIn, \"sec\")\n          });\n          await options.sendVerificationOTP(\n            {\n              email,\n              otp,\n              type: \"forget-password\"\n            },\n            ctx.request\n          );\n          return ctx.json({\n            success: true\n          });\n        }\n      ),\n      resetPasswordEmailOTP: createAuthEndpoint(\n        \"/email-otp/reset-password\",\n        {\n          method: \"POST\",\n          body: z.object({\n            email: z.string({\n              description: \"Email address to reset the password\"\n            }),\n            otp: z.string({\n              description: \"OTP sent to the email\"\n            }),\n            password: z.string({\n              description: \"New password\"\n            })\n          }),\n          metadata: {\n            openapi: {\n              description: \"Reset password with email OTP\",\n              responses: {\n                200: {\n                  description: \"Success\",\n                  content: {\n                    \"application/json\": {\n                      schema: {\n                        type: \"object\",\n                        properties: {\n                          success: {\n                            type: \"boolean\"\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const email = ctx.body.email;\n          const user = await ctx.context.internalAdapter.findUserByEmail(\n            email,\n            {\n              includeAccounts: true\n            }\n          );\n          if (!user) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.USER_NOT_FOUND\n            });\n          }\n          const verificationValue = await ctx.context.internalAdapter.findVerificationValue(\n            `forget-password-otp-${email}`\n          );\n          if (!verificationValue) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.INVALID_OTP\n            });\n          }\n          if (verificationValue.expiresAt < /* @__PURE__ */ new Date()) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.OTP_EXPIRED\n            });\n          }\n          const otp = ctx.body.otp;\n          if (verificationValue.value !== otp) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.INVALID_OTP\n            });\n          }\n          await ctx.context.internalAdapter.deleteVerificationValue(\n            verificationValue.id\n          );\n          const passwordHash = await ctx.context.password.hash(\n            ctx.body.password\n          );\n          const account = user.accounts.find(\n            (account2) => account2.providerId === \"credential\"\n          );\n          if (!account) {\n            await ctx.context.internalAdapter.createAccount(\n              {\n                userId: user.user.id,\n                providerId: \"credential\",\n                accountId: user.user.id,\n                password: passwordHash\n              },\n              ctx\n            );\n          } else {\n            await ctx.context.internalAdapter.updatePassword(\n              user.user.id,\n              passwordHash,\n              ctx\n            );\n          }\n          return ctx.json({\n            success: true\n          });\n        }\n      )\n    },\n    hooks: {\n      after: [\n        {\n          matcher(context) {\n            return !!(context.path?.startsWith(\"/sign-up\") && opts.sendVerificationOnSignUp);\n          },\n          handler: createAuthMiddleware(async (ctx) => {\n            const response = await getEndpointResponse(ctx);\n            const email = response?.user.email;\n            if (email) {\n              const otp = opts.generateOTP(\n                { email, type: ctx.body.type },\n                ctx.request\n              );\n              await ctx.context.internalAdapter.createVerificationValue({\n                value: otp,\n                identifier: `email-verification-otp-${email}`,\n                expiresAt: getDate(opts.expiresIn, \"sec\")\n              });\n              await options.sendVerificationOTP(\n                {\n                  email,\n                  otp,\n                  type: \"email-verification\"\n                },\n                ctx.request\n              );\n            }\n          })\n        }\n      ]\n    },\n    $ERROR_CODES: ERROR_CODES,\n    rateLimit: [\n      {\n        pathMatcher(path) {\n          return path === \"/email-otp/send-verification-otp\";\n        },\n        window: 60,\n        max: 3\n      },\n      {\n        pathMatcher(path) {\n          return path === \"/email-otp/verify-email\";\n        },\n        window: 60,\n        max: 3\n      },\n      {\n        pathMatcher(path) {\n          return path === \"/sign-in/email-otp\";\n        },\n        window: 60,\n        max: 3\n      }\n    ]\n  };\n};\n\nexport { emailOTP };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 4430, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/one-tap/index.mjs"],"sourcesContent":["import { z } from 'zod';\nimport { APIError } from 'better-call';\nimport { a as createAuthEndpoint } from '../../shared/better-auth.C92a320y.mjs';\nimport { setSessionCookie } from '../../cookies/index.mjs';\nimport '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport { createRemoteJWKSet, jwtVerify } from 'jose';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport '@better-auth/utils/hash';\nimport '@better-auth/utils/base64';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '../../shared/better-auth.CW6D9eSx.mjs';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport '../../shared/better-auth.B4Qoxdgc.mjs';\nimport '@better-auth/utils/random';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '@better-auth/utils/hmac';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport '../../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '@better-auth/utils/binary';\n\nfunction toBoolean(value) {\n  return value === \"true\" || value === true;\n}\n\nconst oneTap = (options) => ({\n  id: \"one-tap\",\n  endpoints: {\n    oneTapCallback: createAuthEndpoint(\n      \"/one-tap/callback\",\n      {\n        method: \"POST\",\n        body: z.object({\n          idToken: z.string({\n            description: \"Google ID token, which the client obtains from the One Tap API\"\n          })\n        }),\n        metadata: {\n          openapi: {\n            summary: \"One tap callback\",\n            description: \"Use this endpoint to authenticate with Google One Tap\",\n            responses: {\n              200: {\n                description: \"Successful response\",\n                content: {\n                  \"application/json\": {\n                    schema: {\n                      type: \"object\",\n                      properties: {\n                        session: {\n                          $ref: \"#/components/schemas/Session\"\n                        },\n                        user: {\n                          $ref: \"#/components/schemas/User\"\n                        }\n                      }\n                    }\n                  }\n                }\n              },\n              400: {\n                description: \"Invalid token\"\n              }\n            }\n          }\n        }\n      },\n      async (ctx) => {\n        const { idToken } = ctx.body;\n        let payload;\n        try {\n          const JWKS = createRemoteJWKSet(\n            new URL(\"https://www.googleapis.com/oauth2/v3/certs\")\n          );\n          const { payload: verifiedPayload } = await jwtVerify(\n            idToken,\n            JWKS,\n            {\n              issuer: [\"https://accounts.google.com\", \"accounts.google.com\"],\n              audience: options?.clientId || ctx.context.options.socialProviders?.google?.clientId\n            }\n          );\n          payload = verifiedPayload;\n        } catch (error) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: \"invalid id token\"\n          });\n        }\n        const { email, email_verified, name, picture, sub } = payload;\n        if (!email) {\n          return ctx.json({ error: \"Email not available in token\" });\n        }\n        const user = await ctx.context.internalAdapter.findUserByEmail(email);\n        if (!user) {\n          if (options?.disableSignup) {\n            throw new APIError(\"BAD_GATEWAY\", {\n              message: \"User not found\"\n            });\n          }\n          const newUser = await ctx.context.internalAdapter.createOAuthUser(\n            {\n              email,\n              emailVerified: typeof email_verified === \"boolean\" ? email_verified : toBoolean(email_verified),\n              name,\n              image: picture\n            },\n            {\n              providerId: \"google\",\n              accountId: sub\n            },\n            ctx\n          );\n          if (!newUser) {\n            throw new APIError(\"INTERNAL_SERVER_ERROR\", {\n              message: \"Could not create user\"\n            });\n          }\n          const session2 = await ctx.context.internalAdapter.createSession(\n            newUser.user.id,\n            ctx.request\n          );\n          await setSessionCookie(ctx, {\n            user: newUser.user,\n            session: session2\n          });\n          return ctx.json({\n            token: session2.token,\n            user: {\n              id: newUser.user.id,\n              email: newUser.user.email,\n              emailVerified: newUser.user.emailVerified,\n              name: newUser.user.name,\n              image: newUser.user.image,\n              createdAt: newUser.user.createdAt,\n              updatedAt: newUser.user.updatedAt\n            }\n          });\n        }\n        const account = await ctx.context.internalAdapter.findAccount(sub);\n        if (!account) {\n          const accountLinking = ctx.context.options.account?.accountLinking;\n          const shouldLinkAccount = accountLinking?.enabled && (accountLinking.trustedProviders?.includes(\"google\") || email_verified);\n          if (shouldLinkAccount) {\n            await ctx.context.internalAdapter.linkAccount({\n              userId: user.user.id,\n              providerId: \"google\",\n              accountId: sub,\n              scope: \"openid,profile,email\",\n              idToken\n            });\n          } else {\n            throw new APIError(\"UNAUTHORIZED\", {\n              message: \"Google sub doesn't match\"\n            });\n          }\n        }\n        const session = await ctx.context.internalAdapter.createSession(\n          user.user.id,\n          ctx.request\n        );\n        await setSessionCookie(ctx, {\n          user: user.user,\n          session\n        });\n        return ctx.json({\n          token: session.token,\n          user: {\n            id: user.user.id,\n            email: user.user.email,\n            emailVerified: user.user.emailVerified,\n            name: user.user.name,\n            image: user.user.image,\n            createdAt: user.user.createdAt,\n            updatedAt: user.user.updatedAt\n          }\n        });\n      }\n    )\n  }\n});\n\nexport { oneTap };\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,SAAS,UAAU,KAAK;IACtB,OAAO,UAAU,UAAU,UAAU;AACvC;AAEA,MAAM,SAAS,CAAC,UAAY,CAAC;QAC3B,IAAI;QACJ,WAAW;YACT,gBAAgB,CAAA,GAAA,iLAAA,CAAA,IAAkB,AAAD,EAC/B,qBACA;gBACE,QAAQ;gBACR,MAAM,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;oBACb,SAAS,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;wBAChB,aAAa;oBACf;gBACF;gBACA,UAAU;oBACR,SAAS;wBACP,SAAS;wBACT,aAAa;wBACb,WAAW;4BACT,KAAK;gCACH,aAAa;gCACb,SAAS;oCACP,oBAAoB;wCAClB,QAAQ;4CACN,MAAM;4CACN,YAAY;gDACV,SAAS;oDACP,MAAM;gDACR;gDACA,MAAM;oDACJ,MAAM;gDACR;4CACF;wCACF;oCACF;gCACF;4BACF;4BACA,KAAK;gCACH,aAAa;4BACf;wBACF;oBACF;gBACF;YACF,GACA,OAAO;gBACL,MAAM,EAAE,OAAO,EAAE,GAAG,IAAI,IAAI;gBAC5B,IAAI;gBACJ,IAAI;oBACF,MAAM,OAAO,CAAA,GAAA,+JAAA,CAAA,qBAAkB,AAAD,EAC5B,IAAI,IAAI;oBAEV,MAAM,EAAE,SAAS,eAAe,EAAE,GAAG,MAAM,CAAA,GAAA,8JAAA,CAAA,YAAS,AAAD,EACjD,SACA,MACA;wBACE,QAAQ;4BAAC;4BAA+B;yBAAsB;wBAC9D,UAAU,SAAS,YAAY,IAAI,OAAO,CAAC,OAAO,CAAC,eAAe,EAAE,QAAQ;oBAC9E;oBAEF,UAAU;gBACZ,EAAE,OAAO,OAAO;oBACd,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,eAAe;wBAChC,SAAS;oBACX;gBACF;gBACA,MAAM,EAAE,KAAK,EAAE,cAAc,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,EAAE,GAAG;gBACtD,IAAI,CAAC,OAAO;oBACV,OAAO,IAAI,IAAI,CAAC;wBAAE,OAAO;oBAA+B;gBAC1D;gBACA,MAAM,OAAO,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,eAAe,CAAC;gBAC/D,IAAI,CAAC,MAAM;oBACT,IAAI,SAAS,eAAe;wBAC1B,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,eAAe;4BAChC,SAAS;wBACX;oBACF;oBACA,MAAM,UAAU,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,eAAe,CAC/D;wBACE;wBACA,eAAe,OAAO,mBAAmB,YAAY,iBAAiB,UAAU;wBAChF;wBACA,OAAO;oBACT,GACA;wBACE,YAAY;wBACZ,WAAW;oBACb,GACA;oBAEF,IAAI,CAAC,SAAS;wBACZ,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,yBAAyB;4BAC1C,SAAS;wBACX;oBACF;oBACA,MAAM,WAAW,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,aAAa,CAC9D,QAAQ,IAAI,CAAC,EAAE,EACf,IAAI,OAAO;oBAEb,MAAM,CAAA,GAAA,6JAAA,CAAA,mBAAgB,AAAD,EAAE,KAAK;wBAC1B,MAAM,QAAQ,IAAI;wBAClB,SAAS;oBACX;oBACA,OAAO,IAAI,IAAI,CAAC;wBACd,OAAO,SAAS,KAAK;wBACrB,MAAM;4BACJ,IAAI,QAAQ,IAAI,CAAC,EAAE;4BACnB,OAAO,QAAQ,IAAI,CAAC,KAAK;4BACzB,eAAe,QAAQ,IAAI,CAAC,aAAa;4BACzC,MAAM,QAAQ,IAAI,CAAC,IAAI;4BACvB,OAAO,QAAQ,IAAI,CAAC,KAAK;4BACzB,WAAW,QAAQ,IAAI,CAAC,SAAS;4BACjC,WAAW,QAAQ,IAAI,CAAC,SAAS;wBACnC;oBACF;gBACF;gBACA,MAAM,UAAU,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,WAAW,CAAC;gBAC9D,IAAI,CAAC,SAAS;oBACZ,MAAM,iBAAiB,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,EAAE;oBACpD,MAAM,oBAAoB,gBAAgB,WAAW,CAAC,eAAe,gBAAgB,EAAE,SAAS,aAAa,cAAc;oBAC3H,IAAI,mBAAmB;wBACrB,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,WAAW,CAAC;4BAC5C,QAAQ,KAAK,IAAI,CAAC,EAAE;4BACpB,YAAY;4BACZ,WAAW;4BACX,OAAO;4BACP;wBACF;oBACF,OAAO;wBACL,MAAM,IAAI,iJAAA,CAAA,WAAQ,CAAC,gBAAgB;4BACjC,SAAS;wBACX;oBACF;gBACF;gBACA,MAAM,UAAU,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,aAAa,CAC7D,KAAK,IAAI,CAAC,EAAE,EACZ,IAAI,OAAO;gBAEb,MAAM,CAAA,GAAA,6JAAA,CAAA,mBAAgB,AAAD,EAAE,KAAK;oBAC1B,MAAM,KAAK,IAAI;oBACf;gBACF;gBACA,OAAO,IAAI,IAAI,CAAC;oBACd,OAAO,QAAQ,KAAK;oBACpB,MAAM;wBACJ,IAAI,KAAK,IAAI,CAAC,EAAE;wBAChB,OAAO,KAAK,IAAI,CAAC,KAAK;wBACtB,eAAe,KAAK,IAAI,CAAC,aAAa;wBACtC,MAAM,KAAK,IAAI,CAAC,IAAI;wBACpB,OAAO,KAAK,IAAI,CAAC,KAAK;wBACtB,WAAW,KAAK,IAAI,CAAC,SAAS;wBAC9B,WAAW,KAAK,IAAI,CAAC,SAAS;oBAChC;gBACF;YACF;QAEJ;IACF,CAAC","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 4644, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/oauth-proxy/index.mjs"],"sourcesContent":["import { z } from 'zod';\nimport 'better-call';\nimport { c as createAuthMiddleware, a as createAuthEndpoint, o as originCheck } from '../../shared/better-auth.C92a320y.mjs';\nimport { e as env } from '../../shared/better-auth.8zoxzg-F.mjs';\nimport '@better-auth/utils/base64';\nimport '@better-auth/utils/hmac';\nimport '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport { symmetricEncrypt, symmetricDecrypt } from '../../crypto/index.mjs';\nimport { g as getOrigin } from '../../shared/better-auth.VTXNLFMT.mjs';\nimport '../../cookies/index.mjs';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '../../shared/better-auth.CW6D9eSx.mjs';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport 'jose';\nimport '@better-auth/utils/hash';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport '../../shared/better-auth.B4Qoxdgc.mjs';\nimport '@better-auth/utils/random';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport 'jose/errors';\nimport '@better-auth/utils/binary';\nimport '../../shared/better-auth.OT3XFeFk.mjs';\n\nfunction getVenderBaseURL() {\n  const vercel = env.VERCEL_URL;\n  const netlify = env.NETLIFY_URL;\n  const render = env.RENDER_URL;\n  const aws = env.AWS_LAMBDA_FUNCTION_NAME;\n  const google = env.GOOGLE_CLOUD_FUNCTION_NAME;\n  const azure = env.AZURE_FUNCTION_NAME;\n  return vercel || netlify || render || aws || google || azure;\n}\nconst oAuthProxy = (opts) => {\n  return {\n    id: \"oauth-proxy\",\n    endpoints: {\n      oAuthProxy: createAuthEndpoint(\n        \"/oauth-proxy-callback\",\n        {\n          method: \"GET\",\n          query: z.object({\n            callbackURL: z.string({\n              description: \"The URL to redirect to after the proxy\"\n            }),\n            cookies: z.string({\n              description: \"The cookies to set after the proxy\"\n            })\n          }),\n          use: [originCheck((ctx) => ctx.query.callbackURL)],\n          metadata: {\n            openapi: {\n              description: \"OAuth Proxy Callback\",\n              parameters: [\n                {\n                  in: \"query\",\n                  name: \"callbackURL\",\n                  required: true,\n                  description: \"The URL to redirect to after the proxy\"\n                },\n                {\n                  in: \"query\",\n                  name: \"cookies\",\n                  required: true,\n                  description: \"The cookies to set after the proxy\"\n                }\n              ],\n              responses: {\n                302: {\n                  description: \"Redirect\",\n                  headers: {\n                    Location: {\n                      description: \"The URL to redirect to\",\n                      schema: {\n                        type: \"string\"\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        },\n        async (ctx) => {\n          const cookies = ctx.query.cookies;\n          const decryptedCookies = await symmetricDecrypt({\n            key: ctx.context.secret,\n            data: cookies\n          });\n          ctx.setHeader(\"set-cookie\", decryptedCookies);\n          throw ctx.redirect(ctx.query.callbackURL);\n        }\n      )\n    },\n    hooks: {\n      after: [\n        {\n          matcher(context) {\n            return context.path?.startsWith(\"/callback\");\n          },\n          handler: createAuthMiddleware(async (ctx) => {\n            const headers = ctx.context.responseHeaders;\n            const location = headers?.get(\"location\");\n            if (location?.includes(\"/oauth-proxy-callback?callbackURL\")) {\n              if (!location.startsWith(\"http\")) {\n                return;\n              }\n              const locationURL = new URL(location);\n              const origin = locationURL.origin;\n              if (origin === getOrigin(ctx.context.baseURL)) {\n                const newLocation = locationURL.searchParams.get(\"callbackURL\");\n                if (!newLocation) {\n                  return;\n                }\n                ctx.setHeader(\"location\", newLocation);\n                return;\n              }\n              const setCookies = headers?.get(\"set-cookie\");\n              if (!setCookies) {\n                return;\n              }\n              const encryptedCookies = await symmetricEncrypt({\n                key: ctx.context.secret,\n                data: setCookies\n              });\n              const locationWithCookies = `${location}&cookies=${encodeURIComponent(\n                encryptedCookies\n              )}`;\n              ctx.setHeader(\"location\", locationWithCookies);\n            }\n          })\n        }\n      ],\n      before: [\n        {\n          matcher(context) {\n            return context.path?.startsWith(\"/sign-in/social\");\n          },\n          handler: createAuthMiddleware(async (ctx) => {\n            const url = new URL(\n              opts?.currentURL || ctx.request?.url || getVenderBaseURL() || ctx.context.baseURL\n            );\n            const productionURL = opts?.productionURL || env.BETTER_AUTH_URL;\n            if (productionURL === ctx.context.options.baseURL) {\n              return;\n            }\n            ctx.body.callbackURL = `${url.origin}${ctx.context.options.basePath || \"/api/auth\"}/oauth-proxy-callback?callbackURL=${encodeURIComponent(\n              ctx.body.callbackURL || ctx.context.baseURL\n            )}`;\n            return {\n              context: ctx\n            };\n          })\n        }\n      ]\n    }\n  };\n};\n\nexport { oAuthProxy };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 4844, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/custom-session/index.mjs"],"sourcesContent":["import { z } from 'zod';\nimport 'better-call';\nimport { a as createAuthEndpoint, g as getSessionFromCtx } from '../../shared/better-auth.C92a320y.mjs';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport '@better-auth/utils/base64';\nimport '@better-auth/utils/hmac';\nimport '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport '../../cookies/index.mjs';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '../../shared/better-auth.CW6D9eSx.mjs';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport 'jose';\nimport '@better-auth/utils/hash';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport '../../shared/better-auth.B4Qoxdgc.mjs';\nimport '@better-auth/utils/random';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport '../../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '@better-auth/utils/binary';\n\nconst customSession = (fn, options) => {\n  return {\n    id: \"custom-session\",\n    endpoints: {\n      getSession: createAuthEndpoint(\n        \"/get-session\",\n        {\n          method: \"GET\",\n          metadata: {\n            CUSTOM_SESSION: true\n          },\n          query: z.optional(\n            z.object({\n              /**\n               * If cookie cache is enabled, it will disable the cache\n               * and fetch the session from the database\n               */\n              disableCookieCache: z.boolean({\n                description: \"Disable cookie cache and fetch session from database\"\n              }).or(z.string().transform((v) => v === \"true\")).optional(),\n              disableRefresh: z.boolean({\n                description: \"Disable session refresh. Useful for checking session status, without updating the session\"\n              }).optional()\n            })\n          )\n        },\n        async (ctx) => {\n          const session = await getSessionFromCtx(ctx);\n          if (!session) {\n            return ctx.json(null);\n          }\n          const fnResult = await fn(session);\n          return ctx.json(fnResult);\n        }\n      )\n    }\n  };\n};\n\nexport { customSession };\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAKA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,MAAM,gBAAgB,CAAC,IAAI;IACzB,OAAO;QACL,IAAI;QACJ,WAAW;YACT,YAAY,CAAA,GAAA,iLAAA,CAAA,IAAkB,AAAD,EAC3B,gBACA;gBACE,QAAQ;gBACR,UAAU;oBACR,gBAAgB;gBAClB;gBACA,OAAO,sIAAA,CAAA,IAAC,CAAC,QAAQ,CACf,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;oBACP;;;eAGC,GACD,oBAAoB,sIAAA,CAAA,IAAC,CAAC,OAAO,CAAC;wBAC5B,aAAa;oBACf,GAAG,EAAE,CAAC,sIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,SAAS,CAAC,CAAC,IAAM,MAAM,SAAS,QAAQ;oBACzD,gBAAgB,sIAAA,CAAA,IAAC,CAAC,OAAO,CAAC;wBACxB,aAAa;oBACf,GAAG,QAAQ;gBACb;YAEJ,GACA,OAAO;gBACL,MAAM,UAAU,MAAM,CAAA,GAAA,iLAAA,CAAA,IAAiB,AAAD,EAAE;gBACxC,IAAI,CAAC,SAAS;oBACZ,OAAO,IAAI,IAAI,CAAC;gBAClB;gBACA,MAAM,WAAW,MAAM,GAAG;gBAC1B,OAAO,IAAI,IAAI,CAAC;YAClB;QAEJ;IACF;AACF","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 4944, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/open-api/index.mjs"],"sourcesContent":["import { ZodObject, ZodSchema, ZodOptional } from 'zod';\nimport { getEndpoints } from '../../api/index.mjs';\nimport '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport '@better-auth/utils/random';\nimport { APIError } from 'better-call';\nimport '@better-auth/utils/hash';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@better-auth/utils/base64';\nimport 'jose';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport '../../shared/better-auth.B4Qoxdgc.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport { g as getAuthTables } from '../../shared/better-auth.DORkW_Ge.mjs';\nimport 'kysely';\nimport { a as createAuthEndpoint } from '../../shared/better-auth.C92a320y.mjs';\nimport '@better-auth/utils/hmac';\nimport 'defu';\nimport '../../cookies/index.mjs';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '../../shared/better-auth.CW6D9eSx.mjs';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '../../shared/better-auth.Duk7IG0N.mjs';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport '../../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '@better-auth/utils/binary';\n\nconst paths = {};\nfunction getTypeFromZodType(zodType) {\n  switch (zodType.constructor.name) {\n    case \"ZodString\":\n      return \"string\";\n    case \"ZodNumber\":\n      return \"number\";\n    case \"ZodBoolean\":\n      return \"boolean\";\n    case \"ZodObject\":\n      return \"object\";\n    case \"ZodArray\":\n      return \"array\";\n    default:\n      return \"string\";\n  }\n}\nfunction getParameters(options) {\n  const parameters = [];\n  if (options.metadata?.openapi?.parameters) {\n    parameters.push(...options.metadata.openapi.parameters);\n    return parameters;\n  }\n  if (options.query instanceof ZodObject) {\n    Object.entries(options.query.shape).forEach(([key, value]) => {\n      if (value instanceof ZodSchema) {\n        parameters.push({\n          name: key,\n          in: \"query\",\n          schema: {\n            type: getTypeFromZodType(value),\n            ...\"minLength\" in value && value.minLength ? {\n              minLength: value.minLength\n            } : {},\n            description: value.description\n          }\n        });\n      }\n    });\n  }\n  return parameters;\n}\nfunction getRequestBody(options) {\n  if (options.metadata?.openapi?.requestBody) {\n    return options.metadata.openapi.requestBody;\n  }\n  if (!options.body) return void 0;\n  if (options.body instanceof ZodObject || options.body instanceof ZodOptional) {\n    const shape = options.body.shape;\n    if (!shape) return void 0;\n    const properties = {};\n    const required = [];\n    Object.entries(shape).forEach(([key, value]) => {\n      if (value instanceof ZodSchema) {\n        properties[key] = {\n          type: getTypeFromZodType(value),\n          description: value.description\n        };\n        if (!(value instanceof ZodOptional)) {\n          required.push(key);\n        }\n      }\n    });\n    return {\n      required: options.body instanceof ZodOptional ? false : options.body ? true : false,\n      content: {\n        \"application/json\": {\n          schema: {\n            type: \"object\",\n            properties,\n            required\n          }\n        }\n      }\n    };\n  }\n  return void 0;\n}\nfunction getResponse(responses) {\n  return {\n    \"400\": {\n      content: {\n        \"application/json\": {\n          schema: {\n            type: \"object\",\n            properties: {\n              message: {\n                type: \"string\"\n              }\n            },\n            required: [\"message\"]\n          }\n        }\n      },\n      description: \"Bad Request. Usually due to missing parameters, or invalid parameters.\"\n    },\n    \"401\": {\n      content: {\n        \"application/json\": {\n          schema: {\n            type: \"object\",\n            properties: {\n              message: {\n                type: \"string\"\n              }\n            },\n            required: [\"message\"]\n          }\n        }\n      },\n      description: \"Unauthorized. Due to missing or invalid authentication.\"\n    },\n    \"403\": {\n      content: {\n        \"application/json\": {\n          schema: {\n            type: \"object\",\n            properties: {\n              message: {\n                type: \"string\"\n              }\n            }\n          }\n        }\n      },\n      description: \"Forbidden. You do not have permission to access this resource or to perform this action.\"\n    },\n    \"404\": {\n      content: {\n        \"application/json\": {\n          schema: {\n            type: \"object\",\n            properties: {\n              message: {\n                type: \"string\"\n              }\n            }\n          }\n        }\n      },\n      description: \"Not Found. The requested resource was not found.\"\n    },\n    \"429\": {\n      content: {\n        \"application/json\": {\n          schema: {\n            type: \"object\",\n            properties: {\n              message: {\n                type: \"string\"\n              }\n            }\n          }\n        }\n      },\n      description: \"Too Many Requests. You have exceeded the rate limit. Try again later.\"\n    },\n    \"500\": {\n      content: {\n        \"application/json\": {\n          schema: {\n            type: \"object\",\n            properties: {\n              message: {\n                type: \"string\"\n              }\n            }\n          }\n        }\n      },\n      description: \"Internal Server Error. This is a problem with the server that you cannot fix.\"\n    },\n    ...responses\n  };\n}\nfunction toOpenApiPath(path) {\n  return path.split(\"/\").map((part) => part.startsWith(\":\") ? `{${part.slice(1)}}` : part).join(\"/\");\n}\nasync function generator(ctx, options) {\n  const baseEndpoints = getEndpoints(ctx, {\n    ...options,\n    plugins: []\n  });\n  const tables = getAuthTables(options);\n  const models = Object.entries(tables).reduce((acc, [key, value]) => {\n    const modelName = key.charAt(0).toUpperCase() + key.slice(1);\n    acc[modelName] = {\n      type: \"object\",\n      properties: Object.entries(value.fields).reduce(\n        (acc2, [key2, value2]) => {\n          acc2[key2] = {\n            type: value2.type\n          };\n          return acc2;\n        },\n        { id: { type: \"string\" } }\n      )\n    };\n    return acc;\n  }, {});\n  const components = {\n    schemas: {\n      ...models\n    }\n  };\n  Object.entries(baseEndpoints.api).forEach(([_, value]) => {\n    const options2 = value.options;\n    if (options2.metadata?.SERVER_ONLY) return;\n    const path = toOpenApiPath(value.path);\n    if (options2.method === \"GET\") {\n      paths[path] = {\n        get: {\n          tags: [\"Default\", ...options2.metadata?.openapi?.tags || []],\n          description: options2.metadata?.openapi?.description,\n          operationId: options2.metadata?.openapi?.operationId,\n          security: [\n            {\n              bearerAuth: []\n            }\n          ],\n          parameters: getParameters(options2),\n          responses: getResponse(options2.metadata?.openapi?.responses)\n        }\n      };\n    }\n    if (options2.method === \"POST\") {\n      const body = getRequestBody(options2);\n      paths[path] = {\n        post: {\n          tags: [\"Default\", ...options2.metadata?.openapi?.tags || []],\n          description: options2.metadata?.openapi?.description,\n          operationId: options2.metadata?.openapi?.operationId,\n          security: [\n            {\n              bearerAuth: []\n            }\n          ],\n          parameters: getParameters(options2),\n          ...body ? { requestBody: body } : {\n            requestBody: {\n              //set body none\n              content: {\n                \"application/json\": {\n                  schema: {\n                    type: \"object\",\n                    properties: {}\n                  }\n                }\n              }\n            }\n          },\n          responses: getResponse(options2.metadata?.openapi?.responses)\n        }\n      };\n    }\n  });\n  for (const plugin of options.plugins || []) {\n    if (plugin.id === \"open-api\") {\n      continue;\n    }\n    const pluginEndpoints = getEndpoints(ctx, {\n      ...options,\n      plugins: [plugin]\n    });\n    const api = Object.keys(pluginEndpoints.api).map((key) => {\n      if (baseEndpoints.api[key] === void 0) {\n        return pluginEndpoints.api[key];\n      }\n      return null;\n    }).filter((x) => x !== null);\n    Object.entries(api).forEach(([key, value]) => {\n      const options2 = value.options;\n      if (options2.metadata?.SERVER_ONLY) return;\n      const path = toOpenApiPath(value.path);\n      if (options2.method === \"GET\") {\n        paths[path] = {\n          get: {\n            tags: options2.metadata?.openapi?.tags || [\n              plugin.id.charAt(0).toUpperCase() + plugin.id.slice(1)\n            ],\n            description: options2.metadata?.openapi?.description,\n            operationId: options2.metadata?.openapi?.operationId,\n            security: [\n              {\n                bearerAuth: []\n              }\n            ],\n            parameters: getParameters(options2),\n            responses: getResponse(options2.metadata?.openapi?.responses)\n          }\n        };\n      }\n      if (options2.method === \"POST\") {\n        paths[path] = {\n          post: {\n            tags: options2.metadata?.openapi?.tags || [\n              plugin.id.charAt(0).toUpperCase() + plugin.id.slice(1)\n            ],\n            description: options2.metadata?.openapi?.description,\n            operationId: options2.metadata?.openapi?.operationId,\n            security: [\n              {\n                bearerAuth: []\n              }\n            ],\n            parameters: getParameters(options2),\n            requestBody: getRequestBody(options2),\n            responses: getResponse(options2.metadata?.openapi?.responses)\n          }\n        };\n      }\n    });\n  }\n  const res = {\n    openapi: \"3.1.1\",\n    info: {\n      title: \"Better Auth\",\n      description: \"API Reference for your Better Auth Instance\",\n      version: \"1.1.0\"\n    },\n    components: {\n      ...components,\n      securitySchemes: {\n        apiKeyCookie: {\n          type: \"apiKey\",\n          in: \"cookie\",\n          name: \"apiKeyCookie\",\n          description: \"API Key authentication via cookie\"\n        },\n        bearerAuth: {\n          type: \"http\",\n          scheme: \"bearer\",\n          description: \"Bearer token authentication\"\n        }\n      }\n    },\n    security: [\n      {\n        apiKeyCookie: [],\n        bearerAuth: []\n      }\n    ],\n    servers: [\n      {\n        url: ctx.baseURL\n      }\n    ],\n    tags: [\n      {\n        name: \"Default\",\n        description: \"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin.\"\n      }\n    ],\n    paths\n  };\n  return res;\n}\n\nconst logo = `<svg width=\"75\" height=\"75\" viewBox=\"0 0 75 75\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<rect width=\"75\" height=\"75\" fill=\"url(#pattern0_21_12)\"/>\n<defs>\n<pattern id=\"pattern0_21_12\" patternContentUnits=\"objectBoundingBox\" width=\"1\" height=\"1\">\n<use xlink:href=\"#image0_21_12\" transform=\"scale(0.00094697)\"/>\n</pattern>\n<image id=\"image0_21_12\" width=\"1056\" height=\"1056\" xlink:href=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QBARXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAEIKADAAQAAAABAAAEIAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/+ICKElDQ19QUk9GSUxFAAEBAAACGGFwcGwEAAAAbW50clJHQiBYWVogB+YAAQABAAAAAAAAYWNzcEFQUEwAAAAAQVBQTAAAAAAAAAAAAAAAAAAAAAAAAPbWAAEAAAAA0y1hcHBs7P2jjjiFR8NttL1PetoYLwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKZGVzYwAAAPwAAAAwY3BydAAAASwAAABQd3RwdAAAAXwAAAAUclhZWgAAAZAAAAAUZ1hZWgAAAaQAAAAUYlhZWgAAAbgAAAAUclRSQwAAAcwAAAAgY2hhZAAAAewAAAAsYlRSQwAAAcwAAAAgZ1RSQwAAAcwAAAAgbWx1YwAAAAAAAAABAAAADGVuVVMAAAAUAAAAHABEAGkAcwBwAGwAYQB5ACAAUAAzbWx1YwAAAAAAAAABAAAADGVuVVMAAAA0AAAAHABDAG8AcAB5AHIAaQBnAGgAdAAgAEEAcABwAGwAZQAgAEkAbgBjAC4ALAAgADIAMAAyADJYWVogAAAAAAAA9tUAAQAAAADTLFhZWiAAAAAAAACD3wAAPb////+7WFlaIAAAAAAAAEq/AACxNwAACrlYWVogAAAAAAAAKDgAABELAADIuXBhcmEAAAAAAAMAAAACZmYAAPKnAAANWQAAE9AAAApbc2YzMgAAAAAAAQxCAAAF3v//8yYAAAeTAAD9kP//+6L///2jAAAD3AAAwG7/wAARCAQgBCADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9sAQwACAgICAgIDAgIDBAMDAwQFBAQEBAUHBQUFBQUHCAcHBwcHBwgICAgICAgICgoKCgoKCwsLCwsNDQ0NDQ0NDQ0N/9sAQwECAgIDAwMGAwMGDQkHCQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0N/90ABABC/9oADAMBAAIRAxEAPwD9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Ln/gq38a/in8Dvgp4T8R/CfxFdeG9SvvFMdlcXFoELyW5srqQxnzEcY3op4Gciv1Gr8Z/+C2X/JvXgj/sc4v/AE33lAH4z/8ADwv9tD/oq2tf9823/wAZo/4eF/tof9FW1r/vm2/+M18Z0UAfZn/Dwv8AbQ/6KtrX/fNt/wDGaP8Ah4X+2h/0VbWv++bb/wCM18Z0UAfZn/Dwv9tD/oq2tf8AfNt/8Zo/4eF/tof9FW1r/vm2/wDjNfGdFAH2Z/w8L/bQ/wCira1/3zbf/GaP+Hhf7aH/AEVbWv8Avm2/+M18Z0UAfZn/AA8L/bQ/6KtrX/fNt/8AGaP+Hhf7aH/RVta/75tv/jNfGdFAH2Z/w8L/AG0P+ira1/3zbf8Axmj/AIeF/tof9FW1r/vm2/8AjNfGdFAH63/sVftq/tTfEb9qb4deCfG3xF1TVtD1bVGgvbKdYBHPGIJW2ttiVsblB4I6V/UbX8Z//BPT/k9D4U/9hpv/AEmmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+M/wD4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAPsz/h4X+2h/0VbWv++bb/4zR/w8L/bQ/wCira1/3zbf/Ga+M6KAPsz/AIeF/tof9FW1r/vm2/8AjNH/AA8L/bQ/6KtrX/fNt/8AGa+M6KAPsz/h4X+2h/0VbWv++bb/AOM0f8PC/wBtD/oq2tf9823/AMZr4zooA+zP+Hhf7aH/AEVbWv8Avm2/+M0f8PC/20P+ira1/wB823/xmvjOigD7M/4eF/tof9FW1r/vm2/+M0f8PC/20P8Aoq2tf9823/xmvjOigD7M/wCHhf7aH/RVta/75tv/AIzR/wAPC/20P+ira1/3zbf/ABmvjOigD7M/4eF/tof9FW1r/vm2/wDjNH/Dwv8AbQ/6KtrX/fNt/wDGa+M6KAPsz/h4X+2h/wBFW1r/AL5tv/jNH/Dwv9tD/oq2tf8AfNt/8Zr4zooA+zP+Hhf7aH/RVta/75tv/jNH/Dwv9tD/AKKtrX/fNt/8Zr4zooA+zP8Ah4X+2h/0VbWv++bb/wCM0f8ADwv9tD/oq2tf9823/wAZr4zooA+zP+Hhf7aH/RVta/75tv8A4zR/w8L/AG0P+ira1/3zbf8AxmvjOigD7M/4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAP6tv+CUnxr+Kfxx+CnizxH8WPEV14k1Kx8UyWVvcXYQPHbiytZBGPLRBje7HkZya/Uavxn/AOCJv/JvXjf/ALHOX/032dfsxQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfwq/BT4r638Dvin4d+LHhy0tb7UvDd0bu3t70ObeRzG0eJBGyPjDnowOa/Ub/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH9MlFfzN/8Psv2hf+hI8Gf9+tQ/8Ak2j/AIfZftC/9CR4M/79ah/8m0Af0yUV/M3/AMPsv2hf+hI8Gf8AfrUP/k2j/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH4z0V/TJ/w5N/Z6/6Hfxn/wB/dP8A/kKj/hyb+z1/0O/jP/v7p/8A8hUAfzN0V/TJ/wAOTf2ev+h38Z/9/dP/APkKj/hyb+z1/wBDv4z/AO/un/8AyFQB/M3RX9Mn/Dk39nr/AKHfxn/390//AOQqP+HJv7PX/Q7+M/8Av7p//wAhUAfzN0V/TJ/w5N/Z6/6Hfxn/AN/dP/8AkKj/AIcm/s9f9Dv4z/7+6f8A/IVAH8zdFf0yf8OTf2ev+h38Z/8Af3T/AP5Co/4cm/s9f9Dv4z/7+6f/APIVAH8zdFf0yf8ADk39nr/od/Gf/f3T/wD5Co/4cm/s9f8AQ7+M/wDv7p//AMhUAfzN0V/TJ/w5N/Z6/wCh38Z/9/dP/wDkKvwV/ag+FGifA74++M/hP4cu7q+03w3fi0t7i9KG4kQxRyZkMaomcueigYoA8FooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/AOxzl/8ATfZ1+zFfjP8A8ETf+TevG/8A2Ocv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD1L4KfCjW/jj8U/Dvwn8OXdrY6l4kujaW9xelxbxuI2kzIY1d8YQ9FJzX6jf8OTf2hf8Aod/Bn/f3UP8A5Cr4z/4J6f8AJ6Hwp/7DTf8ApNNX9mFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH8zf8Aw5N/aF/6HfwZ/wB/dQ/+QqP+HJv7Qv8A0O/gz/v7qH/yFX9MlFAH8zf/AA5N/aF/6HfwZ/391D/5Co/4cm/tC/8AQ7+DP+/uof8AyFX9MlFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH4z/8AD7L9nr/oSPGf/frT/wD5No/4fZfs9f8AQkeM/wDv1p//AMm1/M3RQB/TJ/w+y/Z6/wChI8Z/9+tP/wDk2j/h9l+z1/0JHjP/AL9af/8AJtfzN0UAf0yf8Psv2ev+hI8Z/wDfrT//AJNo/wCH2X7PX/QkeM/+/Wn/APybX8zdFAH9Mn/D7L9nr/oSPGf/AH60/wD+TaP+H2X7PX/QkeM/+/Wn/wDybX8zdFAH9Mn/AA+y/Z6/6Ejxn/360/8A+TaP+H2X7PX/AEJHjP8A79af/wDJtfzN0UAf0yf8Psv2ev8AoSPGf/frT/8A5No/4fZfs9f9CR4z/wC/Wn//ACbX8zdFAH9Mn/D7L9nr/oSPGf8A360//wCTa/BX9qD4r6J8cfj74z+LHhy0urHTfEl+Lu3t70ILiNBFHHiQRs6Zyh6MRivBaKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/ACb143/7HOX/ANN9nX7MV+M//BE3/k3rxv8A9jnL/wCm+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+XP/BVv4KfFP44/BTwn4c+E/h268SalY+KY724t7QoHjtxZXUZkPmOgxvdRwc5NAH8pNFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAfGdFfZn/DvT9tD/AKJTrX/fVt/8eo/4d6ftof8ARKda/wC+rb/49QB8Z0V9mf8ADvT9tD/olOtf99W3/wAeo/4d6ftof9Ep1r/vq2/+PUAfGdFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAH/BPT/k9D4U/wDYab/0mmr+zCv5cv2Kv2Kv2pvhz+1N8OvG3jb4dappOh6TqjT3t7O0BjgjMEq7m2ys2NzAcA9a/qNoAKKKKACiiigAooooAKKKKACiiigAooooA/gDor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD9mP+CJv/JvXjf8A7HOX/wBN9nX7MV+XP/BKT4KfFP4HfBTxZ4c+LHh268N6lfeKZL23t7soXktzZWsYkHlu4xvRhyc5FfqNQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9f9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/2Q==\"/>\n</defs>\n</svg>\n`;\n\nconst getHTML = (apiReference) => `<!doctype html>\n<html>\n  <head>\n    <title>Scalar API Reference</title>\n    <meta charset=\"utf-8\" />\n    <meta\n      name=\"viewport\"\n      content=\"width=device-width, initial-scale=1\" />\n  </head>\n  <body>\n    <script\n      id=\"api-reference\"\n      type=\"application/json\">\n    ${JSON.stringify(apiReference)}\n    <\\/script>\n\t <script>\n      var configuration = {\n\t  \tfavicon: \"data:image/svg+xml;utf8,${encodeURIComponent(logo)}\",\n\t   \ttheme: \"saturn\",\n        metaData: {\n\t\t\ttitle: \"Better Auth API\",\n\t\t\tdescription: \"API Reference for your Better Auth Instance\",\n\t\t}\n      }\n\n      document.getElementById('api-reference').dataset.configuration =\n        JSON.stringify(configuration)\n    <\\/script>\n\t  <script src=\"https://cdn.jsdelivr.net/npm/@scalar/api-reference\"><\\/script>\n  </body>\n</html>`;\nconst openAPI = (options) => {\n  const path = options?.path ?? \"/reference\";\n  return {\n    id: \"open-api\",\n    endpoints: {\n      generateOpenAPISchema: createAuthEndpoint(\n        \"/open-api/generate-schema\",\n        {\n          method: \"GET\"\n        },\n        async (ctx) => {\n          const schema = await generator(ctx.context, ctx.context.options);\n          return ctx.json(schema);\n        }\n      ),\n      openAPIReference: createAuthEndpoint(\n        path,\n        {\n          method: \"GET\",\n          metadata: {\n            isAction: false\n          }\n        },\n        async (ctx) => {\n          if (options?.disableDefaultReference) {\n            throw new APIError(\"NOT_FOUND\");\n          }\n          const schema = await generator(ctx.context, ctx.context.options);\n          return new Response(getHTML(schema), {\n            headers: {\n              \"Content-Type\": \"text/html\"\n            }\n          });\n        }\n      )\n    }\n  };\n};\n\nexport { openAPI };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 5464, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/oidc-provider/index.mjs"],"sourcesContent":["import { SignJWT } from 'jose';\nimport { z } from 'zod';\nimport { APIError } from 'better-call';\nimport { g as getSessionFromCtx, a as createAuthEndpoint, c as createAuthMiddleware, s as sessionMiddleware } from '../../shared/better-auth.C92a320y.mjs';\nimport '../../shared/better-auth.8zoxzg-F.mjs';\nimport { base64 } from '@better-auth/utils/base64';\nimport '@better-auth/utils/hmac';\nimport { parseSetCookieHeader } from '../../cookies/index.mjs';\nimport '../../shared/better-auth.C24Bzw4w.mjs';\nimport '../../shared/better-auth.DH3YjMQH.mjs';\nimport 'defu';\nimport { createHash } from '@better-auth/utils/hash';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport '@noble/hashes/scrypt';\nimport { subtle } from '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport { g as generateRandomString } from '../../shared/better-auth.B4Qoxdgc.mjs';\nimport '../../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport '../../shared/better-auth.D7syfoJW.mjs';\nimport '../../shared/better-auth.CW6D9eSx.mjs';\nimport '../../shared/better-auth.DdzSJf-n.mjs';\nimport '@better-auth/utils/random';\nimport '../../shared/better-auth.CbXAPXob.mjs';\nimport '../../shared/better-auth.BUPPRXfK.mjs';\nimport '../../shared/better-auth.DDEbWX-S.mjs';\nimport '../../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '../../shared/better-auth.tB5eU6EY.mjs';\nimport '@better-auth/utils/binary';\n\nconst schema = {\n  oauthApplication: {\n    modelName: \"oauthApplication\",\n    fields: {\n      name: {\n        type: \"string\"\n      },\n      icon: {\n        type: \"string\",\n        required: false\n      },\n      metadata: {\n        type: \"string\",\n        required: false\n      },\n      clientId: {\n        type: \"string\",\n        unique: true\n      },\n      clientSecret: {\n        type: \"string\"\n      },\n      redirectURLs: {\n        type: \"string\"\n      },\n      type: {\n        type: \"string\"\n      },\n      disabled: {\n        type: \"boolean\",\n        required: false,\n        defaultValue: false\n      },\n      userId: {\n        type: \"string\",\n        required: false\n      },\n      createdAt: {\n        type: \"date\"\n      },\n      updatedAt: {\n        type: \"date\"\n      }\n    }\n  },\n  oauthAccessToken: {\n    modelName: \"oauthAccessToken\",\n    fields: {\n      accessToken: {\n        type: \"string\",\n        unique: true\n      },\n      refreshToken: {\n        type: \"string\",\n        unique: true\n      },\n      accessTokenExpiresAt: {\n        type: \"date\"\n      },\n      refreshTokenExpiresAt: {\n        type: \"date\"\n      },\n      clientId: {\n        type: \"string\"\n      },\n      userId: {\n        type: \"string\",\n        required: false\n      },\n      scopes: {\n        type: \"string\"\n      },\n      createdAt: {\n        type: \"date\"\n      },\n      updatedAt: {\n        type: \"date\"\n      }\n    }\n  },\n  oauthConsent: {\n    modelName: \"oauthConsent\",\n    fields: {\n      clientId: {\n        type: \"string\"\n      },\n      userId: {\n        type: \"string\"\n      },\n      scopes: {\n        type: \"string\"\n      },\n      createdAt: {\n        type: \"date\"\n      },\n      updatedAt: {\n        type: \"date\"\n      },\n      consentGiven: {\n        type: \"boolean\"\n      }\n    }\n  }\n};\n\nfunction redirectErrorURL(url, error, description) {\n  return `${url.includes(\"?\") ? \"&\" : \"?\"}error=${error}&error_description=${description}`;\n}\nasync function authorize(ctx, options) {\n  const opts = {\n    codeExpiresIn: 600,\n    defaultScope: \"openid\",\n    ...options,\n    scopes: [\n      \"openid\",\n      \"profile\",\n      \"email\",\n      \"offline_access\",\n      ...options?.scopes || []\n    ]\n  };\n  if (!ctx.request) {\n    throw new APIError(\"UNAUTHORIZED\", {\n      error_description: \"request not found\",\n      error: \"invalid_request\"\n    });\n  }\n  const session = await getSessionFromCtx(ctx);\n  if (!session) {\n    await ctx.setSignedCookie(\n      \"oidc_login_prompt\",\n      JSON.stringify(ctx.query),\n      ctx.context.secret,\n      {\n        maxAge: 600\n      }\n    );\n    const queryFromURL = ctx.request.url?.split(\"?\")[1];\n    throw ctx.redirect(`${options.loginPage}?${queryFromURL}`);\n  }\n  const query = ctx.query;\n  if (!query.client_id) {\n    throw ctx.redirect(`${ctx.context.baseURL}/error?error=invalid_client`);\n  }\n  if (!query.response_type) {\n    throw ctx.redirect(\n      redirectErrorURL(\n        `${ctx.context.baseURL}/error`,\n        \"invalid_request\",\n        \"response_type is required\"\n      )\n    );\n  }\n  const client = await ctx.context.adapter.findOne({\n    model: \"oauthApplication\",\n    where: [\n      {\n        field: \"clientId\",\n        value: ctx.query.client_id\n      }\n    ]\n  }).then((res) => {\n    if (!res) {\n      return null;\n    }\n    return {\n      ...res,\n      redirectURLs: res.redirectURLs.split(\",\"),\n      metadata: res.metadata ? JSON.parse(res.metadata) : {}\n    };\n  });\n  if (!client) {\n    throw ctx.redirect(`${ctx.context.baseURL}/error?error=invalid_client`);\n  }\n  const redirectURI = client.redirectURLs.find(\n    (url) => url === ctx.query.redirect_uri\n  );\n  if (!redirectURI || !query.redirect_uri) {\n    throw new APIError(\"BAD_REQUEST\", {\n      message: \"Invalid redirect URI\"\n    });\n  }\n  if (client.disabled) {\n    throw ctx.redirect(`${ctx.context.baseURL}/error?error=client_disabled`);\n  }\n  if (query.response_type !== \"code\") {\n    throw ctx.redirect(\n      `${ctx.context.baseURL}/error?error=unsupported_response_type`\n    );\n  }\n  const requestScope = query.scope?.split(\" \").filter((s) => s) || opts.defaultScope.split(\" \");\n  const invalidScopes = requestScope.filter((scope) => {\n    const isInvalid = !opts.scopes.includes(scope) || scope === \"offline_access\" && query.prompt !== \"consent\";\n    return isInvalid;\n  });\n  if (invalidScopes.length) {\n    throw ctx.redirect(\n      redirectErrorURL(\n        query.redirect_uri,\n        \"invalid_scope\",\n        `The following scopes are invalid: ${invalidScopes.join(\", \")}`\n      )\n    );\n  }\n  if ((!query.code_challenge || !query.code_challenge_method) && options.requirePKCE) {\n    throw ctx.redirect(\n      redirectErrorURL(\n        query.redirect_uri,\n        \"invalid_request\",\n        \"pkce is required\"\n      )\n    );\n  }\n  if (!query.code_challenge_method) {\n    query.code_challenge_method = \"plain\";\n  }\n  if (![\n    \"s256\",\n    options.allowPlainCodeChallengeMethod ? \"plain\" : \"s256\"\n  ].includes(query.code_challenge_method?.toLowerCase() || \"\")) {\n    throw ctx.redirect(\n      redirectErrorURL(\n        query.redirect_uri,\n        \"invalid_request\",\n        \"invalid code_challenge method\"\n      )\n    );\n  }\n  const code = generateRandomString(32, \"a-z\", \"A-Z\", \"0-9\");\n  const codeExpiresInMs = opts.codeExpiresIn * 1e3;\n  const expiresAt = new Date(Date.now() + codeExpiresInMs);\n  try {\n    await ctx.context.internalAdapter.createVerificationValue({\n      value: JSON.stringify({\n        clientId: client.clientId,\n        redirectURI: query.redirect_uri,\n        scope: requestScope,\n        userId: session.user.id,\n        authTime: session.session.createdAt.getTime(),\n        /**\n         * If the prompt is set to `consent`, then we need\n         * to require the user to consent to the scopes.\n         *\n         * This means the code now needs to be treated as a\n         * consent request.\n         *\n         * once the user consents, teh code will be updated\n         * with the actual code. This is to prevent the\n         * client from using the code before the user\n         * consents.\n         */\n        requireConsent: query.prompt === \"consent\",\n        state: query.prompt === \"consent\" ? query.state : null,\n        codeChallenge: query.code_challenge,\n        codeChallengeMethod: query.code_challenge_method,\n        nonce: query.nonce\n      }),\n      identifier: code,\n      expiresAt\n    });\n  } catch (e) {\n    throw ctx.redirect(\n      redirectErrorURL(\n        query.redirect_uri,\n        \"server_error\",\n        \"An error occurred while processing the request\"\n      )\n    );\n  }\n  const redirectURIWithCode = new URL(redirectURI);\n  redirectURIWithCode.searchParams.set(\"code\", code);\n  redirectURIWithCode.searchParams.set(\"state\", ctx.query.state);\n  if (query.prompt !== \"consent\") {\n    throw ctx.redirect(redirectURIWithCode.toString());\n  }\n  const hasAlreadyConsented = await ctx.context.adapter.findOne({\n    model: \"oauthConsent\",\n    where: [\n      {\n        field: \"clientId\",\n        value: client.clientId\n      },\n      {\n        field: \"userId\",\n        value: session.user.id\n      }\n    ]\n  }).then((res) => !!res?.consentGiven);\n  if (hasAlreadyConsented) {\n    throw ctx.redirect(redirectURIWithCode.toString());\n  }\n  if (options?.consentPage) {\n    await ctx.setSignedCookie(\"oidc_consent_prompt\", code, ctx.context.secret, {\n      maxAge: 600\n    });\n    const conceptURI = `${options.consentPage}?client_id=${client.clientId}&scope=${requestScope.join(\" \")}`;\n    throw ctx.redirect(conceptURI);\n  }\n  const htmlFn = options?.getConsentHTML;\n  if (!htmlFn) {\n    throw new APIError(\"INTERNAL_SERVER_ERROR\", {\n      message: \"No consent page provided\"\n    });\n  }\n  return new Response(\n    htmlFn({\n      scopes: requestScope,\n      clientMetadata: client.metadata,\n      clientIcon: client?.icon,\n      clientId: client.clientId,\n      clientName: client.name,\n      code\n    }),\n    {\n      headers: {\n        \"content-type\": \"text/html\"\n      }\n    }\n  );\n}\n\nconst getMetadata = (ctx, options) => {\n  const issuer = ctx.context.options.baseURL;\n  const baseURL = ctx.context.baseURL;\n  return {\n    issuer,\n    authorization_endpoint: `${baseURL}/oauth2/authorize`,\n    token_endpoint: `${baseURL}/oauth2/token`,\n    userinfo_endpoint: `${baseURL}/oauth2/userinfo`,\n    jwks_uri: `${baseURL}/jwks`,\n    registration_endpoint: `${baseURL}/oauth2/register`,\n    scopes_supported: [\"openid\", \"profile\", \"email\", \"offline_access\"],\n    response_types_supported: [\"code\"],\n    response_modes_supported: [\"query\"],\n    grant_types_supported: [\"authorization_code\"],\n    acr_values_supported: [\n      \"urn:mace:incommon:iap:silver\",\n      \"urn:mace:incommon:iap:bronze\"\n    ],\n    subject_types_supported: [\"public\"],\n    id_token_signing_alg_values_supported: [\"RS256\", \"none\"],\n    token_endpoint_auth_methods_supported: [\n      \"client_secret_basic\",\n      \"client_secret_post\"\n    ],\n    claims_supported: [\n      \"sub\",\n      \"iss\",\n      \"aud\",\n      \"exp\",\n      \"nbf\",\n      \"iat\",\n      \"jti\",\n      \"email\",\n      \"email_verified\",\n      \"name\"\n    ],\n    ...options?.metadata\n  };\n};\nconst oidcProvider = (options) => {\n  const modelName = {\n    oauthClient: \"oauthApplication\",\n    oauthAccessToken: \"oauthAccessToken\",\n    oauthConsent: \"oauthConsent\"\n  };\n  const opts = {\n    codeExpiresIn: 600,\n    defaultScope: \"openid\",\n    accessTokenExpiresIn: 3600,\n    refreshTokenExpiresIn: 604800,\n    allowPlainCodeChallengeMethod: true,\n    ...options,\n    scopes: [\n      \"openid\",\n      \"profile\",\n      \"email\",\n      \"offline_access\",\n      ...options?.scopes || []\n    ]\n  };\n  return {\n    id: \"oidc\",\n    hooks: {\n      after: [\n        {\n          matcher() {\n            return true;\n          },\n          handler: createAuthMiddleware(async (ctx) => {\n            const cookie = await ctx.getSignedCookie(\n              \"oidc_login_prompt\",\n              ctx.context.secret\n            );\n            const cookieName = ctx.context.authCookies.sessionToken.name;\n            const parsedSetCookieHeader = parseSetCookieHeader(\n              ctx.context.responseHeaders?.get(\"set-cookie\") || \"\"\n            );\n            const hasSessionToken = parsedSetCookieHeader.has(cookieName);\n            if (!cookie || !hasSessionToken) {\n              return;\n            }\n            ctx.setCookie(\"oidc_login_prompt\", \"\", {\n              maxAge: 0\n            });\n            const sessionCookie = parsedSetCookieHeader.get(cookieName)?.value;\n            const sessionToken = sessionCookie?.split(\".\")[0];\n            if (!sessionToken) {\n              return;\n            }\n            const session = await ctx.context.internalAdapter.findSession(sessionToken);\n            if (!session) {\n              return;\n            }\n            ctx.query = JSON.parse(cookie);\n            ctx.query.prompt = \"consent\";\n            ctx.context.session = session;\n            const response = await authorize(ctx, opts);\n            return response;\n          })\n        }\n      ]\n    },\n    endpoints: {\n      getOpenIdConfig: createAuthEndpoint(\n        \"/.well-known/openid-configuration\",\n        {\n          method: \"GET\",\n          metadata: {\n            isAction: false\n          }\n        },\n        async (ctx) => {\n          const metadata = getMetadata(ctx, options);\n          return ctx.json(metadata);\n        }\n      ),\n      oAuth2authorize: createAuthEndpoint(\n        \"/oauth2/authorize\",\n        {\n          method: \"GET\",\n          query: z.record(z.string(), z.any())\n        },\n        async (ctx) => {\n          return authorize(ctx, opts);\n        }\n      ),\n      oAuthConsent: createAuthEndpoint(\n        \"/oauth2/consent\",\n        {\n          method: \"POST\",\n          body: z.object({\n            accept: z.boolean()\n          }),\n          use: [sessionMiddleware]\n        },\n        async (ctx) => {\n          const storedCode = await ctx.getSignedCookie(\n            \"oidc_consent_prompt\",\n            ctx.context.secret\n          );\n          if (!storedCode) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"No consent prompt found\",\n              error: \"invalid_grant\"\n            });\n          }\n          const verification = await ctx.context.internalAdapter.findVerificationValue(storedCode);\n          if (!verification) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"Invalid code\",\n              error: \"invalid_grant\"\n            });\n          }\n          if (verification.expiresAt < /* @__PURE__ */ new Date()) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"Code expired\",\n              error: \"invalid_grant\"\n            });\n          }\n          const value = JSON.parse(verification.value);\n          if (!value.requireConsent || !value.state) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"Consent not required\",\n              error: \"invalid_grant\"\n            });\n          }\n          if (!ctx.body.accept) {\n            await ctx.context.internalAdapter.deleteVerificationValue(\n              verification.id\n            );\n            return ctx.json({\n              redirectURI: `${value.redirectURI}?error=access_denied&error_description=User denied access`\n            });\n          }\n          const code = generateRandomString(32, \"a-z\", \"A-Z\", \"0-9\");\n          const codeExpiresInMs = opts.codeExpiresIn * 1e3;\n          const expiresAt = new Date(Date.now() + codeExpiresInMs);\n          await ctx.context.internalAdapter.updateVerificationValue(\n            verification.id,\n            {\n              value: JSON.stringify({\n                ...value,\n                requireConsent: false\n              }),\n              identifier: code,\n              expiresAt\n            }\n          );\n          await ctx.context.adapter.create({\n            model: modelName.oauthConsent,\n            data: {\n              clientId: value.clientId,\n              userId: value.userId,\n              scopes: value.scope.join(\" \"),\n              consentGiven: true,\n              createdAt: /* @__PURE__ */ new Date(),\n              updatedAt: /* @__PURE__ */ new Date()\n            }\n          });\n          const redirectURI = new URL(value.redirectURI);\n          redirectURI.searchParams.set(\"code\", code);\n          redirectURI.searchParams.set(\"state\", value.state);\n          return ctx.json({\n            redirectURI: redirectURI.toString()\n          });\n        }\n      ),\n      oAuth2token: createAuthEndpoint(\n        \"/oauth2/token\",\n        {\n          method: \"POST\",\n          body: z.record(z.any()),\n          metadata: {\n            isAction: false\n          }\n        },\n        async (ctx) => {\n          let { body } = ctx;\n          if (!body) {\n            throw new APIError(\"BAD_REQUEST\", {\n              error_description: \"request body not found\",\n              error: \"invalid_request\"\n            });\n          }\n          if (body instanceof FormData) {\n            body = Object.fromEntries(body.entries());\n          }\n          if (!(body instanceof Object)) {\n            throw new APIError(\"BAD_REQUEST\", {\n              error_description: \"request body is not an object\",\n              error: \"invalid_request\"\n            });\n          }\n          let { client_id, client_secret } = body;\n          const authorization = ctx.request?.headers.get(\"authorization\") || null;\n          if (authorization && !client_id && !client_secret && authorization.startsWith(\"Basic \")) {\n            try {\n              const encoded = authorization.replace(\"Basic \", \"\");\n              const decoded = new TextDecoder().decode(base64.decode(encoded));\n              if (!decoded.includes(\":\")) {\n                throw new APIError(\"UNAUTHORIZED\", {\n                  error_description: \"invalid authorization header format\",\n                  error: \"invalid_client\"\n                });\n              }\n              const [id, secret] = decoded.split(\":\");\n              if (!id || !secret) {\n                throw new APIError(\"UNAUTHORIZED\", {\n                  error_description: \"invalid authorization header format\",\n                  error: \"invalid_client\"\n                });\n              }\n              client_id = id;\n              client_secret = secret;\n            } catch (error) {\n              throw new APIError(\"UNAUTHORIZED\", {\n                error_description: \"invalid authorization header format\",\n                error: \"invalid_client\"\n              });\n            }\n          }\n          const {\n            grant_type,\n            code,\n            redirect_uri,\n            refresh_token,\n            code_verifier\n          } = body;\n          if (grant_type === \"refresh_token\") {\n            if (!refresh_token) {\n              throw new APIError(\"BAD_REQUEST\", {\n                error_description: \"refresh_token is required\",\n                error: \"invalid_request\"\n              });\n            }\n            const token = await ctx.context.adapter.findOne({\n              model: modelName.oauthAccessToken,\n              where: [\n                {\n                  field: \"refreshToken\",\n                  value: refresh_token.toString()\n                }\n              ]\n            });\n            if (!token) {\n              throw new APIError(\"UNAUTHORIZED\", {\n                error_description: \"invalid refresh token\",\n                error: \"invalid_grant\"\n              });\n            }\n            if (token.clientId !== client_id?.toString()) {\n              throw new APIError(\"UNAUTHORIZED\", {\n                error_description: \"invalid client_id\",\n                error: \"invalid_client\"\n              });\n            }\n            if (token.refreshTokenExpiresAt < /* @__PURE__ */ new Date()) {\n              throw new APIError(\"UNAUTHORIZED\", {\n                error_description: \"refresh token expired\",\n                error: \"invalid_grant\"\n              });\n            }\n            const accessToken2 = generateRandomString(32, \"a-z\", \"A-Z\");\n            const newRefreshToken = generateRandomString(32, \"a-z\", \"A-Z\");\n            const accessTokenExpiresAt2 = new Date(\n              Date.now() + opts.accessTokenExpiresIn * 1e3\n            );\n            const refreshTokenExpiresAt2 = new Date(\n              Date.now() + opts.refreshTokenExpiresIn * 1e3\n            );\n            await ctx.context.adapter.create({\n              model: modelName.oauthAccessToken,\n              data: {\n                accessToken: accessToken2,\n                refreshToken: newRefreshToken,\n                accessTokenExpiresAt: accessTokenExpiresAt2,\n                refreshTokenExpiresAt: refreshTokenExpiresAt2,\n                clientId: client_id.toString(),\n                userId: token.userId,\n                scopes: token.scopes,\n                createdAt: /* @__PURE__ */ new Date(),\n                updatedAt: /* @__PURE__ */ new Date()\n              }\n            });\n            return ctx.json({\n              access_token: accessToken2,\n              token_type: \"bearer\",\n              expires_in: opts.accessTokenExpiresIn,\n              refresh_token: newRefreshToken,\n              scope: token.scopes\n            });\n          }\n          if (!code) {\n            throw new APIError(\"BAD_REQUEST\", {\n              error_description: \"code is required\",\n              error: \"invalid_request\"\n            });\n          }\n          if (options.requirePKCE && !code_verifier) {\n            throw new APIError(\"BAD_REQUEST\", {\n              error_description: \"code verifier is missing\",\n              error: \"invalid_request\"\n            });\n          }\n          const verificationValue = await ctx.context.internalAdapter.findVerificationValue(\n            code.toString()\n          );\n          if (!verificationValue) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"invalid code\",\n              error: \"invalid_grant\"\n            });\n          }\n          if (verificationValue.expiresAt < /* @__PURE__ */ new Date()) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"code expired\",\n              error: \"invalid_grant\"\n            });\n          }\n          await ctx.context.internalAdapter.deleteVerificationValue(\n            verificationValue.id\n          );\n          if (!client_id || !client_secret) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"client_id and client_secret are required\",\n              error: \"invalid_client\"\n            });\n          }\n          if (!grant_type) {\n            throw new APIError(\"BAD_REQUEST\", {\n              error_description: \"grant_type is required\",\n              error: \"invalid_request\"\n            });\n          }\n          if (grant_type !== \"authorization_code\") {\n            throw new APIError(\"BAD_REQUEST\", {\n              error_description: \"grant_type must be 'authorization_code'\",\n              error: \"unsupported_grant_type\"\n            });\n          }\n          if (!redirect_uri) {\n            throw new APIError(\"BAD_REQUEST\", {\n              error_description: \"redirect_uri is required\",\n              error: \"invalid_request\"\n            });\n          }\n          const client = await ctx.context.adapter.findOne({\n            model: modelName.oauthClient,\n            where: [{ field: \"clientId\", value: client_id.toString() }]\n          }).then((res) => {\n            if (!res) {\n              return null;\n            }\n            return {\n              ...res,\n              redirectURLs: res.redirectURLs.split(\",\"),\n              metadata: res.metadata ? JSON.parse(res.metadata) : {}\n            };\n          });\n          if (!client) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"invalid client_id\",\n              error: \"invalid_client\"\n            });\n          }\n          if (client.disabled) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"client is disabled\",\n              error: \"invalid_client\"\n            });\n          }\n          const isValidSecret = client.clientSecret === client_secret.toString();\n          if (!isValidSecret) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"invalid client_secret\",\n              error: \"invalid_client\"\n            });\n          }\n          const value = JSON.parse(\n            verificationValue.value\n          );\n          if (value.clientId !== client_id.toString()) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"invalid client_id\",\n              error: \"invalid_client\"\n            });\n          }\n          if (value.redirectURI !== redirect_uri.toString()) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"invalid redirect_uri\",\n              error: \"invalid_client\"\n            });\n          }\n          if (value.codeChallenge && !code_verifier) {\n            throw new APIError(\"BAD_REQUEST\", {\n              error_description: \"code verifier is missing\",\n              error: \"invalid_request\"\n            });\n          }\n          const challenge = value.codeChallengeMethod === \"plain\" ? code_verifier : await createHash(\"SHA-256\", \"base64urlnopad\").digest(\n            code_verifier\n          );\n          if (challenge !== value.codeChallenge) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"code verification failed\",\n              error: \"invalid_request\"\n            });\n          }\n          const requestedScopes = value.scope;\n          await ctx.context.internalAdapter.deleteVerificationValue(\n            verificationValue.id\n          );\n          const accessToken = generateRandomString(32, \"a-z\", \"A-Z\");\n          const refreshToken = generateRandomString(32, \"A-Z\", \"a-z\");\n          const accessTokenExpiresAt = new Date(\n            Date.now() + opts.accessTokenExpiresIn * 1e3\n          );\n          const refreshTokenExpiresAt = new Date(\n            Date.now() + opts.refreshTokenExpiresIn * 1e3\n          );\n          await ctx.context.adapter.create({\n            model: modelName.oauthAccessToken,\n            data: {\n              accessToken,\n              refreshToken,\n              accessTokenExpiresAt,\n              refreshTokenExpiresAt,\n              clientId: client_id.toString(),\n              userId: value.userId,\n              scopes: requestedScopes.join(\" \"),\n              createdAt: /* @__PURE__ */ new Date(),\n              updatedAt: /* @__PURE__ */ new Date()\n            }\n          });\n          const user = await ctx.context.internalAdapter.findUserById(\n            value.userId\n          );\n          if (!user) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"user not found\",\n              error: \"invalid_grant\"\n            });\n          }\n          let secretKey = {\n            alg: \"HS256\",\n            key: await subtle.generateKey(\n              {\n                name: \"HMAC\",\n                hash: \"SHA-256\"\n              },\n              true,\n              [\"sign\", \"verify\"]\n            )\n          };\n          const profile = {\n            given_name: user.name.split(\" \")[0],\n            family_name: user.name.split(\" \")[1],\n            name: user.name,\n            profile: user.image,\n            updated_at: user.updatedAt.toISOString()\n          };\n          const email = {\n            email: user.email,\n            email_verified: user.emailVerified\n          };\n          const userClaims = {\n            ...requestedScopes.includes(\"profile\") ? profile : {},\n            ...requestedScopes.includes(\"email\") ? email : {}\n          };\n          const idToken = await new SignJWT({\n            sub: user.id,\n            aud: client_id.toString(),\n            iat: Date.now(),\n            auth_time: ctx.context.session?.session.createdAt.getTime(),\n            nonce: value.nonce,\n            acr: \"urn:mace:incommon:iap:silver\",\n            // default to silver -  this should be configurable and should be validated against the client's metadata\n            ...userClaims\n          }).setProtectedHeader({ alg: secretKey.alg }).setIssuedAt().setExpirationTime(\n            Math.floor(Date.now() / 1e3) + opts.accessTokenExpiresIn\n          ).sign(secretKey.key);\n          return ctx.json(\n            {\n              access_token: accessToken,\n              token_type: \"Bearer\",\n              expires_in: opts.accessTokenExpiresIn,\n              refresh_token: requestedScopes.includes(\"offline_access\") ? refreshToken : void 0,\n              scope: requestedScopes.join(\" \"),\n              id_token: requestedScopes.includes(\"openid\") ? idToken : void 0\n            },\n            {\n              headers: {\n                \"Cache-Control\": \"no-store\",\n                Pragma: \"no-cache\"\n              }\n            }\n          );\n        }\n      ),\n      oAuth2userInfo: createAuthEndpoint(\n        \"/oauth2/userinfo\",\n        {\n          method: \"GET\",\n          metadata: {\n            isAction: false\n          }\n        },\n        async (ctx) => {\n          if (!ctx.request) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"request not found\",\n              error: \"invalid_request\"\n            });\n          }\n          const authorization = ctx.request.headers.get(\"authorization\");\n          if (!authorization) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"authorization header not found\",\n              error: \"invalid_request\"\n            });\n          }\n          const token = authorization.replace(\"Bearer \", \"\");\n          const accessToken = await ctx.context.adapter.findOne({\n            model: modelName.oauthAccessToken,\n            where: [\n              {\n                field: \"accessToken\",\n                value: token\n              }\n            ]\n          });\n          if (!accessToken) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"invalid access token\",\n              error: \"invalid_token\"\n            });\n          }\n          if (accessToken.accessTokenExpiresAt < /* @__PURE__ */ new Date()) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"The Access Token expired\",\n              error: \"invalid_token\"\n            });\n          }\n          const user = await ctx.context.internalAdapter.findUserById(\n            accessToken.userId\n          );\n          if (!user) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error_description: \"user not found\",\n              error: \"invalid_token\"\n            });\n          }\n          const requestedScopes = accessToken.scopes.split(\" \");\n          const userClaims = {\n            sub: user.id,\n            email: requestedScopes.includes(\"email\") ? user.email : void 0,\n            name: requestedScopes.includes(\"profile\") ? user.name : void 0,\n            picture: requestedScopes.includes(\"profile\") ? user.image : void 0,\n            given_name: requestedScopes.includes(\"profile\") ? user.name.split(\" \")[0] : void 0,\n            family_name: requestedScopes.includes(\"profile\") ? user.name.split(\" \")[1] : void 0,\n            email_verified: requestedScopes.includes(\"email\") ? user.emailVerified : void 0\n          };\n          return ctx.json(userClaims);\n        }\n      ),\n      registerOAuthApplication: createAuthEndpoint(\n        \"/oauth2/register\",\n        {\n          method: \"POST\",\n          body: z.object({\n            redirect_uris: z.array(z.string()),\n            token_endpoint_auth_method: z.enum([\"none\", \"client_secret_basic\", \"client_secret_post\"]).default(\"client_secret_basic\").optional(),\n            grant_types: z.array(\n              z.enum([\n                \"authorization_code\",\n                \"implicit\",\n                \"password\",\n                \"client_credentials\",\n                \"refresh_token\",\n                \"urn:ietf:params:oauth:grant-type:jwt-bearer\",\n                \"urn:ietf:params:oauth:grant-type:saml2-bearer\"\n              ])\n            ).default([\"authorization_code\"]).optional(),\n            response_types: z.array(z.enum([\"code\", \"token\"])).default([\"code\"]).optional(),\n            client_name: z.string().optional(),\n            client_uri: z.string().optional(),\n            logo_uri: z.string().optional(),\n            scope: z.string().optional(),\n            contacts: z.array(z.string()).optional(),\n            tos_uri: z.string().optional(),\n            policy_uri: z.string().optional(),\n            jwks_uri: z.string().optional(),\n            jwks: z.record(z.any()).optional(),\n            metadata: z.record(z.any()).optional(),\n            software_id: z.string().optional(),\n            software_version: z.string().optional(),\n            software_statement: z.string().optional()\n          })\n        },\n        async (ctx) => {\n          const body = ctx.body;\n          const session = await getSessionFromCtx(ctx);\n          if (!session && !options.allowDynamicClientRegistration) {\n            throw new APIError(\"UNAUTHORIZED\", {\n              error: \"invalid_token\",\n              error_description: \"Authentication required for client registration\"\n            });\n          }\n          if ((!body.grant_types || body.grant_types.includes(\"authorization_code\") || body.grant_types.includes(\"implicit\")) && (!body.redirect_uris || body.redirect_uris.length === 0)) {\n            throw new APIError(\"BAD_REQUEST\", {\n              error: \"invalid_redirect_uri\",\n              error_description: \"Redirect URIs are required for authorization_code and implicit grant types\"\n            });\n          }\n          if (body.grant_types && body.response_types) {\n            if (body.grant_types.includes(\"authorization_code\") && !body.response_types.includes(\"code\")) {\n              throw new APIError(\"BAD_REQUEST\", {\n                error: \"invalid_client_metadata\",\n                error_description: \"When 'authorization_code' grant type is used, 'code' response type must be included\"\n              });\n            }\n            if (body.grant_types.includes(\"implicit\") && !body.response_types.includes(\"token\")) {\n              throw new APIError(\"BAD_REQUEST\", {\n                error: \"invalid_client_metadata\",\n                error_description: \"When 'implicit' grant type is used, 'token' response type must be included\"\n              });\n            }\n          }\n          const clientId = options.generateClientId?.() || generateRandomString(32, \"a-z\", \"A-Z\");\n          const clientSecret = options.generateClientSecret?.() || generateRandomString(32, \"a-z\", \"A-Z\");\n          await ctx.context.adapter.create({\n            model: modelName.oauthClient,\n            data: {\n              name: body.client_name,\n              icon: body.logo_uri,\n              metadata: body.metadata ? JSON.stringify(body.metadata) : null,\n              clientId,\n              clientSecret,\n              redirectURLs: body.redirect_uris.join(\",\"),\n              type: \"web\",\n              authenticationScheme: body.token_endpoint_auth_method || \"client_secret_basic\",\n              disabled: false,\n              userId: session?.session.userId,\n              createdAt: /* @__PURE__ */ new Date(),\n              updatedAt: /* @__PURE__ */ new Date()\n            }\n          });\n          return ctx.json(\n            {\n              client_id: clientId,\n              client_secret: clientSecret,\n              client_id_issued_at: Math.floor(Date.now() / 1e3),\n              client_secret_expires_at: 0,\n              // 0 means it doesn't expire\n              redirect_uris: body.redirect_uris,\n              token_endpoint_auth_method: body.token_endpoint_auth_method || \"client_secret_basic\",\n              grant_types: body.grant_types || [\"authorization_code\"],\n              response_types: body.response_types || [\"code\"],\n              client_name: body.client_name,\n              client_uri: body.client_uri,\n              logo_uri: body.logo_uri,\n              scope: body.scope,\n              contacts: body.contacts,\n              tos_uri: body.tos_uri,\n              policy_uri: body.policy_uri,\n              jwks_uri: body.jwks_uri,\n              jwks: body.jwks,\n              software_id: body.software_id,\n              software_version: body.software_version,\n              software_statement: body.software_statement,\n              metadata: body.metadata\n            },\n            {\n              status: 201,\n              headers: {\n                \"Cache-Control\": \"no-store\",\n                Pragma: \"no-cache\"\n              }\n            }\n          );\n        }\n      ),\n      getOAuthClient: createAuthEndpoint(\n        \"/oauth2/client/:id\",\n        {\n          method: \"GET\",\n          use: [sessionMiddleware]\n        },\n        async (ctx) => {\n          const client = await ctx.context.adapter.findOne(\n            {\n              model: modelName.oauthClient,\n              where: [{ field: \"clientId\", value: ctx.params.id }]\n            }\n          );\n          if (!client) {\n            throw new APIError(\"NOT_FOUND\", {\n              error_description: \"client not found\",\n              error: \"not_found\"\n            });\n          }\n          return ctx.json({\n            clientId: client.clientId,\n            name: client.name,\n            icon: client.icon\n          });\n        }\n      )\n    },\n    schema\n  };\n};\n\nexport { oidcProvider };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 6528, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/captcha/index.mjs"],"sourcesContent":["import { betterFetch } from '@better-fetch/fetch';\n\nconst defaultEndpoints = [\"/sign-up\", \"/sign-in\", \"/forget-password\"];\nconst Providers = {\n  CLOUDFLARE_TURNSTILE: \"cloudflare-turnstile\",\n  GOOGLE_RECAPTCHA: \"google-recaptcha\"\n};\nconst siteVerifyMap = {\n  [Providers.CLOUDFLARE_TURNSTILE]: \"https://challenges.cloudflare.com/turnstile/v0/siteverify\",\n  [Providers.GOOGLE_RECAPTCHA]: \"https://www.google.com/recaptcha/api/siteverify\"\n};\n\nconst CAPTCHA_ERROR_CODES = {\n  MISSING_RESPONSE: \"Missing CAPTCHA response\",\n  SERVICE_UNAVAILABLE: \"CAPTCHA service unavailable\",\n  VERIFICATION_FAILED: \"Captcha verification failed\",\n  UNKNOWN_ERROR: \"Something went wrong\"\n};\n\nconst middlewareResponse = ({ message, status }) => ({\n  response: new Response(\n    JSON.stringify({\n      message\n    }),\n    {\n      status\n    }\n  )\n});\n\nconst cloudflareTurnstile = async ({\n  siteVerifyURL,\n  captchaResponse,\n  secretKey\n}) => {\n  const response = await betterFetch(\n    siteVerifyURL,\n    {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        secret: secretKey,\n        response: captchaResponse\n      })\n    }\n  );\n  if (!response.data || response.error) {\n    return middlewareResponse({\n      message: CAPTCHA_ERROR_CODES.SERVICE_UNAVAILABLE,\n      status: 503\n    });\n  }\n  if (!response.data.success) {\n    return middlewareResponse({\n      message: CAPTCHA_ERROR_CODES.VERIFICATION_FAILED,\n      status: 403\n    });\n  }\n  return void 0;\n};\n\nconst googleReCAPTCHA = async ({\n  siteVerifyURL,\n  captchaResponse,\n  secretKey\n}) => {\n  const response = await betterFetch(\n    siteVerifyURL,\n    {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        secret: secretKey,\n        response: captchaResponse\n      })\n    }\n  );\n  if (!response.data || response.error) {\n    return middlewareResponse({\n      message: CAPTCHA_ERROR_CODES.SERVICE_UNAVAILABLE,\n      status: 503\n    });\n  }\n  if (!response.data.success) {\n    return middlewareResponse({\n      message: CAPTCHA_ERROR_CODES.VERIFICATION_FAILED,\n      status: 403\n    });\n  }\n  return void 0;\n};\n\nconst captcha = (options) => ({\n  id: \"captcha\",\n  onRequest: async (request) => {\n    try {\n      if (request.method !== \"POST\") return void 0;\n      const endpoints = options.endpoints?.length ? options.endpoints : defaultEndpoints;\n      if (!endpoints.some((endpoint) => request.url.includes(endpoint)))\n        return;\n      const captchaResponse = request.headers.get(\"x-captcha-response\");\n      if (!captchaResponse) {\n        return middlewareResponse({\n          message: CAPTCHA_ERROR_CODES.MISSING_RESPONSE,\n          status: 400\n        });\n      }\n      const siteVerifyURL = options.siteVerifyURLOverride || siteVerifyMap[options.provider];\n      if (options.provider === Providers.CLOUDFLARE_TURNSTILE) {\n        return await cloudflareTurnstile({\n          secretKey: options.secretKey,\n          captchaResponse,\n          siteVerifyURL\n        });\n      }\n      if (options.provider === Providers.GOOGLE_RECAPTCHA) {\n        return await googleReCAPTCHA({\n          secretKey: options.secretKey,\n          captchaResponse,\n          siteVerifyURL\n        });\n      }\n    } catch (_error) {\n      return middlewareResponse({\n        message: CAPTCHA_ERROR_CODES.UNKNOWN_ERROR,\n        status: 500\n      });\n    }\n  }\n});\n\nexport { captcha };\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,mBAAmB;IAAC;IAAY;IAAY;CAAmB;AACrE,MAAM,YAAY;IAChB,sBAAsB;IACtB,kBAAkB;AACpB;AACA,MAAM,gBAAgB;IACpB,CAAC,UAAU,oBAAoB,CAAC,EAAE;IAClC,CAAC,UAAU,gBAAgB,CAAC,EAAE;AAChC;AAEA,MAAM,sBAAsB;IAC1B,kBAAkB;IAClB,qBAAqB;IACrB,qBAAqB;IACrB,eAAe;AACjB;AAEA,MAAM,qBAAqB,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,GAAK,CAAC;QACnD,UAAU,IAAI,SACZ,KAAK,SAAS,CAAC;YACb;QACF,IACA;YACE;QACF;IAEJ,CAAC;AAED,MAAM,sBAAsB,OAAO,EACjC,aAAa,EACb,eAAe,EACf,SAAS,EACV;IACC,MAAM,WAAW,MAAM,CAAA,GAAA,6JAAA,CAAA,cAAW,AAAD,EAC/B,eACA;QACE,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YACnB,QAAQ;YACR,UAAU;QACZ;IACF;IAEF,IAAI,CAAC,SAAS,IAAI,IAAI,SAAS,KAAK,EAAE;QACpC,OAAO,mBAAmB;YACxB,SAAS,oBAAoB,mBAAmB;YAChD,QAAQ;QACV;IACF;IACA,IAAI,CAAC,SAAS,IAAI,CAAC,OAAO,EAAE;QAC1B,OAAO,mBAAmB;YACxB,SAAS,oBAAoB,mBAAmB;YAChD,QAAQ;QACV;IACF;IACA,OAAO,KAAK;AACd;AAEA,MAAM,kBAAkB,OAAO,EAC7B,aAAa,EACb,eAAe,EACf,SAAS,EACV;IACC,MAAM,WAAW,MAAM,CAAA,GAAA,6JAAA,CAAA,cAAW,AAAD,EAC/B,eACA;QACE,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YACnB,QAAQ;YACR,UAAU;QACZ;IACF;IAEF,IAAI,CAAC,SAAS,IAAI,IAAI,SAAS,KAAK,EAAE;QACpC,OAAO,mBAAmB;YACxB,SAAS,oBAAoB,mBAAmB;YAChD,QAAQ;QACV;IACF;IACA,IAAI,CAAC,SAAS,IAAI,CAAC,OAAO,EAAE;QAC1B,OAAO,mBAAmB;YACxB,SAAS,oBAAoB,mBAAmB;YAChD,QAAQ;QACV;IACF;IACA,OAAO,KAAK;AACd;AAEA,MAAM,UAAU,CAAC,UAAY,CAAC;QAC5B,IAAI;QACJ,WAAW,OAAO;YAChB,IAAI;gBACF,IAAI,QAAQ,MAAM,KAAK,QAAQ,OAAO,KAAK;gBAC3C,MAAM,YAAY,QAAQ,SAAS,EAAE,SAAS,QAAQ,SAAS,GAAG;gBAClE,IAAI,CAAC,UAAU,IAAI,CAAC,CAAC,WAAa,QAAQ,GAAG,CAAC,QAAQ,CAAC,YACrD;gBACF,MAAM,kBAAkB,QAAQ,OAAO,CAAC,GAAG,CAAC;gBAC5C,IAAI,CAAC,iBAAiB;oBACpB,OAAO,mBAAmB;wBACxB,SAAS,oBAAoB,gBAAgB;wBAC7C,QAAQ;oBACV;gBACF;gBACA,MAAM,gBAAgB,QAAQ,qBAAqB,IAAI,aAAa,CAAC,QAAQ,QAAQ,CAAC;gBACtF,IAAI,QAAQ,QAAQ,KAAK,UAAU,oBAAoB,EAAE;oBACvD,OAAO,MAAM,oBAAoB;wBAC/B,WAAW,QAAQ,SAAS;wBAC5B;wBACA;oBACF;gBACF;gBACA,IAAI,QAAQ,QAAQ,KAAK,UAAU,gBAAgB,EAAE;oBACnD,OAAO,MAAM,gBAAgB;wBAC3B,WAAW,QAAQ,SAAS;wBAC5B;wBACA;oBACF;gBACF;YACF,EAAE,OAAO,QAAQ;gBACf,OAAO,mBAAmB;oBACxB,SAAS,oBAAoB,aAAa;oBAC1C,QAAQ;gBACV;YACF;QACF;IACF,CAAC","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 6653, "column": 0}, "map": {"version":3,"sources":["file:///Users/Nathan/Library/CloudStorage/Dropbox/Tech/projects/mapapp/node_modules/better-auth/dist/plugins/index.mjs"],"sourcesContent":["export { o as organization, p as parseRoles } from '../shared/better-auth.D4VhqHde.mjs';\nexport { twoFactor } from './two-factor/index.mjs';\nexport { username } from './username/index.mjs';\nexport { bearer } from './bearer/index.mjs';\nimport { a as createAuthEndpoint, g as getSessionFromCtx, s as sessionMiddleware, c as createAuthMiddleware } from '../shared/better-auth.C92a320y.mjs';\nexport { H as HIDE_METADATA, N as optionsMiddleware } from '../shared/better-auth.C92a320y.mjs';\nexport { magicLink } from './magic-link/index.mjs';\nexport { phoneNumber } from './phone-number/index.mjs';\nexport { anonymous } from './anonymous/index.mjs';\nexport { a as admin } from '../shared/better-auth.NGxXmel9.mjs';\nexport { genericOAuth } from './generic-oauth/index.mjs';\nexport { getJwtToken, jwt } from './jwt/index.mjs';\nexport { multiSession } from './multi-session/index.mjs';\nexport { emailOTP } from './email-otp/index.mjs';\nexport { oneTap } from './one-tap/index.mjs';\nexport { oAuthProxy } from './oauth-proxy/index.mjs';\nexport { customSession } from './custom-session/index.mjs';\nexport { openAPI } from './open-api/index.mjs';\nexport { oidcProvider } from './oidc-provider/index.mjs';\nexport { captcha } from './captcha/index.mjs';\nimport { base64Url } from '@better-auth/utils/base64';\nimport { createHash } from '@better-auth/utils/hash';\nimport { APIError } from 'better-call';\nimport { z } from 'zod';\nimport { g as getDate } from '../shared/better-auth.CW6D9eSx.mjs';\nimport '../shared/better-auth.8zoxzg-F.mjs';\nimport '@better-auth/utils/hmac';\nimport { m as mergeSchema } from '../shared/better-auth.C24Bzw4w.mjs';\nimport '../shared/better-auth.DH3YjMQH.mjs';\nimport { g as getIp } from '../shared/better-auth.Duk7IG0N.mjs';\nimport 'defu';\nimport '@better-auth/utils/random';\nimport '@noble/ciphers/chacha';\nimport '@noble/ciphers/utils';\nimport '@noble/ciphers/webcrypto';\nimport 'jose';\nimport '@noble/hashes/scrypt';\nimport '@better-auth/utils';\nimport '@better-auth/utils/hex';\nimport '@noble/hashes/utils';\nimport '../shared/better-auth.B4Qoxdgc.mjs';\nimport 'kysely';\nimport { p as parseJSON } from '../shared/better-auth.ffWeg50w.mjs';\nimport { s as safeJSONParse } from '../shared/better-auth.tB5eU6EY.mjs';\nimport { g as generateId } from '../shared/better-auth.BUPPRXfK.mjs';\nimport { role } from './access/index.mjs';\nexport { t as twoFactorClient } from '../shared/better-auth.Ddw8bVyV.mjs';\nimport '../shared/better-auth.DdzSJf-n.mjs';\nimport './organization/access/index.mjs';\nimport '../cookies/index.mjs';\nimport '../crypto/index.mjs';\nimport '../shared/better-auth.OT3XFeFk.mjs';\nimport '../shared/better-auth.DDEbWX-S.mjs';\nimport '../shared/better-auth.-VszM4Ix.mjs';\nimport '../shared/better-auth.BcoSd9tC.mjs';\nimport '@better-auth/utils/otp';\nimport '../shared/better-auth.YwDQhoPc.mjs';\nimport '../social-providers/index.mjs';\nimport '@better-fetch/fetch';\nimport '../shared/better-auth.D7syfoJW.mjs';\nimport '../shared/better-auth.CbXAPXob.mjs';\nimport '../shared/better-auth.VTXNLFMT.mjs';\nimport 'jose/errors';\nimport '@better-auth/utils/binary';\nimport '../shared/better-auth.DQI8AD7d.mjs';\nimport './admin/access/index.mjs';\nimport '../shared/better-auth.fsvwNeUx.mjs';\nimport '../api/index.mjs';\nimport '../shared/better-auth.DORkW_Ge.mjs';\n\nconst apiKeySchema = ({\n  timeWindow,\n  rateLimitMax\n}) => ({\n  apikey: {\n    modelName: \"apikey\",\n    fields: {\n      /**\n       * The name of the key.\n       */\n      name: {\n        type: \"string\",\n        required: false,\n        input: false\n      },\n      /**\n       * Shows the first few characters of the API key\n       * This allows you to show those few characters in the UI to make it easier for users to identify the API key.\n       */\n      start: {\n        type: \"string\",\n        required: false,\n        input: false\n      },\n      /**\n       * The prefix of the key.\n       */\n      prefix: {\n        type: \"string\",\n        required: false,\n        input: false\n      },\n      /**\n       * The hashed key value.\n       */\n      key: {\n        type: \"string\",\n        required: true,\n        input: false\n      },\n      /**\n       * The user id of the user who created the key.\n       */\n      userId: {\n        type: \"string\",\n        references: { model: \"user\", field: \"id\" },\n        required: true,\n        input: false\n      },\n      /**\n       * The interval to refill the key in milliseconds.\n       */\n      refillInterval: {\n        type: \"number\",\n        required: false,\n        input: false\n      },\n      /**\n       * The amount to refill the remaining count of the key.\n       */\n      refillAmount: {\n        type: \"number\",\n        required: false,\n        input: false\n      },\n      /**\n       * The date and time when the key was last refilled.\n       */\n      lastRefillAt: {\n        type: \"date\",\n        required: false,\n        input: false\n      },\n      /**\n       * Whether the key is enabled.\n       */\n      enabled: {\n        type: \"boolean\",\n        required: false,\n        input: false,\n        defaultValue: true\n      },\n      /**\n       * Whether the key has rate limiting enabled.\n       */\n      rateLimitEnabled: {\n        type: \"boolean\",\n        required: false,\n        input: false,\n        defaultValue: true\n      },\n      /**\n       * The time window in milliseconds for the rate limit.\n       */\n      rateLimitTimeWindow: {\n        type: \"number\",\n        required: false,\n        input: false,\n        defaultValue: timeWindow\n      },\n      /**\n       * The maximum number of requests allowed within the `rateLimitTimeWindow`.\n       */\n      rateLimitMax: {\n        type: \"number\",\n        required: false,\n        input: false,\n        defaultValue: rateLimitMax\n      },\n      /**\n       * The number of requests made within the rate limit time window\n       */\n      requestCount: {\n        type: \"number\",\n        required: false,\n        input: false,\n        defaultValue: 0\n      },\n      /**\n       * The remaining number of requests before the key is revoked.\n       *\n       * If this is null, then the key is not revoked.\n       *\n       * If `refillInterval` & `refillAmount` are provided, than this will refill accordingly.\n       */\n      remaining: {\n        type: \"number\",\n        required: false,\n        input: false\n      },\n      /**\n       * The date and time of the last request made to the key.\n       */\n      lastRequest: {\n        type: \"date\",\n        required: false,\n        input: false\n      },\n      /**\n       * The date and time when the key will expire.\n       */\n      expiresAt: {\n        type: \"date\",\n        required: false,\n        input: false\n      },\n      /**\n       * The date and time when the key was created.\n       */\n      createdAt: {\n        type: \"date\",\n        required: true,\n        input: false\n      },\n      /**\n       * The date and time when the key was last updated.\n       */\n      updatedAt: {\n        type: \"date\",\n        required: true,\n        input: false\n      },\n      /**\n       * The permissions of the key.\n       */\n      permissions: {\n        type: \"string\",\n        required: false,\n        input: false\n      },\n      /**\n       * Any additional metadata you want to store with the key.\n       */\n      metadata: {\n        type: \"string\",\n        required: false,\n        input: true,\n        transform: {\n          input(value) {\n            return JSON.stringify(value);\n          },\n          output(value) {\n            if (!value) return null;\n            return parseJSON(value);\n          }\n        }\n      }\n    }\n  }\n});\n\nfunction createApiKey({\n  keyGenerator,\n  opts,\n  schema,\n  deleteAllExpiredApiKeys\n}) {\n  return createAuthEndpoint(\n    \"/api-key/create\",\n    {\n      method: \"POST\",\n      body: z.object({\n        name: z.string({ description: \"Name of the Api Key\" }).optional(),\n        expiresIn: z.number({\n          description: \"Expiration time of the Api Key in seconds\"\n        }).min(1).optional().nullable().default(null),\n        userId: z.string({\n          description: \"User Id of the user that the Api Key belongs to. Useful for server-side only.\"\n        }).optional(),\n        prefix: z.string({ description: \"Prefix of the Api Key\" }).regex(/^[a-zA-Z0-9_-]+$/, {\n          message: \"Invalid prefix format, must be alphanumeric and contain only underscores and hyphens.\"\n        }).optional(),\n        remaining: z.number({\n          description: \"Remaining number of requests. Server side only\"\n        }).min(0).optional().nullable().default(null),\n        metadata: z.any({ description: \"Metadata of the Api Key\" }).optional(),\n        refillAmount: z.number({\n          description: \"Amount to refill the remaining count of the Api Key. Server Only Property\"\n        }).min(1).optional(),\n        refillInterval: z.number({\n          description: \"Interval to refill the Api Key in milliseconds. Server Only Property.\"\n        }).optional(),\n        rateLimitTimeWindow: z.number({\n          description: \"The duration in milliseconds where each request is counted. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset. Server Only Property.\"\n        }).optional(),\n        rateLimitMax: z.number({\n          description: \"Maximum amount of requests allowed within a window. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset. Server Only Property.\"\n        }).optional(),\n        rateLimitEnabled: z.boolean({\n          description: \"Whether the key has rate limiting enabled. Server Only Property.\"\n        }).optional(),\n        permissions: z.record(z.string(), z.array(z.string())).optional()\n      })\n    },\n    async (ctx) => {\n      const {\n        name,\n        expiresIn,\n        prefix,\n        remaining,\n        metadata,\n        refillAmount,\n        refillInterval,\n        permissions,\n        rateLimitMax,\n        rateLimitTimeWindow,\n        rateLimitEnabled\n      } = ctx.body;\n      const session = await getSessionFromCtx(ctx);\n      const authRequired = (ctx.request || ctx.headers) && !ctx.body.userId;\n      const user = session?.user ?? (authRequired ? null : { id: ctx.body.userId });\n      if (!user?.id) {\n        throw new APIError(\"UNAUTHORIZED\", {\n          message: ERROR_CODES.UNAUTHORIZED_SESSION\n        });\n      }\n      if (authRequired) {\n        if (refillAmount !== void 0 || refillInterval !== void 0 || rateLimitMax !== void 0 || rateLimitTimeWindow !== void 0 || rateLimitEnabled !== void 0 || permissions !== void 0 || remaining !== null) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.SERVER_ONLY_PROPERTY\n          });\n        }\n      }\n      if (metadata) {\n        if (opts.enableMetadata === false) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.METADATA_DISABLED\n          });\n        }\n        if (typeof metadata !== \"object\") {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.INVALID_METADATA_TYPE\n          });\n        }\n      }\n      if (refillAmount && !refillInterval) {\n        throw new APIError(\"BAD_REQUEST\", {\n          message: ERROR_CODES.REFILL_AMOUNT_AND_INTERVAL_REQUIRED\n        });\n      }\n      if (refillInterval && !refillAmount) {\n        throw new APIError(\"BAD_REQUEST\", {\n          message: ERROR_CODES.REFILL_INTERVAL_AND_AMOUNT_REQUIRED\n        });\n      }\n      if (expiresIn) {\n        if (opts.keyExpiration.disableCustomExpiresTime === true) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.KEY_DISABLED_EXPIRATION\n          });\n        }\n        const expiresIn_in_days = expiresIn / (60 * 60 * 24);\n        if (opts.keyExpiration.minExpiresIn > expiresIn_in_days) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.EXPIRES_IN_IS_TOO_SMALL\n          });\n        } else if (opts.keyExpiration.maxExpiresIn < expiresIn_in_days) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.EXPIRES_IN_IS_TOO_LARGE\n          });\n        }\n      }\n      if (prefix) {\n        if (prefix.length < opts.minimumPrefixLength) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.INVALID_PREFIX_LENGTH\n          });\n        }\n        if (prefix.length > opts.maximumPrefixLength) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.INVALID_PREFIX_LENGTH\n          });\n        }\n      }\n      if (name) {\n        if (name.length < opts.minimumNameLength) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.INVALID_NAME_LENGTH\n          });\n        }\n        if (name.length > opts.maximumNameLength) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.INVALID_NAME_LENGTH\n          });\n        }\n      }\n      deleteAllExpiredApiKeys(ctx.context);\n      const key = await keyGenerator({\n        length: opts.defaultKeyLength,\n        prefix: prefix || opts.defaultPrefix\n      });\n      const hash = await createHash(\"SHA-256\").digest(key);\n      const hashed = base64Url.encode(hash, {\n        padding: false\n      });\n      let start = null;\n      if (opts.startingCharactersConfig.shouldStore) {\n        start = key.substring(\n          0,\n          opts.startingCharactersConfig.charactersLength\n        );\n      }\n      const defaultPermissions = opts.permissions?.defaultPermissions ? typeof opts.permissions.defaultPermissions === \"function\" ? await opts.permissions.defaultPermissions(user.id, ctx) : opts.permissions.defaultPermissions : void 0;\n      const permissionsToApply = permissions ? JSON.stringify(permissions) : defaultPermissions ? JSON.stringify(defaultPermissions) : void 0;\n      let data = {\n        id: generateId(),\n        createdAt: /* @__PURE__ */ new Date(),\n        updatedAt: /* @__PURE__ */ new Date(),\n        name: name ?? null,\n        prefix: prefix ?? opts.defaultPrefix ?? null,\n        start,\n        key: hashed,\n        enabled: true,\n        expiresAt: expiresIn ? getDate(expiresIn, \"sec\") : opts.keyExpiration.defaultExpiresIn ? getDate(opts.keyExpiration.defaultExpiresIn, \"sec\") : null,\n        userId: user.id,\n        lastRefillAt: null,\n        lastRequest: null,\n        metadata: null,\n        rateLimitMax: rateLimitMax ?? opts.rateLimit.maxRequests ?? null,\n        rateLimitTimeWindow: rateLimitTimeWindow ?? opts.rateLimit.timeWindow ?? null,\n        remaining: remaining || refillAmount || null,\n        refillAmount: refillAmount ?? null,\n        refillInterval: refillInterval ?? null,\n        rateLimitEnabled: rateLimitEnabled ?? true,\n        requestCount: 0,\n        permissions: permissionsToApply\n      };\n      if (metadata) {\n        data.metadata = schema.apikey.fields.metadata.transform.input(metadata);\n      }\n      const apiKey = await ctx.context.adapter.create({\n        model: schema.apikey.modelName,\n        data\n      });\n      return ctx.json({\n        ...apiKey,\n        key,\n        metadata: metadata ?? null,\n        permissions: apiKey.permissions ? safeJSONParse(apiKey.permissions) : null\n      });\n    }\n  );\n}\n\nfunction deleteApiKey({\n  opts,\n  schema,\n  deleteAllExpiredApiKeys\n}) {\n  return createAuthEndpoint(\n    \"/api-key/delete\",\n    {\n      method: \"DELETE\",\n      body: z.object({\n        keyId: z.string({\n          description: \"The id of the Api Key\"\n        })\n      }),\n      use: [sessionMiddleware]\n    },\n    async (ctx) => {\n      const { keyId } = ctx.body;\n      const session = ctx.context.session;\n      if (session.user.banned === true) {\n        throw new APIError(\"UNAUTHORIZED\", {\n          message: ERROR_CODES.USER_BANNED\n        });\n      }\n      const apiKey = await ctx.context.adapter.findOne({\n        model: schema.apikey.modelName,\n        where: [\n          {\n            field: \"id\",\n            value: keyId\n          }\n        ]\n      });\n      if (!apiKey || apiKey.userId !== session.user.id) {\n        throw new APIError(\"NOT_FOUND\", {\n          message: ERROR_CODES.KEY_NOT_FOUND\n        });\n      }\n      try {\n        await ctx.context.adapter.delete({\n          model: schema.apikey.modelName,\n          where: [\n            {\n              field: \"id\",\n              value: apiKey.id\n            }\n          ]\n        });\n      } catch (error) {\n        throw new APIError(\"INTERNAL_SERVER_ERROR\", {\n          message: error?.message\n        });\n      }\n      deleteAllExpiredApiKeys(ctx.context);\n      return ctx.json({\n        success: true\n      });\n    }\n  );\n}\n\nfunction getApiKey({\n  opts,\n  schema,\n  deleteAllExpiredApiKeys\n}) {\n  return createAuthEndpoint(\n    \"/api-key/get\",\n    {\n      method: \"GET\",\n      query: z.object({\n        id: z.string({\n          description: \"The id of the Api Key\"\n        })\n      }),\n      use: [sessionMiddleware]\n    },\n    async (ctx) => {\n      const { id } = ctx.query;\n      const session = ctx.context.session;\n      let apiKey = await ctx.context.adapter.findOne({\n        model: schema.apikey.modelName,\n        where: [\n          {\n            field: \"id\",\n            value: id\n          },\n          {\n            field: \"userId\",\n            value: session.user.id\n          }\n        ]\n      });\n      if (!apiKey) {\n        throw new APIError(\"NOT_FOUND\", {\n          message: ERROR_CODES.KEY_NOT_FOUND\n        });\n      }\n      deleteAllExpiredApiKeys(ctx.context);\n      apiKey.metadata = schema.apikey.fields.metadata.transform.output(\n        apiKey.metadata\n      );\n      const { key, ...returningApiKey } = apiKey;\n      return ctx.json(returningApiKey);\n    }\n  );\n}\n\nfunction updateApiKey({\n  opts,\n  schema,\n  deleteAllExpiredApiKeys\n}) {\n  return createAuthEndpoint(\n    \"/api-key/update\",\n    {\n      method: \"POST\",\n      body: z.object({\n        keyId: z.string({\n          description: \"The id of the Api Key\"\n        }),\n        userId: z.string().optional(),\n        name: z.string({\n          description: \"The name of the key\"\n        }).optional(),\n        enabled: z.boolean({\n          description: \"Whether the Api Key is enabled or not\"\n        }).optional(),\n        remaining: z.number({\n          description: \"The number of remaining requests\"\n        }).min(1).optional(),\n        refillAmount: z.number({\n          description: \"The refill amount\"\n        }).optional(),\n        refillInterval: z.number({\n          description: \"The refill interval\"\n        }).optional(),\n        metadata: z.any({\n          description: \"The metadata of the Api Key\"\n        }).optional(),\n        expiresIn: z.number({\n          description: \"Expiration time of the Api Key in seconds\"\n        }).min(1).optional().nullable(),\n        rateLimitEnabled: z.boolean({\n          description: \"Whether the key has rate limiting enabled.\"\n        }).optional(),\n        rateLimitTimeWindow: z.number({\n          description: \"The duration in milliseconds where each request is counted.\"\n        }).optional(),\n        rateLimitMax: z.number({\n          description: \"Maximum amount of requests allowed within a window. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset.\"\n        }).optional(),\n        permissions: z.record(z.string(), z.array(z.string())).optional().nullable()\n      })\n    },\n    async (ctx) => {\n      const {\n        keyId,\n        expiresIn,\n        enabled,\n        metadata,\n        refillAmount,\n        refillInterval,\n        remaining,\n        name,\n        permissions,\n        rateLimitEnabled,\n        rateLimitTimeWindow,\n        rateLimitMax\n      } = ctx.body;\n      const session = await getSessionFromCtx(ctx);\n      const authRequired = (ctx.request || ctx.headers) && !ctx.body.userId;\n      const user = session?.user ?? (authRequired ? null : { id: ctx.body.userId });\n      if (!user?.id) {\n        throw new APIError(\"UNAUTHORIZED\", {\n          message: ERROR_CODES.UNAUTHORIZED_SESSION\n        });\n      }\n      if (authRequired) {\n        if (refillAmount !== void 0 || refillInterval !== void 0 || rateLimitMax !== void 0 || rateLimitTimeWindow !== void 0 || rateLimitEnabled !== void 0 || remaining !== void 0 || permissions !== void 0) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.SERVER_ONLY_PROPERTY\n          });\n        }\n      }\n      const apiKey = await ctx.context.adapter.findOne({\n        model: schema.apikey.modelName,\n        where: [\n          {\n            field: \"id\",\n            value: keyId\n          },\n          {\n            field: \"userId\",\n            value: user.id\n          }\n        ]\n      });\n      if (!apiKey) {\n        throw new APIError(\"NOT_FOUND\", {\n          message: ERROR_CODES.KEY_NOT_FOUND\n        });\n      }\n      let newValues = {};\n      if (name !== void 0) {\n        if (name.length < opts.minimumNameLength) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.INVALID_NAME_LENGTH\n          });\n        } else if (name.length > opts.maximumNameLength) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.INVALID_NAME_LENGTH\n          });\n        }\n        newValues.name = name;\n      }\n      if (enabled !== void 0) {\n        newValues.enabled = enabled;\n      }\n      if (expiresIn !== void 0) {\n        if (opts.keyExpiration.disableCustomExpiresTime === true) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.KEY_DISABLED_EXPIRATION\n          });\n        }\n        if (expiresIn !== null) {\n          const expiresIn_in_days = expiresIn / (60 * 60 * 24);\n          if (expiresIn_in_days < opts.keyExpiration.minExpiresIn) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.EXPIRES_IN_IS_TOO_SMALL\n            });\n          } else if (expiresIn_in_days > opts.keyExpiration.maxExpiresIn) {\n            throw new APIError(\"BAD_REQUEST\", {\n              message: ERROR_CODES.EXPIRES_IN_IS_TOO_LARGE\n            });\n          }\n        }\n        newValues.expiresAt = expiresIn ? getDate(expiresIn, \"sec\") : null;\n      }\n      if (metadata !== void 0) {\n        if (typeof metadata !== \"object\") {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.INVALID_METADATA_TYPE\n          });\n        }\n        newValues.metadata = schema.apikey.fields.metadata.transform.input(metadata);\n      }\n      if (remaining !== void 0) {\n        newValues.remaining = remaining;\n      }\n      if (refillAmount !== void 0 || refillInterval !== void 0) {\n        if (refillAmount !== void 0 && refillInterval === void 0) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.REFILL_AMOUNT_AND_INTERVAL_REQUIRED\n          });\n        } else if (refillInterval !== void 0 && refillAmount === void 0) {\n          throw new APIError(\"BAD_REQUEST\", {\n            message: ERROR_CODES.REFILL_INTERVAL_AND_AMOUNT_REQUIRED\n          });\n        }\n        newValues.refillAmount = refillAmount;\n        newValues.refillInterval = refillInterval;\n      }\n      if (rateLimitEnabled !== void 0) {\n        newValues.rateLimitEnabled = rateLimitEnabled;\n      }\n      if (rateLimitTimeWindow !== void 0) {\n        newValues.rateLimitTimeWindow = rateLimitTimeWindow;\n      }\n      if (rateLimitMax !== void 0) {\n        newValues.rateLimitMax = rateLimitMax;\n      }\n      if (permissions !== void 0) {\n        newValues.permissions = JSON.stringify(permissions);\n      }\n      if (Object.keys(newValues).length === 0) {\n        throw new APIError(\"BAD_REQUEST\", {\n          message: ERROR_CODES.NO_VALUES_TO_UPDATE\n        });\n      }\n      let newApiKey = apiKey;\n      try {\n        let result = await ctx.context.adapter.update({\n          model: schema.apikey.modelName,\n          where: [\n            {\n              field: \"id\",\n              value: apiKey.id\n            },\n            {\n              field: \"userId\",\n              value: user.id\n            }\n          ],\n          update: {\n            lastRequest: /* @__PURE__ */ new Date(),\n            remaining: apiKey.remaining === null ? null : apiKey.remaining - 1,\n            ...newValues\n          }\n        });\n        if (result) newApiKey = result;\n      } catch (error) {\n        throw new APIError(\"INTERNAL_SERVER_ERROR\", {\n          message: error?.message\n        });\n      }\n      deleteAllExpiredApiKeys(ctx.context);\n      newApiKey.metadata = schema.apikey.fields.metadata.transform.output(\n        newApiKey.metadata\n      );\n      newApiKey.permissions = JSON.parse(newApiKey.permissions);\n      const { key, ...returningApiKey } = newApiKey;\n      return ctx.json(returningApiKey);\n    }\n  );\n}\n\nfunction isRateLimited(apiKey, opts) {\n  const now = /* @__PURE__ */ new Date();\n  const lastRequest = apiKey.lastRequest;\n  const rateLimitTimeWindow = apiKey.rateLimitTimeWindow;\n  const rateLimitMax = apiKey.rateLimitMax;\n  let requestCount = apiKey.requestCount;\n  if (opts.rateLimit.enabled === false)\n    return {\n      success: true,\n      message: null,\n      update: { lastRequest: now },\n      tryAgainIn: null\n    };\n  if (apiKey.rateLimitEnabled === false)\n    return {\n      success: true,\n      message: null,\n      update: { lastRequest: now },\n      tryAgainIn: null\n    };\n  if (rateLimitTimeWindow === null || rateLimitMax === null) {\n    return {\n      success: true,\n      message: null,\n      update: null,\n      tryAgainIn: null\n    };\n  }\n  if (lastRequest === null) {\n    return {\n      success: true,\n      message: null,\n      update: { lastRequest: now, requestCount: 1 },\n      tryAgainIn: null\n    };\n  }\n  const timeSinceLastRequest = now.getTime() - lastRequest.getTime();\n  if (timeSinceLastRequest > rateLimitTimeWindow) {\n    return {\n      success: true,\n      message: null,\n      update: { lastRequest: now, requestCount: 1 },\n      tryAgainIn: null\n    };\n  }\n  if (requestCount >= rateLimitMax) {\n    return {\n      success: false,\n      message: ERROR_CODES.RATE_LIMIT_EXCEEDED,\n      update: null,\n      tryAgainIn: Math.ceil(rateLimitTimeWindow - timeSinceLastRequest)\n    };\n  }\n  requestCount++;\n  return {\n    success: true,\n    message: null,\n    tryAgainIn: null,\n    update: { lastRequest: now, requestCount }\n  };\n}\n\nfunction verifyApiKey({\n  opts,\n  schema,\n  deleteAllExpiredApiKeys\n}) {\n  return createAuthEndpoint(\n    \"/api-key/verify\",\n    {\n      method: \"POST\",\n      body: z.object({\n        key: z.string({\n          description: \"The key to verify\"\n        }),\n        permissions: z.record(z.string(), z.array(z.string())).optional()\n      }),\n      metadata: {\n        SERVER_ONLY: true\n      }\n    },\n    async (ctx) => {\n      const { key } = ctx.body;\n      if (key.length < opts.defaultKeyLength) {\n        return ctx.json({\n          valid: false,\n          error: {\n            message: ERROR_CODES.INVALID_API_KEY,\n            code: \"KEY_NOT_FOUND\"\n          },\n          key: null\n        });\n      }\n      if (opts.customAPIKeyValidator && !opts.customAPIKeyValidator({ ctx, key })) {\n        return ctx.json({\n          valid: false,\n          error: {\n            message: ERROR_CODES.INVALID_API_KEY,\n            code: \"KEY_NOT_FOUND\"\n          },\n          key: null\n        });\n      }\n      const hash = await createHash(\"SHA-256\").digest(\n        new TextEncoder().encode(key)\n      );\n      const hashed = base64Url.encode(new Uint8Array(hash), {\n        padding: false\n      });\n      const apiKey = await ctx.context.adapter.findOne({\n        model: schema.apikey.modelName,\n        where: [\n          {\n            field: \"key\",\n            value: hashed\n          }\n        ]\n      });\n      if (!apiKey) {\n        return ctx.json({\n          valid: false,\n          error: {\n            message: ERROR_CODES.KEY_NOT_FOUND,\n            code: \"KEY_NOT_FOUND\"\n          },\n          key: null\n        });\n      }\n      if (apiKey.enabled === false) {\n        return ctx.json({\n          valid: false,\n          error: {\n            message: ERROR_CODES.USAGE_EXCEEDED,\n            code: \"KEY_DISABLED\"\n          },\n          key: null\n        });\n      }\n      if (apiKey.expiresAt) {\n        const now = (/* @__PURE__ */ new Date()).getTime();\n        const expiresAt = apiKey.expiresAt.getTime();\n        if (now > expiresAt) {\n          try {\n            ctx.context.adapter.delete({\n              model: schema.apikey.modelName,\n              where: [\n                {\n                  field: \"id\",\n                  value: apiKey.id\n                }\n              ]\n            });\n          } catch (error) {\n            ctx.context.logger.error(\n              `Failed to delete expired API keys:`,\n              error\n            );\n          }\n          return ctx.json({\n            valid: false,\n            error: {\n              message: ERROR_CODES.KEY_EXPIRED,\n              code: \"KEY_EXPIRED\"\n            },\n            key: null\n          });\n        }\n      }\n      const requiredPermissions = ctx.body.permissions;\n      const apiKeyPermissions = apiKey.permissions ? safeJSONParse(apiKey.permissions) : null;\n      if (requiredPermissions) {\n        if (!apiKeyPermissions) {\n          return ctx.json({\n            valid: false,\n            error: {\n              message: ERROR_CODES.KEY_NOT_FOUND,\n              code: \"KEY_NOT_FOUND\"\n            },\n            key: null\n          });\n        }\n        const r = role(apiKeyPermissions);\n        const result = r.authorize(requiredPermissions);\n        if (!result.success) {\n          return ctx.json({\n            valid: false,\n            error: {\n              message: ERROR_CODES.KEY_NOT_FOUND,\n              code: \"KEY_NOT_FOUND\"\n            },\n            key: null\n          });\n        }\n      }\n      let remaining = apiKey.remaining;\n      let lastRefillAt = apiKey.lastRefillAt;\n      if (apiKey.remaining === 0 && apiKey.refillAmount === null) {\n        try {\n          ctx.context.adapter.delete({\n            model: schema.apikey.modelName,\n            where: [\n              {\n                field: \"id\",\n                value: apiKey.id\n              }\n            ]\n          });\n        } catch (error) {\n          ctx.context.logger.error(`Failed to delete expired API keys:`, error);\n        }\n        return ctx.json({\n          valid: false,\n          error: {\n            message: ERROR_CODES.USAGE_EXCEEDED,\n            code: \"USAGE_EXCEEDED\"\n          },\n          key: null\n        });\n      } else if (remaining !== null) {\n        let now = (/* @__PURE__ */ new Date()).getTime();\n        const refillInterval = apiKey.refillInterval;\n        const refillAmount = apiKey.refillAmount;\n        let lastTime = (lastRefillAt ?? apiKey.createdAt).getTime();\n        if (refillInterval && refillAmount) {\n          const timeSinceLastRequest = (now - lastTime) / (1e3 * 60 * 60 * 24);\n          if (timeSinceLastRequest > refillInterval) {\n            remaining = refillAmount;\n            lastRefillAt = /* @__PURE__ */ new Date();\n          }\n        }\n        if (remaining === 0) {\n          return ctx.json({\n            valid: false,\n            error: {\n              message: ERROR_CODES.USAGE_EXCEEDED,\n              code: \"USAGE_EXCEEDED\"\n            },\n            key: null\n          });\n        } else {\n          remaining--;\n        }\n      }\n      const { message, success, update, tryAgainIn } = isRateLimited(\n        apiKey,\n        opts\n      );\n      const newApiKey = await ctx.context.adapter.update({\n        model: schema.apikey.modelName,\n        where: [\n          {\n            field: \"id\",\n            value: apiKey.id\n          }\n        ],\n        update: {\n          ...update,\n          remaining,\n          lastRefillAt\n        }\n      });\n      if (success === false) {\n        return ctx.json({\n          valid: false,\n          error: {\n            message,\n            code: \"RATE_LIMITED\",\n            details: {\n              tryAgainIn\n            }\n          },\n          key: null\n        });\n      }\n      deleteAllExpiredApiKeys(ctx.context);\n      const { key: _, ...returningApiKey } = newApiKey ?? { key: 1 };\n      if (\"metadata\" in returningApiKey) {\n        returningApiKey.metadata = schema.apikey.fields.metadata.transform.output(\n          returningApiKey.metadata\n        );\n      }\n      return ctx.json({\n        valid: true,\n        error: null,\n        key: newApiKey === null ? null : returningApiKey\n      });\n    }\n  );\n}\n\nfunction listApiKeys({\n  opts,\n  schema,\n  deleteAllExpiredApiKeys\n}) {\n  return createAuthEndpoint(\n    \"/api-key/list\",\n    {\n      method: \"GET\",\n      use: [sessionMiddleware]\n    },\n    async (ctx) => {\n      const session = ctx.context.session;\n      let apiKeys = await ctx.context.adapter.findMany({\n        model: schema.apikey.modelName,\n        where: [\n          {\n            field: \"userId\",\n            value: session.user.id\n          }\n        ]\n      });\n      deleteAllExpiredApiKeys(ctx.context);\n      apiKeys = apiKeys.map((apiKey) => {\n        return {\n          ...apiKey,\n          metadata: schema.apikey.fields.metadata.transform.output(\n            apiKey.metadata\n          )\n        };\n      });\n      let returningApiKey = apiKeys.map((x) => {\n        const { key, ...returningApiKey2 } = x;\n        return returningApiKey2;\n      });\n      return ctx.json(returningApiKey);\n    }\n  );\n}\n\nfunction deleteAllExpiredApiKeysEndpoint({\n  deleteAllExpiredApiKeys\n}) {\n  return createAuthEndpoint(\n    \"/api-key/delete-all-expired-api-keys\",\n    {\n      method: \"DELETE\",\n      metadata: {\n        SERVER_ONLY: true\n      }\n    },\n    async (ctx) => {\n      try {\n        await deleteAllExpiredApiKeys(ctx.context, true);\n      } catch (error) {\n        ctx.context.logger.error(\n          \"[API KEY PLUGIN] Failed to delete expired API keys:\",\n          error\n        );\n        return ctx.json({\n          success: false,\n          error\n        });\n      }\n      return ctx.json({ success: true, error: null });\n    }\n  );\n}\n\nfunction createApiKeyRoutes({\n  keyGenerator,\n  opts,\n  schema\n}) {\n  let lastChecked = null;\n  function deleteAllExpiredApiKeys(ctx, byPassLastCheckTime = false) {\n    if (lastChecked && !byPassLastCheckTime) {\n      const now = /* @__PURE__ */ new Date();\n      const diff = now.getTime() - lastChecked.getTime();\n      if (diff < 1e4) {\n        return;\n      }\n    }\n    lastChecked = /* @__PURE__ */ new Date();\n    try {\n      return ctx.adapter.deleteMany({\n        model: schema.apikey.modelName,\n        where: [\n          {\n            field: \"expiresAt\",\n            operator: \"lt\",\n            value: /* @__PURE__ */ new Date()\n          }\n        ]\n      });\n    } catch (error) {\n      ctx.logger.error(`Failed to delete expired API keys:`, error);\n    }\n  }\n  return {\n    createApiKey: createApiKey({\n      keyGenerator,\n      opts,\n      schema,\n      deleteAllExpiredApiKeys\n    }),\n    verifyApiKey: verifyApiKey({ opts, schema, deleteAllExpiredApiKeys }),\n    getApiKey: getApiKey({ opts, schema, deleteAllExpiredApiKeys }),\n    updateApiKey: updateApiKey({ opts, schema, deleteAllExpiredApiKeys }),\n    deleteApiKey: deleteApiKey({ opts, schema, deleteAllExpiredApiKeys }),\n    listApiKeys: listApiKeys({ opts, schema, deleteAllExpiredApiKeys }),\n    deleteAllExpiredApiKeys: deleteAllExpiredApiKeysEndpoint({\n      deleteAllExpiredApiKeys\n    })\n  };\n}\n\nconst ERROR_CODES = {\n  INVALID_METADATA_TYPE: \"metadata must be an object or undefined\",\n  REFILL_AMOUNT_AND_INTERVAL_REQUIRED: \"refillAmount is required when refillInterval is provided\",\n  REFILL_INTERVAL_AND_AMOUNT_REQUIRED: \"refillInterval is required when refillAmount is provided\",\n  USER_BANNED: \"User is banned\",\n  UNAUTHORIZED_SESSION: \"Unauthorized or invalid session\",\n  KEY_NOT_FOUND: \"API Key not found\",\n  KEY_DISABLED: \"API Key is disabled\",\n  KEY_EXPIRED: \"API Key has expired\",\n  USAGE_EXCEEDED: \"API Key has reached its usage limit\",\n  KEY_NOT_RECOVERABLE: \"API Key is not recoverable\",\n  EXPIRES_IN_IS_TOO_SMALL: \"The expiresIn is smaller than the predefined minimum value.\",\n  EXPIRES_IN_IS_TOO_LARGE: \"The expiresIn is larger than the predefined maximum value.\",\n  INVALID_REMAINING: \"The remaining count is either too large or too small.\",\n  INVALID_PREFIX_LENGTH: \"The prefix length is either too large or too small.\",\n  INVALID_NAME_LENGTH: \"The name length is either too large or too small.\",\n  METADATA_DISABLED: \"Metadata is disabled.\",\n  RATE_LIMIT_EXCEEDED: \"Rate limit exceeded.\",\n  NO_VALUES_TO_UPDATE: \"No values to update.\",\n  KEY_DISABLED_EXPIRATION: \"Custom key expiration values are disabled.\",\n  INVALID_API_KEY: \"Invalid API key.\",\n  INVALID_USER_ID_FROM_API_KEY: \"The user id from the API key is invalid.\",\n  INVALID_API_KEY_GETTER_RETURN_TYPE: \"API Key getter returned an invalid key type. Expected string.\",\n  SERVER_ONLY_PROPERTY: \"The property you're trying to set can only be set from the server auth instance only.\"\n};\nconst apiKey = (options) => {\n  const opts = {\n    ...options,\n    apiKeyHeaders: options?.apiKeyHeaders ?? \"x-api-key\",\n    defaultKeyLength: options?.defaultKeyLength || 64,\n    maximumPrefixLength: options?.maximumPrefixLength ?? 32,\n    minimumPrefixLength: options?.minimumPrefixLength ?? 1,\n    maximumNameLength: options?.maximumNameLength ?? 32,\n    minimumNameLength: options?.minimumNameLength ?? 1,\n    enableMetadata: options?.enableMetadata ?? false,\n    rateLimit: {\n      enabled: options?.rateLimit?.enabled ?? true,\n      timeWindow: options?.rateLimit?.timeWindow ?? 1e3 * 60 * 60 * 24,\n      maxRequests: options?.rateLimit?.maxRequests ?? 10\n    },\n    keyExpiration: {\n      defaultExpiresIn: options?.keyExpiration?.defaultExpiresIn ?? null,\n      disableCustomExpiresTime: options?.keyExpiration?.disableCustomExpiresTime ?? false,\n      maxExpiresIn: options?.keyExpiration?.maxExpiresIn ?? 365,\n      minExpiresIn: options?.keyExpiration?.minExpiresIn ?? 1\n    },\n    startingCharactersConfig: {\n      shouldStore: options?.startingCharactersConfig?.shouldStore ?? true,\n      charactersLength: options?.startingCharactersConfig?.charactersLength ?? 6\n    },\n    disableSessionForAPIKeys: options?.disableSessionForAPIKeys ?? false\n  };\n  const schema = mergeSchema(\n    apiKeySchema({\n      rateLimitMax: opts.rateLimit.maxRequests,\n      timeWindow: opts.rateLimit.timeWindow\n    }),\n    opts.schema\n  );\n  const getter = opts.customAPIKeyGetter || ((ctx) => {\n    if (Array.isArray(opts.apiKeyHeaders)) {\n      for (const header of opts.apiKeyHeaders) {\n        const value = ctx.headers?.get(header);\n        if (value) {\n          return value;\n        }\n      }\n    } else {\n      return ctx.headers?.get(opts.apiKeyHeaders);\n    }\n  });\n  const keyGenerator = opts.customKeyGenerator || (async (options2) => {\n    const characters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\";\n    let apiKey2 = `${options2.prefix || \"\"}`;\n    for (let i = 0; i < options2.length; i++) {\n      const randomIndex = Math.floor(Math.random() * characters.length);\n      apiKey2 += characters[randomIndex];\n    }\n    return apiKey2;\n  });\n  const routes = createApiKeyRoutes({ keyGenerator, opts, schema });\n  return {\n    id: \"api-key\",\n    $ERROR_CODES: ERROR_CODES,\n    hooks: {\n      before: [\n        {\n          matcher: (ctx) => !!getter(ctx) && opts.disableSessionForAPIKeys === false,\n          handler: createAuthMiddleware(async (ctx) => {\n            const key = getter(ctx);\n            if (typeof key !== \"string\") {\n              throw new APIError(\"BAD_REQUEST\", {\n                message: ERROR_CODES.INVALID_API_KEY_GETTER_RETURN_TYPE\n              });\n            }\n            if (key.length < opts.defaultKeyLength) {\n              throw new APIError(\"FORBIDDEN\", {\n                message: ERROR_CODES.INVALID_API_KEY\n              });\n            }\n            if (opts.customAPIKeyValidator && !opts.customAPIKeyValidator({ ctx, key })) {\n              throw new APIError(\"FORBIDDEN\", {\n                message: ERROR_CODES.INVALID_API_KEY\n              });\n            }\n            const hash = await createHash(\"SHA-256\").digest(\n              new TextEncoder().encode(key)\n            );\n            const hashed = base64Url.encode(new Uint8Array(hash), {\n              padding: false\n            });\n            const apiKey2 = await ctx.context.adapter.findOne({\n              model: schema.apikey.modelName,\n              where: [\n                {\n                  field: \"key\",\n                  value: hashed\n                }\n              ]\n            });\n            if (!apiKey2) {\n              throw new APIError(\"UNAUTHORIZED\", {\n                message: ERROR_CODES.INVALID_API_KEY\n              });\n            }\n            let user;\n            try {\n              const userResult = await ctx.context.internalAdapter.findUserById(\n                apiKey2.userId\n              );\n              if (!userResult) {\n                throw new APIError(\"UNAUTHORIZED\", {\n                  message: ERROR_CODES.INVALID_USER_ID_FROM_API_KEY\n                });\n              }\n              user = userResult;\n            } catch (error) {\n              throw error;\n            }\n            const session = {\n              user,\n              session: {\n                id: apiKey2.id,\n                token: key,\n                userId: user.id,\n                userAgent: ctx.request?.headers.get(\"user-agent\") ?? null,\n                ipAddress: ctx.request ? getIp(ctx.request, ctx.context.options) : null,\n                createdAt: /* @__PURE__ */ new Date(),\n                updatedAt: /* @__PURE__ */ new Date(),\n                expiresAt: apiKey2.expiresAt || getDate(\n                  ctx.context.options.session?.expiresIn || 60 * 60 * 24 * 7,\n                  // 7 days\n                  \"ms\"\n                )\n              }\n            };\n            ctx.context.session = session;\n            if (ctx.path === \"/get-session\") {\n              return session;\n            } else {\n              return {\n                context: ctx\n              };\n            }\n          })\n        }\n      ]\n    },\n    endpoints: {\n      createApiKey: routes.createApiKey,\n      verifyApiKey: routes.verifyApiKey,\n      getApiKey: routes.getApiKey,\n      updateApiKey: routes.updateApiKey,\n      deleteApiKey: routes.deleteApiKey,\n      listApiKeys: routes.listApiKeys\n    },\n    schema\n  };\n};\n\nexport { ERROR_CODES, apiKey, createAuthEndpoint, createAuthMiddleware };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}}]
}